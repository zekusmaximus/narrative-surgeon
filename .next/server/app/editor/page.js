(()=>{var a={};a.id=766,a.ids=[766],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3923:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>bz});var d=c(60687),e=c(43210),f=c.n(e),g=c(7203),h=c(89136),i=c(18780),j=c(68418),k=c(84633),l=c(98926),m=c(55023),n=c(36293),o=c(82221),p=c(70297),q=c(94249),r=c(36682),s=c(56286),t=c(13659);let u=h.bP.create({name:"sceneBreak",group:"block",content:"",marks:"",atom:!0,parseHTML:()=>[{tag:'div[data-type="scene-break"]'}],renderHTML:()=>["div",{"data-type":"scene-break",class:"scene-break",contenteditable:"false"},"* * *"],addCommands(){return{insertSceneBreak:()=>({commands:a})=>a.insertContent({type:this.name})}},addKeyboardShortcuts(){return{"Mod-Shift-Enter":()=>this.editor.commands.insertSceneBreak()}}}),v=h.bP.create({name:"chapterDivision",group:"block",content:"inline*",marks:"",defining:!0,addAttributes:()=>({number:{default:1},title:{default:""}}),parseHTML:()=>[{tag:'div[data-type="chapter-division"]',getAttrs:a=>({number:parseInt(a.getAttribute("data-number")||"1",10),title:a.getAttribute("data-title")})}],renderHTML:({node:a})=>["div",{"data-type":"chapter-division","data-number":a.attrs.number,"data-title":a.attrs.title,class:"chapter-division"},`Chapter ${a.attrs.number}${a.attrs.title?`: ${a.attrs.title}`:""}`],addCommands(){return{insertChapterDivision:a=>({commands:b})=>b.insertContent({type:this.name,attrs:a})}}}),w=h.YY.create({name:"autoSave",addOptions:()=>({delay:2e3,onSave:()=>{}}),onCreate(){let a=null,b=()=>{a&&clearTimeout(a),a=setTimeout(()=>{try{this.options.onSave()}catch(a){console.error("Auto-save failed:",a)}},this.options.delay)};this.editor.on("update",b),this.editor.on("destroy",()=>{this.editor.off("update",b),a&&(clearTimeout(a),a=null)})}}),x=(0,e.forwardRef)(({content:a,onChange:b,readOnly:c=!1,showWordCount:f=!0,placeholder:h="Start writing your story...",className:x="",onSave:y},z)=>{let[A,B]=(0,e.useState)(!1),C=(0,e.useRef)(""),D=x.replace(/[\r\n\t\f\v]/g," ").replace(/\s+/g," ").trim(),E=(0,e.useCallback)(a=>{a!==C.current&&(C.current=a,b(a))},[b]),F=(0,g.hG)({immediatelyRender:!1,extensions:[i.A,j.A,k.A.configure({types:["heading","paragraph"]}),l.Ay,m.A.configure({types:["textStyle"]}),n.xJ,o.A,p.A.configure({placeholder:h,emptyEditorClass:"is-editor-empty"}),q.A,r.A,s.A,t.A.configure({nested:!0}),u,v,w.configure({delay:2e3,onSave:()=>y?.()})],content:a,editable:!c,onUpdate:({editor:a})=>{A||E(a.getHTML())},editorProps:{attributes:{class:`prose prose-lg max-w-none min-h-[500px] px-6 py-4 focus:outline-none manuscript-editor ${D}`.trim().replace(/\s+/g," "),spellcheck:"true"},handleKeyDown:(a,b)=>{if(b.ctrlKey||b.metaKey)switch(b.key){case"s":return b.preventDefault(),y?.(),!0;case"f":return b.preventDefault(),!0}return!1}}});return((0,e.useImperativeHandle)(z,()=>({getWordCount:()=>F?.storage?.characterCount?F.storage.characterCount.words():0,getCharacterCount:()=>F?.storage?.characterCount?F.storage.characterCount.characters():0,insertSceneBreak:()=>!!F?.commands&&(F.commands.insertSceneBreak?.()||!1),insertChapterDivision:(a,b)=>!!F?.commands&&(F.commands.insertChapterDivision?.({number:a,title:b})||!1),focus:()=>!!F?.commands&&F.commands.focus("end"),blur:()=>!!F?.commands&&F.commands.blur(),getHTML:()=>F?.getHTML()||"",getText:()=>F?.getText()||"",setContent:a=>!!F?.commands&&F.commands.setContent(a,!1),insertText:a=>!!F?.commands&&F.commands.insertContent(a),find:a=>{},replace:(a,b)=>{}}),[F]),(0,e.useEffect)(()=>{F&&a!==F.getHTML()&&!A&&(B(!0),F.commands.setContent(a,!1),setTimeout(()=>B(!1),0))},[a,F,A]),(0,e.useEffect)(()=>{F&&!c&&F.commands.focus("end")},[F,c]),(0,e.useEffect)(()=>()=>{F&&F.destroy()},[F]),F)?(0,d.jsxs)("div",{className:"relative w-full h-full",children:[(0,d.jsx)(g.$Z,{editor:F,className:"w-full h-full"}),f&&(0,d.jsxs)("div",{className:"absolute bottom-4 right-4 text-xs text-muted-foreground bg-background/80 backdrop-blur-sm px-2 py-1 rounded border",children:[F.storage.characterCount.words()," words • ",F.storage.characterCount.characters()," characters"]}),(0,d.jsx)("div",{className:"absolute top-4 right-4 text-xs text-muted-foreground",children:c?(0,d.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,d.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"Read Only"]}):(0,d.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,d.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Editing"]})})]}):(0,d.jsx)("div",{className:"flex items-center justify-center min-h-[500px] text-muted-foreground",children:"Loading editor..."})});x.displayName="TiptapEditor";var y=c(29523),z=c(43649),A=c(78122);class B extends f().Component{constructor(a){super(a),this.handleRetry=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})},this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,b){console.error("Editor Error:",a,b),this.setState({errorInfo:b})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,d.jsx)("div",{className:"flex items-center justify-center min-h-[400px] border border-red-200 rounded-lg bg-red-50",children:(0,d.jsxs)("div",{className:"text-center p-6 max-w-md",children:[(0,d.jsx)(z.A,{className:"h-12 w-12 text-red-600 mx-auto mb-4"}),(0,d.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Editor Error"}),(0,d.jsx)("p",{className:"text-red-700 mb-4 text-sm",children:"The editor encountered an unexpected error. Your work is automatically saved."}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)(y.$,{onClick:this.handleRetry,className:"bg-red-600 hover:bg-red-700 text-white",children:[(0,d.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Try Again"]}),(0,d.jsx)(y.$,{variant:"outline",onClick:()=>window.location.reload(),className:"text-red-600 border-red-300",children:"Reload Page"})]}),!1]})}):this.props.children}}var C=c(89698),D=c(33752),E=c(4780);let F=({className:a,...b})=>(0,d.jsx)(D.YZ,{className:(0,E.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",a),...b}),G=D.Zk,H=({withHandle:a,className:b,...c})=>(0,d.jsx)(D.TW,{className:(0,E.cn)("relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",b),...c,children:a&&(0,d.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border",children:(0,d.jsx)(C.YtH,{className:"h-2.5 w-2.5"})})});var I=c(24772);let J=f().forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(I.bL,{ref:e,className:(0,E.cn)("relative overflow-hidden",a),...c,children:[(0,d.jsx)(I.LM,{className:"h-full w-full rounded-[inherit]",children:b}),(0,d.jsx)(K,{}),(0,d.jsx)(I.OK,{})]}));J.displayName=I.bL.displayName;let K=f().forwardRef(({className:a,orientation:b="vertical",...c},e)=>(0,d.jsx)(I.VM,{ref:e,orientation:b,className:(0,E.cn)("flex touch-none select-none transition-colors","vertical"===b&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===b&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...c,children:(0,d.jsx)(I.lr,{className:"relative flex-1 rounded-full bg-border"})}));K.displayName=I.VM.displayName;var L=c(62369);let M=e.forwardRef(({className:a,orientation:b="horizontal",decorative:c=!0,...e},f)=>(0,d.jsx)(L.b,{ref:f,decorative:c,orientation:b,className:(0,E.cn)("shrink-0 bg-border","horizontal"===b?"h-[1px] w-full":"h-full w-[1px]",a),...e}));M.displayName=L.b.displayName;let N=f().createContext({value:void 0,setValue:()=>{}}),O=({defaultValue:a,value:b,onValueChange:c,className:e,children:g})=>{let[h,i]=f().useState(a);return(0,d.jsx)(N.Provider,{value:{value:void 0!==b?b:h,setValue:a=>{c&&c(a),void 0===b&&i(a)}},children:(0,d.jsx)("div",{className:e,children:g})})},P=({children:a,...b})=>(0,d.jsx)("div",{role:"tablist",...b,children:a}),Q=({value:a,children:b,...c})=>{let{value:e,setValue:g}=f().useContext(N);return(0,d.jsx)("button",{role:"tab","aria-selected":e===a,onClick:()=>g(a),...c,children:b})},R=({value:a,children:b,...c})=>{let{value:e}=f().useContext(N);return e!==a?null:(0,d.jsx)("div",{role:"tabpanel",...c,children:b})};var S=c(53411),T=c(49014),U=c(47033),V=c(14952),W=c(10022),X=c(58887),Y=c(99270),Z=c(84027),$=c(58808),_=c(86532),aa=c(59350);class ab{constructor(a){this.manuscript=a}async analyzeConsistency(a){let b=[],c=this.getChaptersInOrder(a);return b.push(...this.checkKnowledgeDependencies(c)),b.push(...this.checkCharacterIntroductions(c)),b.push(...this.checkTechConceptOrder(c)),b.push(...this.checkPlotContinuity(c)),b.push(...this.checkTimelineConsistency(c)),b.push(...this.checkLocationIntroductions(c)),b.push(...this.checkTensionProgression(c)),b}getChaptersInOrder(a){return(a||this.manuscript.content.chapters.map(a=>a.id)).map(a=>this.manuscript.content.chapters.find(b=>b.id===a)).filter(Boolean)}checkKnowledgeDependencies(a){let b=[],c=new Set;for(let d=0;d<a.length;d++){let e=a[d];for(let a of e.dependencies.requiredKnowledge)c.has(a)||b.push({id:`knowledge-${e.id}-${a}`,type:"plot",severity:"warning",message:`Chapter ${d+1} "${e.title}" requires knowledge of "${a}" which hasn't been introduced yet`,chapterIds:[e.id],suggestion:`Consider introducing "${a}" in an earlier chapter or moving this chapter later`,autoFixable:!1});e.dependencies.introduces.forEach(a=>{c.add(a)})}return b}checkCharacterIntroductions(a){let b=[],c=new Set;for(let d=0;d<a.length;d++){let e=a[d];if(e.metadata.pov&&!c.has(e.metadata.pov)){let a=this.manuscript.content.characters.find(a=>a.name===e.metadata.pov);a&&a.firstAppearance!==e.id&&b.push({id:`pov-${e.id}-${e.metadata.pov}`,type:"character",severity:"error",message:`Chapter ${d+1} uses ${e.metadata.pov} as POV character before their introduction`,chapterIds:[e.id],suggestion:`Introduce ${e.metadata.pov} before using them as POV character`,autoFixable:!1})}this.manuscript.content.characters.forEach(a=>{e.content.includes(a.name)&&!c.has(a.name)&&a.firstAppearance!==e.id&&b.push({id:`char-ref-${e.id}-${a.name}`,type:"character",severity:"warning",message:`Chapter ${d+1} references ${a.name} before their introduction`,chapterIds:[e.id],suggestion:`Consider introducing ${a.name} earlier or moving this reference`,autoFixable:!1}),a.firstAppearance===e.id&&c.add(a.name)})}return b}checkTechConceptOrder(a){let b=[],c=new Set,d=["quantum computing","neural networks","blockchain","AI","cryptocurrency","biometrics","encryption","dark web","IoT","cloud computing"];for(let e=0;e<a.length;e++){let f=a[e];d.forEach(a=>{f.content.toLowerCase().includes(a.toLowerCase())&&!c.has(a)&&(f.dependencies.introduces.some(b=>b.toLowerCase().includes(a.toLowerCase()))?c.add(a):b.push({id:`tech-${f.id}-${a}`,type:"tech",severity:"info",message:`Chapter ${e+1} uses "${a}" without prior explanation`,chapterIds:[f.id],suggestion:`Consider explaining ${a} before heavy usage or in this chapter`,autoFixable:!1}))})}return b}checkPlotContinuity(a){let b=[],c=new Set;for(let d=0;d<a.length;d++){let e=a[d];e.dependencies.references.forEach(c=>{let f=a.find(a=>a.id===c.targetChapterId);if(f){let g=a.indexOf(f);g>d&&b.push({id:`plot-ref-${e.id}-${c.targetChapterId}`,type:"plot",severity:"error",message:`Chapter ${d+1} references events from Chapter ${g+1} which comes later`,chapterIds:[e.id,c.targetChapterId],suggestion:"Reorder chapters to maintain chronological consistency",autoFixable:!0})}}),e.metadata.majorEvents.forEach(a=>{c.add(a)})}return b}checkTimelineConsistency(a){let b=[];for(let c=1;c<a.length;c++){let d=a[c],e=a[c-1];d.metadata.timeframe&&e.metadata.timeframe&&(e.metadata.timeframe.includes("after")&&d.metadata.timeframe.includes("before")||d.metadata.timeframe.includes("before"))&&b.push({id:`timeline-${d.id}`,type:"timeline",severity:"warning",message:`Chapter ${c+1} "${d.title}" appears to go backward in time`,chapterIds:[d.id],suggestion:"Verify this flashback is intentional and properly signaled to readers",autoFixable:!1})}return b}checkLocationIntroductions(a){let b=[],c=new Set;for(let d=0;d<a.length;d++){let e=a[d];for(let a of e.metadata.location){let f=this.manuscript.content.locations.find(b=>b.name===a);f&&!c.has(a)&&f.firstMention!==e.id&&b.push({id:`location-${e.id}-${a}`,type:"location",severity:"info",message:`Chapter ${d+1} uses location "${a}" before its first mention`,chapterIds:[e.id],suggestion:"Consider adding location description or moving after first mention",autoFixable:!1}),c.add(a)}}return b}checkTensionProgression(a){let b=[];for(let c=1;c<a.length;c++){let d=a[c],e=a[c-1];d.metadata.tensionLevel&&e.metadata.tensionLevel&&(e.metadata.tensionLevel-d.metadata.tensionLevel>4&&b.push({id:`tension-drop-${d.id}`,type:"plot",severity:"info",message:`Large tension drop from Chapter ${c} to ${c+1} (${e.metadata.tensionLevel} → ${d.metadata.tensionLevel})`,chapterIds:[e.id,d.id],suggestion:"Consider smoothing the tension transition or ensuring this dramatic drop serves the story",autoFixable:!1}),d.metadata.tensionLevel<3&&e.metadata.tensionLevel<3&&b.push({id:`low-tension-${d.id}`,type:"plot",severity:"warning",message:`Chapters ${c} and ${c+1} both have low tension levels`,chapterIds:[e.id,d.id],suggestion:"Consider increasing tension or adding conflict to maintain reader engagement",autoFixable:!1}))}return b}async suggestOptimalOrder(){let a=this.manuscript.content.chapters,b=[],c=[...a].sort((a,b)=>{let c=a.dependencies.requiredKnowledge.length,d=b.dependencies.requiredKnowledge.length;return c!==d?c-d:(a.metadata.tensionLevel||0)-(b.metadata.tensionLevel||0)});return b.push("Ordered chapters by dependency complexity (simple concepts first)"),b.push("Applied gradual tension progression where possible"),b.push("Maintained character introduction order"),{order:c.map(a=>a.id),reasoning:b}}async analyzeOrderQuality(a){let b=await this.analyzeConsistency(a),c=b.filter(a=>"error"===a.severity).length,d=b.filter(a=>"warning"===a.severity).length,e=b.filter(a=>"info"===a.severity).length,f=Math.max(0,100-(3*c+2*d+ +e)/(10*this.manuscript.content.chapters.length)*100),g=[],h=[];return 0===c?g.push("No critical story flow issues detected"):h.push(`Fix ${c} critical error${c>1?"s":""}`),0===d?g.push("Good character and concept introduction order"):h.push(`Address ${d} potential issue${d>1?"s":""}`),e<3?g.push("Well-structured narrative flow"):h.push("Consider optimization suggestions for better flow"),{score:Math.round(f),issues:c+d+e,strengths:g,improvements:h}}}class ac{constructor(a){this.manuscript=a}async exportVersion(a){let b=this.manuscript.versions.get(a.versionId);if(!b)throw Error(`Version ${a.versionId} not found`);let c=this.getChaptersInOrder(b);switch(a.format){case"txt":return this.exportAsText(c,a);case"markdown":return this.exportAsMarkdown(c,a);case"docx":return this.exportAsDocx(c,a);case"pdf":return this.exportAsPdf(c,a);default:throw Error(`Unsupported export format: ${a.format}`)}}async generateComparisonReport(a,b){let c=this.manuscript.versions.get(a),d=this.manuscript.versions.get(b);if(!c||!d)throw Error("One or both versions not found");let e=`# Version Comparison Report

`;e+=`**Base Version:** ${c.name}
**Compare Version:** ${d.name}
**Generated:** ${new Date().toISOString()}

## Chapter Order Changes

`;let f=c.chapterOrder,g=d.chapterOrder;if(JSON.stringify(f)===JSON.stringify(g))e+="*No chapter order changes*\n\n";else{e+="| Position | Base Version | Compare Version |\n|----------|--------------|----------------|\n";let a=Math.max(f.length,g.length);for(let b=0;b<a;b++){let a=f[b]?this.getChapterTitle(f[b]):"-",c=g[b]?this.getChapterTitle(g[b]):"-";e+=`| ${b+1} | ${a} | ${c} |
`}e+="\n"}return e+=`## Summary

- **Base version chapters:** ${f.length}
- **Compare version chapters:** ${g.length}
- **Changes made:** ${d.changes.length}

`,d.changes.length>0&&(e+=`## Change Log

`,d.changes.forEach((a,b)=>{e+=`${b+1}. **${a.type}**: ${a.description}
   - *${a.timestamp.toISOString()}*
`})),e}getChaptersInOrder(a){return a.chapterOrder.map(a=>this.manuscript.content.chapters.find(b=>b.id===a)).filter(Boolean)}async exportAsText(a,b){let c="",d=b.customTitle||this.manuscript.metadata.title,e=b.customAuthor||this.manuscript.metadata.author;return c+=`${d.toUpperCase()}
by ${e}

${this.manuscript.metadata.wordCount.toLocaleString()} words

`,b.includeOutline&&(c+="OUTLINE\n=======\n\n",a.forEach((a,b)=>{c+=`Chapter ${b+1}: ${a.title}
`,a.metadata.majorEvents.length>0&&(c+=`   Events: ${a.metadata.majorEvents.join(", ")}
`)}),c+="\n\n"),a.forEach((a,d)=>{b.pageBreakBetweenChapters&&d>0&&(c+="\f"),c+=`Chapter ${d+1}: ${a.title}

`+a.content+"\n\n"}),b.includeMetadata&&(c+=`

METADATA
=========

Genre: ${this.manuscript.metadata.genre}
Total Word Count: ${this.manuscript.metadata.wordCount.toLocaleString()}
Chapter Count: ${a.length}
Version: ${this.manuscript.versions.get(b.versionId)?.name}
Last Modified: ${this.manuscript.metadata.lastModified.toISOString()}
`),new Blob([c],{type:"text/plain;charset=utf-8"})}async exportAsMarkdown(a,b){let c="",d=b.customTitle||this.manuscript.metadata.title,e=b.customAuthor||this.manuscript.metadata.author;return c+=`# ${d}

**by ${e}**

*${this.manuscript.metadata.wordCount.toLocaleString()} words*

`,b.includeOutline&&(c+="## Outline\n\n",a.forEach((a,b)=>{c+=`${b+1}. **${a.title}** _(${a.wordCount} words)_
`,a.metadata.majorEvents.length>0&&(c+=`   - Events: ${a.metadata.majorEvents.join(", ")}
`)}),c+="\n---\n\n"),a.forEach((a,d)=>{b.pageBreakBetweenChapters&&d>0&&(c+='\n<div style="page-break-before: always;"></div>\n\n'),c+=`## Chapter ${d+1}: ${a.title}

`,b.includeNotes&&(a.metadata.pov||a.metadata.location.length>0)&&(c+="> **Chapter Details:**\n",a.metadata.pov&&(c+=`> - POV: ${a.metadata.pov}
`),a.metadata.location.length>0&&(c+=`> - Location: ${a.metadata.location.join(", ")}
`),a.metadata.tensionLevel&&(c+=`> - Tension Level: ${a.metadata.tensionLevel}/10
`),c+="\n"),c+=a.content+"\n\n"}),b.includeMetadata&&(c+=`---

## Manuscript Details

- **Genre:** ${this.manuscript.metadata.genre}
- **Total Word Count:** ${this.manuscript.metadata.wordCount.toLocaleString()}
- **Chapter Count:** ${a.length}
- **Version:** ${this.manuscript.versions.get(b.versionId)?.name}
- **Last Modified:** ${this.manuscript.metadata.lastModified.toLocaleDateString()}
`),new Blob([c],{type:"text/markdown;charset=utf-8"})}async exportAsDocx(a,b){let c=`
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>${b.customTitle||this.manuscript.metadata.title}</title>
    <style>
        body {
            font-family: ${b.fontFamily||"Times New Roman"}, serif;
            font-size: ${b.fontSize||12}pt;
            line-height: ${b.lineSpacing||2};
            margin: ${b.margins?.top||1}in ${b.margins?.right||1}in ${b.margins?.bottom||1}in ${b.margins?.left||1}in;
            color: black;
        }
        .title-page {
            text-align: center;
            page-break-after: always;
            margin-top: 3in;
        }
        .title {
            font-size: 24pt;
            font-weight: bold;
            margin-bottom: 2in;
        }
        .author {
            font-size: 18pt;
            margin-bottom: 1in;
        }
        .wordcount {
            font-size: 12pt;
            font-style: italic;
        }
        .chapter-title {
            text-align: center;
            font-weight: bold;
            margin-top: 1in;
            margin-bottom: 0.5in;
            page-break-before: ${b.pageBreakBetweenChapters?"always":"auto"};
        }
        .chapter-content {
            text-align: left;
            text-indent: 0.5in;
        }
        .outline {
            page-break-after: always;
        }
        .metadata {
            page-break-before: always;
            font-size: 10pt;
        }
        p {
            margin-bottom: 12pt;
            text-indent: 0.5in;
        }
        p:first-child {
            text-indent: 0;
        }
    </style>
</head>
<body>
`,d=b.customTitle||this.manuscript.metadata.title,e=b.customAuthor||this.manuscript.metadata.author;return c+=`
    <div class="title-page">
        <div class="title">${d}</div>
        <div class="author">by ${e}</div>
        <div class="wordcount">${this.manuscript.metadata.wordCount.toLocaleString()} words</div>
    </div>
`,b.includeOutline&&(c+='<div class="outline"><h2>Outline</h2><ul>',a.forEach((a,b)=>{c+=`<li><strong>Chapter ${b+1}: ${a.title}</strong> (${a.wordCount} words)`,a.metadata.majorEvents.length>0&&(c+=`<br><em>Events: ${a.metadata.majorEvents.join(", ")}</em>`),c+="</li>"}),c+="</ul></div>"),a.forEach((a,b)=>{c+=`<div class="chapter-title">Chapter ${b+1}: ${a.title}</div><div class="chapter-content">`,a.content.split("\n\n").forEach(a=>{a.trim()&&(c+=`<p>${a.trim()}</p>`)}),c+="</div>"}),b.includeMetadata&&(c+=`
      <div class="metadata">
          <h3>Manuscript Details</h3>
          <p><strong>Genre:</strong> ${this.manuscript.metadata.genre}</p>
          <p><strong>Total Word Count:</strong> ${this.manuscript.metadata.wordCount.toLocaleString()}</p>
          <p><strong>Chapter Count:</strong> ${a.length}</p>
          <p><strong>Version:</strong> ${this.manuscript.versions.get(b.versionId)?.name}</p>
          <p><strong>Last Modified:</strong> ${this.manuscript.metadata.lastModified.toLocaleDateString()}</p>
      </div>
`),new Blob([c+="</body></html>"],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})}async exportAsPdf(a,b){let c=`
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>${b.customTitle||this.manuscript.metadata.title}</title>
    <style>
        @page {
            size: 8.5in 11in;
            margin: ${b.margins?.top||1}in ${b.margins?.right||1}in ${b.margins?.bottom||1}in ${b.margins?.left||1}in;
        }
        
        body {
            font-family: ${b.fontFamily||"Times New Roman"}, serif;
            font-size: ${b.fontSize||12}pt;
            line-height: ${b.lineSpacing||1.5};
            color: black;
            margin: 0;
            padding: 0;
        }
        
        .title-page {
            text-align: center;
            page-break-after: always;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .title {
            font-size: 24pt;
            font-weight: bold;
            margin-bottom: 2in;
        }
        
        .author {
            font-size: 18pt;
            margin-bottom: 1in;
        }
        
        .wordcount {
            font-size: 12pt;
            font-style: italic;
        }
        
        .chapter-title {
            text-align: center;
            font-weight: bold;
            font-size: 16pt;
            margin-top: 1in;
            margin-bottom: 0.5in;
            page-break-before: ${b.pageBreakBetweenChapters?"always":"auto"};
        }
        
        .chapter-content {
            text-align: justify;
            hyphens: auto;
        }
        
        .chapter-content p {
            margin-bottom: 12pt;
            text-indent: 0.5in;
        }
        
        .chapter-content p:first-child {
            text-indent: 0;
        }
        
        .outline {
            page-break-after: always;
        }
        
        .metadata {
            page-break-before: always;
            font-size: 10pt;
        }
        
        h1, h2, h3 {
            font-weight: bold;
        }
        
        .page-number::after {
            content: counter(page);
        }
        
        @media print {
            body {
                -webkit-print-color-adjust: exact;
            }
        }
    </style>
</head>
<body>
`,d=b.customTitle||this.manuscript.metadata.title,e=b.customAuthor||this.manuscript.metadata.author;return c+=`
    <div class="title-page">
        <div class="title">${d}</div>
        <div class="author">by ${e}</div>
        <div class="wordcount">${this.manuscript.metadata.wordCount.toLocaleString()} words</div>
    </div>
`,b.includeOutline&&(c+='<div class="outline"><h2>Outline</h2><ol>',a.forEach((a,b)=>{c+=`<li><strong>${a.title}</strong> (${a.wordCount} words)`,a.metadata.majorEvents.length>0&&(c+=`<br><em>Key events: ${a.metadata.majorEvents.join(", ")}</em>`),c+="</li>"}),c+="</ol></div>"),a.forEach((a,b)=>{c+=`<div class="chapter-title">Chapter ${b+1}: ${a.title}</div><div class="chapter-content">`,a.content.split("\n\n").forEach(a=>{a.trim()&&(c+=`<p>${a.trim()}</p>`)}),c+="</div>"}),b.includeMetadata&&(c+=`
      <div class="metadata">
          <h3>Publication Details</h3>
          <p><strong>Genre:</strong> ${this.manuscript.metadata.genre}</p>
          <p><strong>Word Count:</strong> ${this.manuscript.metadata.wordCount.toLocaleString()}</p>
          <p><strong>Chapters:</strong> ${a.length}</p>
          <p><strong>Version:</strong> ${this.manuscript.versions.get(b.versionId)?.name}</p>
          <p><strong>Prepared:</strong> ${new Date().toLocaleDateString()}</p>
      </div>
`),new Blob([c+="</body></html>"],{type:"application/pdf"})}getChapterTitle(a){let b=this.manuscript.content.chapters.find(b=>b.id===a);return b?b.title:`Chapter ${a}`}async getExportStats(a){var b;let c,d,e=this.manuscript.versions.get(a.versionId);if(!e)throw Error(`Version ${a.versionId} not found`);let f=this.getChaptersInOrder(e).map(a=>a.content).join(" "),g=f.split(/\s+/).length,h=f.length;switch(a.format){case"txt":c=1.1*h,d=Math.ceil(g/250);break;case"markdown":c=1.2*h,d=Math.ceil(g/250);break;case"docx":c=3*h,d=Math.ceil(g/250);break;case"pdf":c=5*h,d=Math.ceil(g/250);break;default:c=h,d=Math.ceil(g/250)}return{estimatedFileSize:(b=c)<1024?`${b} B`:b<1048576?`${(b/1024).toFixed(1)} KB`:`${(b/1048576).toFixed(1)} MB`,pageCount:d,wordCount:g,characterCount:h}}}class ad{constructor(){this.metrics={},this.timers=new Map,this.sessionStart=Date.now(),this.keystrokeBuffer=[],this.memoryHistory=[],this.initializeBenchmarks(),this.startPeriodicMonitoring()}initializeBenchmarks(){this.benchmarks={excellent:{editorLoadTime:1e3,averageTypingLatency:16,chapterSwitchTime:300,saveOperationTime:200,reorderOperationTime:500,consistencyCheckTime:1e3,exportOperationTime:2e3,memoryUsage:50,keystrokesPerMinute:300,wordsWrittenPerHour:1e3,editingEfficiency:.9},good:{editorLoadTime:2e3,averageTypingLatency:33,chapterSwitchTime:600,saveOperationTime:500,reorderOperationTime:1e3,consistencyCheckTime:2e3,exportOperationTime:5e3,memoryUsage:100,keystrokesPerMinute:200,wordsWrittenPerHour:750,editingEfficiency:.75},acceptable:{editorLoadTime:3e3,averageTypingLatency:50,chapterSwitchTime:1e3,saveOperationTime:1e3,reorderOperationTime:2e3,consistencyCheckTime:3e3,exportOperationTime:8e3,memoryUsage:150,keystrokesPerMinute:150,wordsWrittenPerHour:500,editingEfficiency:.6},poor:{editorLoadTime:5e3,averageTypingLatency:100,chapterSwitchTime:2e3,saveOperationTime:2e3,reorderOperationTime:4e3,consistencyCheckTime:5e3,exportOperationTime:15e3,memoryUsage:250,keystrokesPerMinute:100,wordsWrittenPerHour:250,editingEfficiency:.4}}}startPeriodicMonitoring(){setInterval(()=>{this.recordMemoryUsage()},3e4),setInterval(()=>{this.calculateDerivedMetrics()},6e4)}startTimer(a){this.timers.set(a,performance.now())}endTimer(a){let b=this.timers.get(a);if(!b)return console.warn(`Timer for operation '${a}' was not started`),0;let c=performance.now()-b;return this.timers.delete(a),c}recordEditorLoad(){let a=this.endTimer("editorLoad");this.metrics.editorLoadTime=a}recordTypingLatency(a){this.metrics.averageTypingLatency?this.metrics.averageTypingLatency=.9*this.metrics.averageTypingLatency+.1*a:this.metrics.averageTypingLatency=a}recordKeystroke(){let a=Date.now();this.keystrokeBuffer.push(a);let b=a-6e4;this.keystrokeBuffer=this.keystrokeBuffer.filter(a=>a>b)}recordMemoryUsage(){if("memory"in performance){let a=performance.memory.usedJSHeapSize/1024/1024;if(this.metrics.memoryUsage=a,this.memoryHistory.push(a),this.memoryHistory.length>20&&this.memoryHistory.shift(),(!this.metrics.memoryPeak||a>this.metrics.memoryPeak)&&(this.metrics.memoryPeak=a),this.memoryHistory.length>=3){let a=this.memoryHistory.slice(-3),b=this.calculateMemoryTrend(a);this.metrics.memoryTrend=b}}}calculateMemoryTrend(a){if(a.length<2)return"stable";let b=[];for(let c=1;c<a.length;c++)b.push(a[c]-a[c-1]);let c=b.reduce((a,b)=>a+b,0)/b.length;return 1>Math.abs(c)?"stable":c>0?"increasing":"decreasing"}recordChapterSwitch(){let a=this.endTimer("chapterSwitch");return this.metrics.chapterSwitchTime=a,a}recordSaveOperation(){let a=this.endTimer("saveOperation");this.metrics.saveOperationTime=a;let b=Date.now()-this.sessionStart;return this.metrics.saveFrequency=b/(this.metrics.saveFrequency||1),a}recordReorderOperation(){let a=this.endTimer("reorderOperation");return this.metrics.reorderOperationTime=a,this.metrics.reorderOperationsPerSession=(this.metrics.reorderOperationsPerSession||0)+1,a}recordConsistencyCheck(){let a=this.endTimer("consistencyCheck");return this.metrics.consistencyCheckTime=a,a}recordExportOperation(){let a=this.endTimer("exportOperation");return this.metrics.exportOperationTime=a,a}recordError(a){this.metrics.errorCount=(this.metrics.errorCount||0)+1,console.error("Performance Monitor - Error recorded:",a)}recordWarning(a){this.metrics.warningCount=(this.metrics.warningCount||0)+1,console.warn("Performance Monitor - Warning recorded:",a)}recordCrash(){this.metrics.crashCount=(this.metrics.crashCount||0)+1}recordWordsWritten(a){let b=(Date.now()-this.sessionStart)/36e5;this.metrics.wordsWrittenPerHour=a/b}recordModeSwitch(a){if(Date.now(),"edit"===a)this.startTimer("editMode");else if("reorder"===a){if(this.startTimer("reorderMode"),this.timers.has("editMode")){let a=this.endTimer("editMode");this.metrics.timeInEditMode=(this.metrics.timeInEditMode||0)+a}}else{if(this.timers.has("editMode")){let a=this.endTimer("editMode");this.metrics.timeInEditMode=(this.metrics.timeInEditMode||0)+a}if(this.timers.has("reorderMode")){let a=this.endTimer("reorderMode");this.metrics.timeInReorderMode=(this.metrics.timeInReorderMode||0)+a}}}calculateDerivedMetrics(){if(this.metrics.keystrokesPerMinute=this.keystrokeBuffer.length,this.metrics.timeInEditMode&&this.metrics.wordsWrittenPerHour){let a=this.metrics.timeInEditMode/36e5;this.metrics.editingEfficiency=this.metrics.wordsWrittenPerHour*a/1e3}}getMetrics(){return this.recordMemoryUsage(),this.calculateDerivedMetrics(),this.metrics}getBenchmarkLevel(a,b){let c=this.benchmarks.excellent[a],d=this.benchmarks.good[a],e=this.benchmarks.acceptable[a];return a.includes("Time")||a.includes("Latency")||"memoryUsage"===a?b<=c?"excellent":b<=d?"good":b<=e?"acceptable":"poor":b>=c?"excellent":b>=d?"good":b>=e?"acceptable":"poor"}generateRecommendations(){let a=this.getMetrics(),b=[];return a.editorLoadTime&&a.editorLoadTime>3e3&&b.push("\uD83D\uDC0C Editor load time is slow. Consider reducing initial bundle size or enabling code splitting."),a.averageTypingLatency&&a.averageTypingLatency>50&&b.push("⌨️ Typing latency is high. Consider debouncing operations or optimizing editor extensions."),a.memoryUsage&&a.memoryUsage>150&&b.push("\uD83E\uDDE0 Memory usage is high. Check for memory leaks in editor or store."),"increasing"===a.memoryTrend&&b.push("\uD83D\uDCC8 Memory usage is increasing over time. Monitor for potential memory leaks."),a.chapterSwitchTime&&a.chapterSwitchTime>1e3&&b.push("\uD83D\uDCC4 Chapter switching is slow. Consider preloading or optimizing chapter loading."),a.saveOperationTime&&a.saveOperationTime>1e3&&b.push("\uD83D\uDCBE Save operations are slow. Consider optimizing data serialization."),a.reorderOperationTime&&a.reorderOperationTime>2e3&&b.push("\uD83D\uDD04 Chapter reordering is slow. Consider optimizing drag-and-drop implementation."),a.consistencyCheckTime&&a.consistencyCheckTime>3e3&&b.push("\uD83D\uDD0D Consistency checking is slow. Consider optimizing analysis algorithms."),a.exportOperationTime&&a.exportOperationTime>1e4&&b.push("\uD83D\uDCE4 Export operations are slow. Consider implementing background processing."),a.errorCount&&a.errorCount>5&&b.push("❌ High error count detected. Review error logs and implement fixes."),a.editingEfficiency&&a.editingEfficiency<.5&&b.push("⚡ Editing efficiency is low. Consider simplifying the interface or adding productivity features."),a.keystrokesPerMinute&&a.keystrokesPerMinute<50&&b.push("\uD83C\uDFAF Low activity detected. Consider adding engagement features or reducing friction."),0===b.length&&b.push("✅ All performance metrics are within acceptable ranges. Great job!"),b}generateReport(){let a=this.getMetrics(),b=a=>a?`${a.toFixed(2)}ms`:"N/A",c=a=>a?`${a.toFixed(2)}MB`:"N/A",d=a=>a?a.toFixed(2):"N/A",e=(a,b)=>{if(!b)return"❓";switch(this.getBenchmarkLevel(a,b)){case"excellent":return"\uD83D\uDFE2";case"good":return"\uD83D\uDFE1";case"acceptable":return"\uD83D\uDFE0";case"poor":return"\uD83D\uDD34"}};return`
# Performance Report

## ⏱️ Timing Metrics
- **Editor Load Time:** ${b(a.editorLoadTime)} ${e("editorLoadTime",a.editorLoadTime)}
- **Average Typing Latency:** ${b(a.averageTypingLatency)} ${e("averageTypingLatency",a.averageTypingLatency)}
- **Chapter Switch Time:** ${b(a.chapterSwitchTime)} ${e("chapterSwitchTime",a.chapterSwitchTime)}
- **Save Operation Time:** ${b(a.saveOperationTime)} ${e("saveOperationTime",a.saveOperationTime)}
- **Reorder Operation Time:** ${b(a.reorderOperationTime)} ${e("reorderOperationTime",a.reorderOperationTime)}
- **Consistency Check Time:** ${b(a.consistencyCheckTime)} ${e("consistencyCheckTime",a.consistencyCheckTime)}
- **Export Operation Time:** ${b(a.exportOperationTime)} ${e("exportOperationTime",a.exportOperationTime)}

## 🧠 Memory Metrics
- **Current Memory Usage:** ${c(a.memoryUsage)} ${e("memoryUsage",a.memoryUsage)}
- **Peak Memory Usage:** ${c(a.memoryPeak)}
- **Memory Trend:** ${a.memoryTrend||"Unknown"} ${"stable"===a.memoryTrend?"\uD83D\uDFE2":"increasing"===a.memoryTrend?"\uD83D\uDD34":"\uD83D\uDFE1"}

## 📊 Productivity Metrics
- **Keystrokes Per Minute:** ${d(a.keystrokesPerMinute)} ${e("keystrokesPerMinute",a.keystrokesPerMinute)}
- **Words Written Per Hour:** ${d(a.wordsWrittenPerHour)} ${e("wordsWrittenPerHour",a.wordsWrittenPerHour)}
- **Editing Efficiency:** ${d(a.editingEfficiency)} ${e("editingEfficiency",a.editingEfficiency)}
- **Time in Edit Mode:** ${b(a.timeInEditMode)}
- **Time in Reorder Mode:** ${b(a.timeInReorderMode)}

## 🔧 System Health
- **Error Count:** ${a.errorCount||0}
- **Warning Count:** ${a.warningCount||0}
- **Crash Count:** ${a.crashCount||0}

## 💡 Recommendations

${this.generateRecommendations().map(a=>`- ${a}`).join("\n")}

---
*Report generated at ${new Date().toISOString()}*
    `.trim()}reset(){this.metrics={},this.timers.clear(),this.sessionStart=Date.now(),this.keystrokeBuffer=[],this.memoryHistory=[]}exportMetrics(){return JSON.stringify(this.metrics,null,2)}importMetrics(a){try{this.metrics=JSON.parse(a)}catch(a){console.error("Failed to import metrics:",a)}}}let ae=new ad;ae.startTimer("editorLoad");let af=(0,_.vt)()((0,aa.lt)((0,aa.Zr)((a,b)=>({manuscript:null,isLoading:!1,error:null,currentVersion:null,availableVersions:[],isComparingVersions:!1,comparisonResult:null,activeChapterId:null,editorMode:"edit",unsavedChanges:!1,consistencyReport:null,consistencyCheckEnabled:!0,actions:{initialize:async()=>{a({isLoading:!0,error:null});try{{let b={id:"default",metadata:{title:"New Manuscript",author:"Author Name",genre:"techno-thriller",wordCount:0,characterCount:0,chapterCount:0,lastModified:new Date,created:new Date,version:"1.0.0"},content:{chapters:[],characters:[],locations:[],techConcepts:[],timeline:[],notes:[]},versions:new Map,currentVersionId:"original",settings:{autoSave:!0,autoSaveInterval:30,showWordCount:!0,showCharacterCount:!0,enableConsistencyChecking:!0,highlightInconsistencies:!0,defaultView:"editor"}},c={id:"original",name:"Original",description:"Original chapter order",chapterOrder:[],created:new Date,isBaseVersion:!0,changes:[]};b.versions.set("original",c),a({manuscript:b,currentVersion:c,availableVersions:[c],activeChapterId:null,isLoading:!1,error:null});return}}catch(b){console.error("Failed to initialize manuscript:",b),a({error:b instanceof Error?b.message:"Failed to initialize manuscript",isLoading:!1})}},updateChapterContent:(c,d)=>{let e=b();if(!e.manuscript)return;let f=e.manuscript.content.chapters.find(a=>a.id===c);if(f){f.content=d,f.wordCount=d.split(/\s+/).filter(a=>a.length>0).length;let b=e.manuscript.content.chapters.reduce((a,b)=>a+b.wordCount,0),c=e.manuscript.content.chapters.reduce((a,b)=>a+b.content.length,0);a({manuscript:{...e.manuscript,metadata:{...e.manuscript.metadata,wordCount:b,characterCount:c,lastModified:new Date}},unsavedChanges:!0})}},updateChapterMetadata:(c,d)=>{let e=b();if(!e.manuscript)return;let f=e.manuscript.content.chapters.find(a=>a.id===c);f&&(Object.assign(f.metadata,d),a({manuscript:{...e.manuscript,metadata:{...e.manuscript.metadata,lastModified:new Date}},unsavedChanges:!0}))},createVersion:async(c,d)=>{let e=b();if(!e.manuscript||!e.currentVersion)throw Error("No manuscript loaded");let f=`version_${Date.now()}`,g={id:f,name:c,description:d,chapterOrder:[...e.currentVersion.chapterOrder],created:new Date,isBaseVersion:!1,parentVersionId:e.currentVersion.id,changes:[]};return e.manuscript.versions.set(f,g),a({manuscript:e.manuscript,availableVersions:Array.from(e.manuscript.versions.values())}),f},switchVersion:async c=>{let d=b();if(!d.manuscript)return;let e=d.manuscript.versions.get(c);if(!e)throw Error(`Version ${c} not found`);let f=e.chapterOrder.map(a=>d.manuscript.content.chapters.find(b=>b.id===a)).filter(Boolean);f.forEach((a,b)=>{a.currentPosition=b+1}),a({manuscript:{...d.manuscript,currentVersionId:c,content:{...d.manuscript.content,chapters:f}},currentVersion:e})},compareVersions:async(c,d)=>{let e=b();if(!e.manuscript)return;let f=e.manuscript.versions.get(c),g=e.manuscript.versions.get(d);if(!f||!g)throw Error("One or both versions not found");a({comparisonResult:{baseVersion:f,compareVersion:g,differences:[],reorderingAnalysis:{consistencyIssues:[],flowImpact:0,recommendedAdjustments:[],riskLevel:"low"}},isComparingVersions:!0})},reorderChapters:c=>{let d=b();if(!d.manuscript||!d.currentVersion)return;d.currentVersion.chapterOrder=c;let e=c.map(a=>d.manuscript.content.chapters.find(b=>b.id===a)).filter(Boolean);e.forEach((a,b)=>{a.currentPosition=b+1}),a({manuscript:{...d.manuscript,content:{...d.manuscript.content,chapters:e}},unsavedChanges:!0})},previewReordering:async a=>{let c=b();if(!c.manuscript)return{checks:[]};ae.startTimer("reorderPreview");try{let b=new ab(c.manuscript),d=await b.analyzeConsistency(a);return ae.endTimer("reorderPreview"),{checks:d}}catch(a){return ae.endTimer("reorderPreview"),ae.recordError(a),{checks:[]}}},applyReordering:async()=>{await b().actions.runConsistencyCheck(),a({unsavedChanges:!1})},cancelReordering:()=>{let a=b();if(a.currentVersion&&a.manuscript){let c=a.currentVersion.chapterOrder;b().actions.reorderChapters(c)}},runConsistencyCheck:async()=>{let c=b();if(c.manuscript){ae.startTimer("consistencyCheck");try{let b=new ab(c.manuscript),d=await b.analyzeConsistency(),e={timestamp:new Date,checks:d,summary:{total:d.length,errors:d.filter(a=>"error"===a.severity).length,warnings:d.filter(a=>"warning"===a.severity).length,info:d.filter(a=>"info"===a.severity).length}};a({consistencyReport:e}),ae.recordConsistencyCheck()}catch(b){ae.endTimer("consistencyCheck"),ae.recordError(b),a({error:"Consistency check failed"})}}},setActiveChapter:b=>{ae.startTimer("chapterSwitch"),a({activeChapterId:b}),ae.recordChapterSwitch()},setEditorMode:b=>{ae.recordModeSwitch(b),a({editorMode:b})},markSaved:()=>{a({unsavedChanges:!1})},saveManuscript:async()=>{let c=b();if(c.manuscript){ae.startTimer("saveOperation");try{let{invoke:b}=await Promise.resolve().then(function(){var a=Error("Cannot find module '@tauri-apps/api/tauri'");throw a.code="MODULE_NOT_FOUND",a});for(let a of(await b("update_manuscript",{manuscript:{id:c.manuscript.id,title:c.manuscript.metadata.title,author:c.manuscript.metadata.author,genre:c.manuscript.metadata.genre,target_audience:"Adult",comp_titles:"Various",created_at:c.manuscript.metadata.created.getTime(),updated_at:Date.now(),total_word_count:c.manuscript.metadata.wordCount,opening_strength_score:8,hook_effectiveness:7}}),c.manuscript.content.chapters))await b("update_scene",{scene:{id:a.id,chapter_number:a.metadata.chapterNumber,scene_number_in_chapter:a.metadata.sceneNumber,index_in_manuscript:a.currentPosition-1,title:a.title,raw_text:a.content,word_count:a.wordCount,is_opening:a.metadata.isOpening,is_chapter_end:a.metadata.isChapterEnd,opens_with_hook:a.metadata.opensWithHook,ends_with_hook:a.metadata.endsWithHook,pov_character:a.metadata.pov,location:a.metadata.location,time_marker:a.metadata.timeMarker,created_at:Date.now(),updated_at:Date.now()}});a({unsavedChanges:!1,manuscript:{...c.manuscript,metadata:{...c.manuscript.metadata,lastModified:new Date}}}),ae.recordSaveOperation()}catch(a){throw ae.endTimer("saveOperation"),ae.recordError(a),console.error("Save failed:",a),Error("Failed to save manuscript")}}},exportVersion:async(c,d)=>{let e=b();if(e.manuscript){ae.startTimer("exportOperation");try{let a=new ac(e.manuscript),b=await a.exportVersion({format:d,versionId:c,includeMetadata:!0,includeOutline:!0,includeNotes:!1,pageBreakBetweenChapters:!0}),f=URL.createObjectURL(b),g=document.createElement("a");g.href=f,g.download=`${e.manuscript.metadata.title}_${c}.${d}`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(f),ae.recordExportOperation()}catch(b){ae.endTimer("exportOperation"),ae.recordError(b),a({error:`Export failed: ${b}`})}}}}}),{name:"single-manuscript-store",partialize:a=>({manuscript:a.manuscript?function(a){return{...a,versions:Array.from(a.versions.entries())}}(a.manuscript):null,currentVersion:a.currentVersion,availableVersions:a.availableVersions,activeChapterId:a.activeChapterId,editorMode:a.editorMode}),merge:(a,b)=>({...b,...a,manuscript:a.manuscript?function(a){return{...a,versions:new Map(a.versions)}}(a.manuscript):null})}),{name:"single-manuscript-store"}));var ag=c(66249),ah=c(13964),ai=c(65822);let aj=ag.bL,ak=ag.l9;ag.YJ,ag.ZL;let al=ag.Pb;ag.z6;let am=f().forwardRef(({className:a,inset:b,children:c,...e},f)=>(0,d.jsxs)(ag.ZP,{ref:f,className:(0,E.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",b&&"pl-8",a),...e,children:[c,(0,d.jsx)(V.A,{className:"ml-auto h-4 w-4"})]}));am.displayName=ag.ZP.displayName;let an=f().forwardRef(({className:a,...b},c)=>(0,d.jsx)(ag.G5,{ref:c,className:(0,E.cn)("z-[9999] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...b}));an.displayName=ag.G5.displayName;let ao=f().forwardRef(({className:a,sideOffset:b=4,...c},e)=>(0,d.jsx)(ag.ZL,{children:(0,d.jsx)(ag.UC,{ref:e,sideOffset:b,className:(0,E.cn)("z-[9999] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...c})}));ao.displayName=ag.UC.displayName;let ap=f().forwardRef(({className:a,inset:b,...c},e)=>(0,d.jsx)(ag.q7,{ref:e,className:(0,E.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",b&&"pl-8",a),...c}));ap.displayName=ag.q7.displayName,f().forwardRef(({className:a,children:b,checked:c,...e},f)=>(0,d.jsxs)(ag.H_,{ref:f,className:(0,E.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:c,...e,children:[(0,d.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,d.jsx)(ag.VF,{children:(0,d.jsx)(ah.A,{className:"h-4 w-4"})})}),b]})).displayName=ag.H_.displayName,f().forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(ag.hN,{ref:e,className:(0,E.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...c,children:[(0,d.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,d.jsx)(ag.VF,{children:(0,d.jsx)(ai.A,{className:"h-2 w-2 fill-current"})})}),b]})).displayName=ag.hN.displayName,f().forwardRef(({className:a,inset:b,...c},e)=>(0,d.jsx)(ag.JU,{ref:e,className:(0,E.cn)("px-2 py-1.5 text-sm font-semibold",b&&"pl-8",a),...c})).displayName=ag.JU.displayName;let aq=f().forwardRef(({className:a,...b},c)=>(0,d.jsx)(ag.wv,{ref:c,className:(0,E.cn)("-mx-1 my-1 h-px bg-muted",a),...b}));aq.displayName=ag.wv.displayName;let ar=({className:a,...b})=>(0,d.jsx)("span",{className:(0,E.cn)("ml-auto text-xs tracking-widest opacity-60",a),...b});ar.displayName="DropdownMenuShortcut";var as=c(67821),at=c(8819),au=c(28097);function av({className:a}){let{manuscript:b,editorMode:c,unsavedChanges:e}=af(),{saveManuscript:f,setEditorMode:g}=af(a=>a.actions),h=a=>{};return(0,d.jsxs)("div",{className:`bg-background border-b border-border h-8 flex items-center px-2 ${a}`,children:[(0,d.jsxs)("div",{className:"flex items-center gap-1 mr-4",children:[(0,d.jsxs)(y.$,{variant:"reorder"===c?"default":"ghost",size:"sm",onClick:()=>g("reorder"),className:"h-6 px-2 text-xs",children:[(0,d.jsx)(au.A,{className:"h-3 w-3 mr-1"}),"Reorder"]}),(0,d.jsxs)(y.$,{variant:"compare"===c?"default":"ghost",size:"sm",onClick:()=>g("compare"),className:"h-6 px-2 text-xs",children:[(0,d.jsx)(as.A,{className:"h-3 w-3 mr-1"}),"Versions"]}),(0,d.jsxs)(y.$,{variant:"ghost",size:"sm",onClick:f,disabled:!e,className:"h-6 px-2 text-xs",children:[(0,d.jsx)(at.A,{className:"h-3 w-3 mr-1"}),e?"Save":"Saved"]})]}),(0,d.jsxs)(aj,{children:[(0,d.jsx)(ak,{asChild:!0,children:(0,d.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs font-normal",children:"File"})}),(0,d.jsxs)(ao,{align:"start",className:"w-48",children:[(0,d.jsxs)(ap,{onClick:()=>{f()},children:["Save",(0,d.jsx)(ar,{children:"Ctrl+S"})]}),(0,d.jsxs)(ap,{onClick:()=>{prompt("Save as filename:",`${b?.metadata.title||"manuscript"}.txt`)},children:["Save As...",(0,d.jsx)(ar,{children:"Ctrl+Shift+S"})]}),(0,d.jsx)(aq,{}),(0,d.jsxs)(al,{children:[(0,d.jsx)(am,{children:"Export"}),(0,d.jsxs)(an,{className:"w-48",children:[(0,d.jsx)(ap,{onClick:()=>h("pdf"),children:"PDF Document"}),(0,d.jsx)(ap,{onClick:()=>h("docx"),children:"Word Document"}),(0,d.jsx)(ap,{onClick:()=>h("txt"),children:"Plain Text"}),(0,d.jsx)(ap,{onClick:()=>h("epub"),children:"EPUB eBook"})]})]}),(0,d.jsx)(aq,{}),(0,d.jsx)(ap,{onClick:()=>{},children:"Recent Files"}),(0,d.jsx)(aq,{}),(0,d.jsxs)(ap,{onClick:()=>{e?confirm("You have unsaved changes. Are you sure you want to exit?")&&window.close():window.close()},children:["Exit",(0,d.jsx)(ar,{children:"Ctrl+Q"})]})]})]}),(0,d.jsxs)(aj,{children:[(0,d.jsx)(ak,{asChild:!0,children:(0,d.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs font-normal",children:"Edit"})}),(0,d.jsxs)(ao,{align:"start",className:"w-48",children:[(0,d.jsxs)(ap,{onClick:()=>{document.execCommand("undo")},children:["Undo",(0,d.jsx)(ar,{children:"Ctrl+Z"})]}),(0,d.jsxs)(ap,{onClick:()=>{document.execCommand("redo")},children:["Redo",(0,d.jsx)(ar,{children:"Ctrl+Y"})]}),(0,d.jsx)(aq,{}),(0,d.jsxs)(ap,{onClick:()=>{document.execCommand("cut")},children:["Cut",(0,d.jsx)(ar,{children:"Ctrl+X"})]}),(0,d.jsxs)(ap,{onClick:()=>{document.execCommand("copy")},children:["Copy",(0,d.jsx)(ar,{children:"Ctrl+C"})]}),(0,d.jsxs)(ap,{onClick:()=>{document.execCommand("paste")},children:["Paste",(0,d.jsx)(ar,{children:"Ctrl+V"})]}),(0,d.jsx)(aq,{}),(0,d.jsxs)(ap,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-find"))},children:["Find",(0,d.jsx)(ar,{children:"Ctrl+F"})]}),(0,d.jsxs)(ap,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-find-replace"))},children:["Find and Replace",(0,d.jsx)(ar,{children:"Ctrl+H"})]}),(0,d.jsx)(aq,{}),(0,d.jsxs)(ap,{onClick:()=>{document.execCommand("selectAll")},children:["Select All",(0,d.jsx)(ar,{children:"Ctrl+A"})]})]})]}),(0,d.jsxs)(aj,{children:[(0,d.jsx)(ak,{asChild:!0,children:(0,d.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs font-normal",children:"View"})}),(0,d.jsxs)(ao,{align:"start",className:"w-48",children:[(0,d.jsxs)(ap,{onClick:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},children:["Full Screen",(0,d.jsx)(ar,{children:"F11"})]}),(0,d.jsxs)(ap,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-toggle-focus-mode"))},children:["Focus Mode",(0,d.jsx)(ar,{children:"Ctrl+Shift+F"})]}),(0,d.jsxs)(ap,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-toggle-typewriter-mode"))},children:["Typewriter Mode",(0,d.jsx)(ar,{children:"Ctrl+Shift+T"})]}),(0,d.jsx)(aq,{}),(0,d.jsxs)(ap,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-toggle-sidebar"))},children:["Show Sidebar",(0,d.jsx)(ar,{children:"Ctrl+\\\\"})]}),(0,d.jsxs)(ap,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-toggle-properties"))},children:["Show Properties",(0,d.jsx)(ar,{children:"Ctrl+;"})]}),(0,d.jsx)(aq,{}),(0,d.jsxs)(ap,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-zoom-in"))},children:["Zoom In",(0,d.jsx)(ar,{children:"Ctrl++"})]}),(0,d.jsxs)(ap,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-zoom-out"))},children:["Zoom Out",(0,d.jsx)(ar,{children:"Ctrl+-"})]}),(0,d.jsxs)(ap,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-reset-zoom"))},children:["Reset Zoom",(0,d.jsx)(ar,{children:"Ctrl+0"})]})]})]}),(0,d.jsxs)(aj,{children:[(0,d.jsx)(ak,{asChild:!0,children:(0,d.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs font-normal",children:"Tools"})}),(0,d.jsxs)(ao,{align:"start",className:"w-48",children:[(0,d.jsxs)(ap,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-ai-analysis"))},children:["AI Analysis",(0,d.jsx)(ar,{children:"Ctrl+Shift+A"})]}),(0,d.jsxs)(ap,{onClick:()=>{},children:["Story Structure",(0,d.jsx)(ar,{children:"Ctrl+Shift+S"})]}),(0,d.jsxs)(ap,{onClick:()=>{},children:["Character Analysis",(0,d.jsx)(ar,{children:"Ctrl+Shift+C"})]}),(0,d.jsx)(aq,{}),(0,d.jsxs)(ap,{onClick:()=>{let a=(b?.content.chapters.reduce((a,b)=>a+b.content,"")||"").split(/\s+/).filter(a=>a.length>0).length;alert(`Word count: ${a}`)},children:["Word Count",(0,d.jsx)(ar,{children:"Ctrl+Shift+W"})]}),(0,d.jsx)(ap,{onClick:()=>{let a=Math.ceil((b?.content.chapters.reduce((a,b)=>a+b.content,"")||"").split(/\s+/).filter(a=>a.length>0).length/250);alert(`Estimated reading time: ${a} minutes`)},children:"Reading Time"}),(0,d.jsx)(aq,{}),(0,d.jsxs)(ap,{onClick:()=>{},children:["Spell Check",(0,d.jsx)(ar,{children:"F7"})]}),(0,d.jsx)(ap,{onClick:()=>{},children:"Grammar Check"})]})]}),(0,d.jsxs)(aj,{children:[(0,d.jsx)(ak,{asChild:!0,children:(0,d.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs font-normal",children:"Help"})}),(0,d.jsxs)(ao,{align:"start",className:"w-48",children:[(0,d.jsxs)(ap,{onClick:()=>{alert(`Keyboard Shortcuts:
    
File:
• Ctrl+S - Save
• Ctrl+Shift+S - Save As

Edit:
• Ctrl+Z - Undo
• Ctrl+Y - Redo
• Ctrl+X - Cut
• Ctrl+C - Copy
• Ctrl+V - Paste
• Ctrl+F - Find
• Ctrl+H - Find & Replace
• Ctrl+A - Select All

View:
• F11 - Full Screen
• Ctrl+Shift+F - Focus Mode
• Ctrl+Shift+T - Typewriter Mode

Tools:
• Ctrl+Shift+A - AI Analysis
• Ctrl+Shift+W - Word Count
• F7 - Spell Check`)},children:["Keyboard Shortcuts",(0,d.jsx)(ar,{children:"F1"})]}),(0,d.jsx)(ap,{onClick:()=>{window.open("/help","_blank")},children:"User Guide"}),(0,d.jsx)(aq,{}),(0,d.jsx)(ap,{onClick:()=>{alert("You are using the latest version of Narrative Surgeon.")},children:"Check for Updates"}),(0,d.jsx)(ap,{onClick:()=>{alert(`Narrative Surgeon - Chapter Reordering Editor
Version 1.0.0

A professional manuscript editor for chapter reordering and consistency checking.

\xa9 2024 Narrative Surgeon`)},children:"About Narrative Surgeon"})]})]}),(0,d.jsx)("div",{className:"flex-1 text-center text-xs text-muted-foreground",children:b?b.metadata.title:"Narrative Surgeon"}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)("div",{className:"w-3 h-3 rounded-full bg-yellow-400"}),(0,d.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-400"}),(0,d.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-400"})]})]})}var aw=c(80051),ax=c(95999),ay=c(8366),az=c(27777),aA=c(78272),aB=c(13861),aC=c(12597),aD=c(27063),aE=c(11922),aF=c(25366),aG=c(14290),aH=c(17740),aI=c(98971),aJ=c(98916),aK=c(69282),aL=c(44692),aM=c(45583);function aN({editor:a,className:b}){let{unsavedChanges:c,saveCurrentScene:e,editorSettings:f,updateEditorSettings:g}=(0,$.C)(),h=async()=>{try{await e()}catch(a){console.error("Failed to save:",a)}},i=b=>{a?.chain().focus().setTextAlign(b).run()};return(0,d.jsxs)("div",{className:`bg-background border-b border-border px-2 py-1.5 flex items-center gap-1 ${b}`,children:[(0,d.jsxs)(y.$,{variant:c?"default":"ghost",size:"sm",onClick:h,disabled:!c,className:"h-7",children:[(0,d.jsx)(at.A,{className:"w-3.5 h-3.5 mr-1"}),"Save"]}),(0,d.jsx)(M,{orientation:"vertical",className:"h-6 mx-1"}),(0,d.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>a?.chain().focus().toggleBold().run(),className:`h-7 w-7 p-0 ${a?.isActive("bold")?"bg-accent":""}`,title:"Bold (Ctrl+B)",children:(0,d.jsx)(az.A,{className:"w-3.5 h-3.5"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>a?.chain().focus().toggleItalic().run(),className:`h-7 w-7 p-0 ${a?.isActive("italic")?"bg-accent":""}`,title:"Italic (Ctrl+I)",children:(0,d.jsx)(aE.A,{className:"w-3.5 h-3.5"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>a?.chain().focus().toggleUnderline().run(),className:`h-7 w-7 p-0 ${a?.isActive("underline")?"bg-accent":""}`,title:"Underline (Ctrl+U)",children:(0,d.jsx)(aL.A,{className:"w-3.5 h-3.5"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>a?.chain().focus().toggleHighlight().run(),className:`h-7 w-7 p-0 ${a?.isActive("highlight")?"bg-accent":""}`,title:"Highlight",children:(0,d.jsx)(aD.A,{className:"w-3.5 h-3.5"})})]}),(0,d.jsx)(M,{orientation:"vertical",className:"h-6 mx-1"}),(0,d.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>i("left"),className:`h-7 w-7 p-0 ${a?.isActive({textAlign:"left"})?"bg-accent":""}`,title:"Align Left",children:(0,d.jsx)(ax.A,{className:"w-3.5 h-3.5"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>i("center"),className:`h-7 w-7 p-0 ${a?.isActive({textAlign:"center"})?"bg-accent":""}`,title:"Align Center",children:(0,d.jsx)(aw.A,{className:"w-3.5 h-3.5"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>i("right"),className:`h-7 w-7 p-0 ${a?.isActive({textAlign:"right"})?"bg-accent":""}`,title:"Align Right",children:(0,d.jsx)(ay.A,{className:"w-3.5 h-3.5"})})]}),(0,d.jsx)(M,{orientation:"vertical",className:"h-6 mx-1"}),(0,d.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>a?.chain().focus().toggleBulletList().run(),className:`h-7 w-7 p-0 ${a?.isActive("bulletList")?"bg-accent":""}`,title:"Bullet List",children:(0,d.jsx)(aF.A,{className:"w-3.5 h-3.5"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>a?.chain().focus().toggleOrderedList().run(),className:`h-7 w-7 p-0 ${a?.isActive("orderedList")?"bg-accent":""}`,title:"Numbered List",children:(0,d.jsx)(aG.A,{className:"w-3.5 h-3.5"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>a?.chain().focus().toggleBlockquote().run(),className:`h-7 w-7 p-0 ${a?.isActive("blockquote")?"bg-accent":""}`,title:"Quote",children:(0,d.jsx)(aJ.A,{className:"w-3.5 h-3.5"})})]}),(0,d.jsx)(M,{orientation:"vertical",className:"h-6 mx-1"}),(0,d.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>{a?.chain().focus().insertSceneBreak().run()},className:"h-7 px-2",title:"Insert Scene Break (Ctrl+Shift+Enter)",children:"***"}),(0,d.jsxs)(aj,{children:[(0,d.jsx)(ak,{asChild:!0,children:(0,d.jsxs)(y.$,{variant:"ghost",size:"sm",className:"h-7 px-2",children:["Chapter",(0,d.jsx)(aA.A,{className:"w-3 h-3 ml-1"})]})}),(0,d.jsxs)(ao,{align:"start",children:[(0,d.jsx)(ap,{onClick:()=>a?.chain().focus().insertChapterDivision({number:1}).run(),children:"New Chapter"}),(0,d.jsx)(ap,{children:"Part Division"})]})]})]}),(0,d.jsx)(M,{orientation:"vertical",className:"h-6 mx-1"}),(0,d.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,d.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",title:"Find (Ctrl+F)",children:(0,d.jsx)(Y.A,{className:"w-3.5 h-3.5"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>{g({focusMode:!f.focusMode})},className:`h-7 w-7 p-0 ${f.focusMode?"bg-accent":""}`,title:"Focus Mode",children:f.focusMode?(0,d.jsx)(aC.A,{className:"w-3.5 h-3.5"}):(0,d.jsx)(aB.A,{className:"w-3.5 h-3.5"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",title:"Full Screen (F11)",children:(0,d.jsx)(aH.A,{className:"w-3.5 h-3.5"})})]}),(0,d.jsx)(M,{orientation:"vertical",className:"h-6 mx-1"}),(0,d.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,d.jsxs)(y.$,{variant:"ghost",size:"sm",className:"h-7 px-2",title:"AI Analysis (Ctrl+Shift+A)",children:[(0,d.jsx)(aM.A,{className:"w-3.5 h-3.5 mr-1"}),"AI"]}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",title:"Comments",children:(0,d.jsx)(X.A,{className:"w-3.5 h-3.5"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",title:"Statistics",children:(0,d.jsx)(S.A,{className:"w-3.5 h-3.5"})})]}),(0,d.jsx)("div",{className:"flex-1"}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsxs)(aj,{children:[(0,d.jsx)(ak,{asChild:!0,children:(0,d.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",title:"Text Color",children:(0,d.jsx)(aI.A,{className:"w-3.5 h-3.5"})})}),(0,d.jsx)(ao,{align:"end",children:(0,d.jsx)("div",{className:"grid grid-cols-6 gap-1 p-2",children:["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#008000","#000080","#808080"].map(b=>(0,d.jsx)("button",{className:"w-6 h-6 rounded border border-border hover:scale-110 transition-transform",style:{backgroundColor:b},onClick:()=>a?.chain().focus().setColor(b).run(),title:b},b))})})]}),(0,d.jsxs)(aj,{children:[(0,d.jsx)(ak,{asChild:!0,children:(0,d.jsxs)(y.$,{variant:"ghost",size:"sm",className:"h-7 px-2",children:[(0,d.jsx)(aK.A,{className:"w-3.5 h-3.5 mr-1"}),f.fontSize,"px"]})}),(0,d.jsx)(ao,{align:"end",children:[12,14,16,18,20,24,28,32].map(a=>(0,d.jsxs)(ap,{onClick:()=>g({fontSize:a}),className:a===f.fontSize?"bg-accent":"",children:[a,"px"]},a))})]})]})]})}function aO({children:a}){let[b,c]=(0,e.useState)(!1),[f,g]=(0,e.useState)(!1),[h]=(0,e.useState)(20),[i]=(0,e.useState)(25),{manuscripts:j,activeManuscript:k,scenes:l,setActiveScene:m,activeSceneId:n}=(0,$.C)(),o=(0,e.useCallback)(()=>{c(!b)},[b]),p=(0,e.useCallback)(()=>{g(!f)},[f]);return(0,d.jsxs)("div",{className:"h-screen flex flex-col bg-background",children:[(0,d.jsx)(av,{}),(0,d.jsx)(aN,{}),(0,d.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,d.jsxs)(F,{direction:"horizontal",className:"h-full w-full",children:[(0,d.jsx)(G,{defaultSize:h,minSize:15*!b,maxSize:35,collapsible:!0,onCollapse:()=>c(!0),onExpand:()=>c(!1),children:(0,d.jsxs)("div",{className:"h-full border-r border-border bg-card",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between p-2 border-b border-border",children:[(0,d.jsx)("h2",{className:"text-sm font-semibold",children:"Project"}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:o,className:"h-6 w-6 p-0",children:(0,d.jsx)(U.A,{className:"h-3 w-3"})})]}),(0,d.jsxs)(O,{defaultValue:"files",className:"h-[calc(100%-3rem)]",children:[(0,d.jsxs)(P,{className:"grid w-full grid-cols-3",children:[(0,d.jsxs)(Q,{value:"files",className:"text-xs",children:[(0,d.jsx)(W.A,{className:"w-3 h-3 mr-1"}),"Files"]}),(0,d.jsxs)(Q,{value:"outline",className:"text-xs",children:[(0,d.jsx)(T.A,{className:"w-3 h-3 mr-1"}),"Outline"]}),(0,d.jsxs)(Q,{value:"search",className:"text-xs",children:[(0,d.jsx)(Y.A,{className:"w-3 h-3 mr-1"}),"Search"]})]}),(0,d.jsx)(R,{value:"files",className:"h-[calc(100%-2.5rem)] m-0",children:(0,d.jsx)(J,{className:"h-full",children:(0,d.jsxs)("div",{className:"p-2 space-y-2",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("h3",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider px-2",children:"Manuscripts"}),j.map(a=>(0,d.jsxs)("div",{className:`flex items-center gap-2 p-2 rounded-md cursor-pointer transition-colors ${k?.id===a.id?"bg-accent text-accent-foreground":"hover:bg-accent/50"}`,children:[(0,d.jsx)(W.A,{className:"w-4 h-4 flex-shrink-0"}),(0,d.jsx)("span",{className:"text-sm truncate",children:a.title})]},a.id))]}),k&&l.length>0&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(M,{}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("h3",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider px-2",children:"Scenes"}),l.map((a,b)=>(0,d.jsxs)("div",{className:`flex items-center gap-2 p-2 rounded-md cursor-pointer transition-colors ${n===a.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"}`,onClick:()=>m(a.id),children:[(0,d.jsx)("span",{className:"text-xs bg-muted text-muted-foreground rounded px-1.5 py-0.5 font-mono",children:b+1}),(0,d.jsx)("span",{className:"text-sm truncate",children:a.title||`Scene ${b+1}`}),(0,d.jsxs)("span",{className:"text-xs text-muted-foreground ml-auto",children:[a.word_count||0,"w"]})]},a.id))]})]})]})})}),(0,d.jsx)(R,{value:"outline",className:"h-[calc(100%-2.5rem)] m-0",children:(0,d.jsx)(J,{className:"h-full p-2",children:(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("h3",{className:"text-xs font-medium text-muted-foreground",children:"Document Outline"}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"Outline view will appear here when analyzing document structure."})]})})}),(0,d.jsx)(R,{value:"search",className:"h-[calc(100%-2.5rem)] m-0",children:(0,d.jsxs)("div",{className:"p-2 space-y-3",children:[(0,d.jsx)("input",{type:"text",placeholder:"Search in manuscript...",className:"w-full px-3 py-2 text-sm border border-border rounded-md bg-background"}),(0,d.jsx)("div",{className:"text-xs text-muted-foreground",children:"Search results will appear here."})]})})]})]})}),(0,d.jsx)(H,{}),(0,d.jsx)(G,{defaultSize:b?75:55,minSize:30,children:(0,d.jsx)("div",{className:"h-full bg-background",children:a})}),(0,d.jsx)(H,{}),(0,d.jsx)(G,{defaultSize:i,minSize:20*!f,maxSize:40,collapsible:!0,onCollapse:()=>g(!0),onExpand:()=>g(!1),children:(0,d.jsxs)("div",{className:"h-full border-l border-border bg-card",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between p-2 border-b border-border",children:[(0,d.jsx)("h2",{className:"text-sm font-semibold",children:"Analysis"}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:p,className:"h-6 w-6 p-0",children:(0,d.jsx)(V.A,{className:"h-3 w-3"})})]}),(0,d.jsxs)(O,{defaultValue:"stats",className:"h-[calc(100%-3rem)]",children:[(0,d.jsxs)(P,{className:"grid w-full grid-cols-3",children:[(0,d.jsxs)(Q,{value:"stats",className:"text-xs",children:[(0,d.jsx)(S.A,{className:"w-3 h-3 mr-1"}),"Stats"]}),(0,d.jsxs)(Q,{value:"comments",className:"text-xs",children:[(0,d.jsx)(X.A,{className:"w-3 h-3 mr-1"}),"Notes"]}),(0,d.jsxs)(Q,{value:"properties",className:"text-xs",children:[(0,d.jsx)(Z.A,{className:"w-3 h-3 mr-1"}),"Props"]})]}),(0,d.jsx)(R,{value:"stats",className:"h-[calc(100%-2.5rem)] m-0",children:(0,d.jsx)(J,{className:"h-full p-3",children:(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Writing Statistics"}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{children:"Words:"}),(0,d.jsx)("span",{className:"font-medium",children:"2,450"})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{children:"Characters:"}),(0,d.jsx)("span",{className:"font-medium",children:"12,840"})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{children:"Pages:"}),(0,d.jsx)("span",{className:"font-medium",children:"4.2"})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{children:"Paragraphs:"}),(0,d.jsx)("span",{className:"font-medium",children:"18"})]})]})]}),(0,d.jsx)(M,{}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Reading Time"}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{children:"Average:"}),(0,d.jsx)("span",{className:"font-medium",children:"9.8 min"})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{children:"Slow:"}),(0,d.jsx)("span",{className:"font-medium",children:"14.7 min"})]})]})]})]})})}),(0,d.jsx)(R,{value:"comments",className:"h-[calc(100%-2.5rem)] m-0",children:(0,d.jsx)(J,{className:"h-full p-3",children:(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("h3",{className:"text-xs font-medium text-muted-foreground",children:"Comments & Notes"}),(0,d.jsx)("div",{className:"text-xs text-muted-foreground",children:"No comments yet. Select text and use Ctrl+Shift+C to add comments."})]})})}),(0,d.jsx)(R,{value:"properties",className:"h-[calc(100%-2.5rem)] m-0",children:(0,d.jsx)(J,{className:"h-full p-3",children:(0,d.jsx)("div",{className:"space-y-4",children:(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Document Properties"}),(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-muted-foreground",children:"Title:"}),(0,d.jsx)("div",{className:"mt-1 font-medium",children:k?.title||"Untitled"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-muted-foreground",children:"Genre:"}),(0,d.jsx)("div",{className:"mt-1 text-muted-foreground",children:"Fiction"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-muted-foreground",children:"Created:"}),(0,d.jsx)("div",{className:"mt-1 text-muted-foreground",children:new Date().toLocaleDateString()})]})]})]})})})})]})]})})]})}),(0,d.jsxs)("div",{className:"h-6 bg-muted/50 border-t border-border flex items-center justify-between px-3 text-xs text-muted-foreground",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("span",{children:"Line 1, Column 1"}),(0,d.jsx)("span",{children:"•"}),(0,d.jsx)("span",{children:k?`${l.length} scenes`:"No manuscript"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("span",{children:"UTF-8"}),(0,d.jsx)("span",{children:"•"}),(0,d.jsx)("span",{children:"Auto-save: On"})]})]})]})}var aP=c(57601),aQ=c(51358),aR=c(13902);let aS=({className:a,children:b})=>(0,d.jsx)("span",{role:"status",className:a,style:{display:"inline-block",padding:"2px 8px",borderRadius:8,background:"#eee",color:"#333",fontSize:12,lineHeight:1.4},children:b});var aT=c(62478),aU=c(44493),aV=c(48730),aW=c(81381),aX=c(96882),aY=c(97992),aZ=c(58869);function a$({chapter:a,index:b,warnings:c,onPreview:e}){let{attributes:f,listeners:g,setNodeRef:h,transform:i,transition:j,isDragging:k}=(0,aQ.gl)({id:a.id}),l={transform:aT.Ks.Transform.toString(i),transition:j},m=c.some(a=>"error"===a.severity),n=c.some(a=>"warning"===a.severity),o=c.length;return(0,d.jsx)(aU.Zp,{ref:h,style:l,className:`
        transition-all duration-200
        ${k?"opacity-50 shadow-lg scale-105":"opacity-100"}
        ${m?"border-red-200 bg-red-50":""}
        ${n&&!m?"border-orange-200 bg-orange-50":""}
        hover:shadow-md
      `,children:(0,d.jsx)("div",{className:"p-4",children:(0,d.jsxs)("div",{className:"flex items-start gap-3",children:[(0,d.jsx)("div",{className:"flex items-center mt-1 cursor-grab active:cursor-grabbing text-muted-foreground hover:text-foreground",...f,...g,children:(0,d.jsx)(aW.A,{className:"h-5 w-5"})}),(0,d.jsx)("div",{className:"flex-shrink-0",children:(0,d.jsx)(aS,{variant:"outline",className:"font-mono",children:b})}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h4",{className:"font-medium truncate",children:a.title}),(0,d.jsxs)("div",{className:"flex items-center gap-4 mt-1 text-sm text-muted-foreground",children:[(0,d.jsxs)("span",{children:[a.wordCount.toLocaleString()," words"]}),a.metadata.pov&&(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(aZ.A,{className:"h-3 w-3"}),(0,d.jsx)("span",{children:a.metadata.pov})]}),a.metadata.location.length>0&&(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(aY.A,{className:"h-3 w-3"}),(0,d.jsx)("span",{children:a.metadata.location[0]})]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[o>0&&(0,d.jsxs)(aS,{variant:m?"destructive":"secondary",className:m?"":"text-orange-600",children:[(0,d.jsx)(z.A,{className:"h-3 w-3 mr-1"}),o]}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>e(a.id),className:"text-muted-foreground hover:text-foreground",children:(0,d.jsx)(aB.A,{className:"h-4 w-4"})})]})]}),(0,d.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[a.metadata.tensionLevel&&(0,d.jsxs)("span",{children:["Tension: ",a.metadata.tensionLevel,"/10"]}),a.metadata.timeframe&&(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(aV.A,{className:"h-3 w-3"}),(0,d.jsx)("span",{children:a.metadata.timeframe})]}),a.metadata.majorEvents.length>0&&(0,d.jsxs)("span",{children:[a.metadata.majorEvents.length," major events"]})]}),a.dependencies.requiredKnowledge.length>0&&(0,d.jsxs)("div",{className:"mt-2 text-xs",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Requires: "}),(0,d.jsxs)("span",{className:"text-blue-600",children:[a.dependencies.requiredKnowledge.slice(0,3).join(", "),a.dependencies.requiredKnowledge.length>3&&"..."]})]}),a.dependencies.introduces.length>0&&(0,d.jsxs)("div",{className:"mt-1 text-xs",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Introduces: "}),(0,d.jsxs)("span",{className:"text-green-600",children:[a.dependencies.introduces.slice(0,3).join(", "),a.dependencies.introduces.length>3&&"..."]})]}),c.length>0&&(0,d.jsxs)("div",{className:"mt-2 space-y-1",children:[c.slice(0,2).map((a,b)=>(0,d.jsxs)("div",{className:`text-xs p-2 rounded flex items-start gap-2 ${"error"===a.severity?"bg-red-100 text-red-700":"warning"===a.severity?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"}`,children:["error"===a.severity?(0,d.jsx)(z.A,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}):(0,d.jsx)(aX.A,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),(0,d.jsx)("span",{className:"flex-1",children:a.message})]},b)),c.length>2&&(0,d.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",c.length-2," more issues"]})]})]})]})})})}var a_=c(5336),a0=c(15807),a1=c(35071);function a2({warnings:a}){let b=a.filter(a=>"error"===a.severity),c=a.filter(a=>"warning"===a.severity),e=a.filter(a=>"info"===a.severity);return 0===a.length?(0,d.jsx)("div",{className:"p-4",children:(0,d.jsxs)("div",{className:"text-center py-8",children:[(0,d.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-3",children:(0,d.jsx)(a_.A,{className:"h-6 w-6 text-green-600"})}),(0,d.jsx)("h3",{className:"font-medium text-green-800 mb-1",children:"All Clear!"}),(0,d.jsx)("p",{className:"text-sm text-green-600",children:"No consistency issues detected with this chapter order."})]})}):(0,d.jsxs)("div",{className:"h-full flex flex-col",children:[(0,d.jsxs)("div",{className:"p-4 border-b",children:[(0,d.jsx)("h3",{className:"font-medium mb-2",children:"Consistency Analysis"}),(0,d.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[b.length>0&&(0,d.jsxs)("div",{className:"flex items-center gap-1 text-red-600",children:[(0,d.jsx)(a1.A,{className:"h-4 w-4"}),(0,d.jsxs)("span",{children:[b.length," errors"]})]}),c.length>0&&(0,d.jsxs)("div",{className:"flex items-center gap-1 text-orange-600",children:[(0,d.jsx)(z.A,{className:"h-4 w-4"}),(0,d.jsxs)("span",{children:[c.length," warnings"]})]}),e.length>0&&(0,d.jsxs)("div",{className:"flex items-center gap-1 text-blue-600",children:[(0,d.jsx)(aX.A,{className:"h-4 w-4"}),(0,d.jsxs)("span",{children:[e.length," suggestions"]})]})]})]}),(0,d.jsx)(J,{className:"flex-1",children:(0,d.jsx)("div",{className:"p-4 space-y-3",children:a.map((a,b)=>(0,d.jsx)(aU.Zp,{className:`p-3 ${(a=>{switch(a){case"error":return"border-red-200 bg-red-50";case"warning":return"border-orange-200 bg-orange-50";case"info":return"border-blue-200 bg-blue-50"}})(a.severity)}`,children:(0,d.jsxs)("div",{className:"flex items-start gap-3",children:[(a=>{switch(a){case"error":return(0,d.jsx)(a1.A,{className:"h-4 w-4 text-red-500"});case"warning":return(0,d.jsx)(z.A,{className:"h-4 w-4 text-orange-500"});case"info":return(0,d.jsx)(aX.A,{className:"h-4 w-4 text-blue-500"})}})(a.severity),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,d.jsx)(aS,{variant:"outline",className:"text-xs font-mono",children:a.type}),a.chapterIds.length>1&&(0,d.jsxs)(aS,{variant:"secondary",className:"text-xs",children:[a.chapterIds.length," chapters"]})]}),(0,d.jsx)("p",{className:"text-sm font-medium mb-2",children:a.message}),a.suggestion&&(0,d.jsxs)("div",{className:"flex items-start gap-2 text-xs text-muted-foreground bg-white/50 rounded p-2",children:[(0,d.jsx)(a0.A,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),(0,d.jsx)("span",{children:a.suggestion})]}),a.chapterIds.length>0&&(0,d.jsx)("div",{className:"mt-2",children:(0,d.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Affects chapters: ",a.chapterIds.join(", ")]})}),a.autoFixable&&(0,d.jsx)("div",{className:"mt-2",children:(0,d.jsxs)(y.$,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>console.log("Auto-fix:",a.id),children:[(0,d.jsx)(V.A,{className:"h-3 w-3 mr-1"}),"Auto-fix"]})})]})]})},b))})})]})}var a3=c(28559),a4=c(82080),a5=c(13943);function a6(){let{manuscript:a,currentVersion:b,editorMode:c}=af(),{setEditorMode:f,reorderChapters:g,previewReordering:h,applyReordering:i,cancelReordering:j,runConsistencyCheck:k}=af(a=>a.actions),[l,m]=(0,e.useState)([]),[n,o]=(0,e.useState)([]),[p,q]=(0,e.useState)(!1),[r,s]=(0,e.useState)(!1),t=(0,aP.FR)((0,aP.MS)(aP.AN),(0,aP.MS)(aP.uN,{coordinateGetter:aQ.JR})),u=(0,e.useCallback)(async a=>{let{active:b,over:c}=a;b.id!==c?.id&&m(a=>{let d=a.indexOf(b.id),e=a.indexOf(c.id),f=(0,aQ.be)(a,d,e);return q(!0),h(f).then(a=>{o(a.checks),q(!1),s(!0)}).catch(()=>{q(!1),s(!0)}),f})},[h]),v=(0,e.useCallback)(async()=>{try{g(l),await i(),s(!1),await k()}catch(a){console.error("Failed to apply reordering:",a)}},[l,g,i,k]),w=(0,e.useCallback)(()=>{j(),f("edit"),s(!1)},[j,f]),x=(0,e.useCallback)(a=>{},[]);if(!a||!b)return(0,d.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,d.jsx)("div",{className:"text-muted-foreground",children:"No manuscript loaded"})});let A=l.map(b=>a.content.chapters.find(a=>a.id===b)).filter(Boolean),B=n.some(a=>"warning"===a.severity||"error"===a.severity);return(0,d.jsxs)("div",{className:"flex flex-col h-full bg-background",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)(y.$,{variant:"ghost",size:"sm",onClick:w,children:[(0,d.jsx)(a3.A,{className:"h-4 w-4 mr-2"}),"Back to Editor"]}),(0,d.jsx)(M,{orientation:"vertical",className:"h-6"}),(0,d.jsx)(a4.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"font-semibold",children:"Chapter Reordering"}),(0,d.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.metadata.title," - ",b.name]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[r&&(0,d.jsx)(aS,{variant:"secondary",className:"text-orange-600",children:"Unsaved Changes"}),(0,d.jsxs)(y.$,{variant:"outline",size:"sm",onClick:w,disabled:!r,children:[(0,d.jsx)(a5.A,{className:"h-4 w-4 mr-2"}),"Reset"]}),(0,d.jsxs)(y.$,{onClick:v,disabled:!r,className:"bg-blue-600 hover:bg-blue-700",children:[(0,d.jsx)(at.A,{className:"h-4 w-4 mr-2"}),"Apply Changes"]})]})]}),(0,d.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,d.jsx)("div",{className:"flex-1 p-4 overflow-y-auto",children:(0,d.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Chapter Order"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Drag chapters to reorder them. Warnings will appear for potential consistency issues."})]}),(0,d.jsx)(aP.Mp,{sensors:t,collisionDetection:aP.fp,onDragEnd:u,modifiers:[aR.FN],children:(0,d.jsx)(aQ.gB,{items:l,strategy:aQ._G,children:(0,d.jsx)("div",{className:"space-y-2",children:A.map((a,b)=>(0,d.jsx)(a$,{chapter:a,index:b+1,warnings:n.filter(b=>b.chapterIds.includes(a.id)),onPreview:x},a.id))})})}),p&&(0,d.jsx)("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-blue-600 border-t-transparent"}),(0,d.jsx)("span",{className:"text-sm",children:"Analyzing consistency..."})]})})]})}),n.length>0&&(0,d.jsx)("div",{className:"w-80 border-l bg-muted/20",children:(0,d.jsx)(a2,{warnings:n})})]}),(0,d.jsx)("div",{className:"border-t bg-muted/50 px-4 py-2",children:(0,d.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsxs)("span",{className:"text-muted-foreground",children:[A.length," chapters"]}),B?(0,d.jsxs)("div",{className:"flex items-center gap-1 text-orange-600",children:[(0,d.jsx)(z.A,{className:"h-4 w-4"}),(0,d.jsxs)("span",{children:[n.length," consistency issues"]})]}):(0,d.jsxs)("div",{className:"flex items-center gap-1 text-green-600",children:[(0,d.jsx)(a_.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{children:"No issues detected"})]})]}),(0,d.jsx)("div",{className:"text-muted-foreground",children:r?"Changes not saved":"All changes saved"})]})})]})}let a7=f().forwardRef(({className:a,...b},c)=>(0,d.jsx)("input",{ref:c,className:a,...b}));a7.displayName="Input";let a8=f().forwardRef(({className:a,...b},c)=>(0,d.jsx)("textarea",{ref:c,className:a,...b}));a8.displayName="Textarea";let a9=(0,e.createContext)(void 0);function ba({open:a=!1,onOpenChange:b,children:c}){let[f,g]=(0,e.useState)(a),h=void 0!==b,i=h?a:f;return(0,d.jsx)(a9.Provider,{value:{open:i,onOpenChange:h?b:g},children:c})}function bb({asChild:a,children:b}){let c=(0,e.useContext)(a9);if(!c)throw Error("DialogTrigger must be used within Dialog");let g=()=>{c.onOpenChange(!0)};return a&&f().isValidElement(b)?f().cloneElement(b,{onClick:g,...b.props}):(0,d.jsx)(y.$,{onClick:g,children:b})}function bc({children:a,className:b=""}){let c=(0,e.useContext)(a9);if(!c)throw Error("DialogContent must be used within Dialog");return c.open?(0,d.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,d.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>c.onOpenChange(!1)}),(0,d.jsx)("div",{className:`relative bg-background border border-border rounded-lg shadow-lg max-w-md w-full mx-4 ${b}`,children:a})]}):null}function bd({children:a,className:b=""}){return(0,d.jsx)("div",{className:`p-6 pb-4 ${b}`,children:a})}function be({children:a,className:b=""}){return(0,d.jsx)("h3",{className:`text-lg font-semibold leading-none tracking-tight ${b}`,children:a})}var bf=c(31158),bg=c(96474),bh=c(64398);function bi(){let{currentVersion:a,availableVersions:b,manuscript:c}=af(),{createVersion:f,switchVersion:g,compareVersions:h,exportVersion:i}=af(a=>a.actions),[j,k]=(0,e.useState)(!1),[l,m]=(0,e.useState)(""),[n,o]=(0,e.useState)(""),[p,q]=(0,e.useState)(!1),r=async()=>{if(l.trim()){q(!0);try{await f(l.trim(),n.trim()),m(""),o(""),k(!1)}catch(a){console.error("Failed to create version:",a)}finally{q(!1)}}},s=async b=>{if(b!==a?.id)try{await g(b)}catch(a){console.error("Failed to switch version:",a)}},t=async b=>{if(a)try{await h(a.id,b)}catch(a){console.error("Failed to compare versions:",a)}},u=async(a,b)=>{try{await i(a,b)}catch(a){console.error("Failed to export version:",a)}};return(0,d.jsxs)("div",{className:"h-full flex flex-col bg-background",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(as.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"font-semibold",children:"Version Control"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage chapter arrangements"})]})]}),(0,d.jsxs)(ba,{open:j,onOpenChange:k,children:[(0,d.jsx)(bb,{asChild:!0,children:(0,d.jsxs)(y.$,{className:"bg-blue-600 hover:bg-blue-700",children:[(0,d.jsx)(bg.A,{className:"h-4 w-4 mr-2"}),"New Version"]})}),(0,d.jsxs)(bc,{children:[(0,d.jsx)(bd,{children:(0,d.jsx)(be,{children:"Create New Version"})}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium",children:"Version Name"}),(0,d.jsx)(a7,{value:l,onChange:a=>m(a.target.value),placeholder:"e.g., Tension-First Order",className:"mt-1"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium",children:"Description"}),(0,d.jsx)(a8,{value:n,onChange:a=>o(a.target.value),placeholder:"Describe what this version changes...",className:"mt-1",rows:3})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,d.jsx)(y.$,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),(0,d.jsx)(y.$,{onClick:r,disabled:!l.trim()||p,children:p?"Creating...":"Create Version"})]})]})]})]})]}),(0,d.jsx)(J,{className:"flex-1",children:(0,d.jsxs)("div",{className:"p-4 space-y-3",children:[b.map(e=>{let f,g=e.id===a?.id,h=c?{chapters:e.chapterOrder.length,changes:e.changes.length}:{chapters:0,changes:0};return(0,d.jsxs)(aU.Zp,{className:`p-4 transition-all duration-200 ${g?"border-blue-200 bg-blue-50":"hover:shadow-md cursor-pointer"}`,onClick:()=>!g&&s(e.id),children:[(0,d.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("h4",{className:"font-medium",children:e.name}),e.isBaseVersion&&(0,d.jsx)(bh.A,{className:"h-4 w-4 text-yellow-500"}),g&&(0,d.jsx)(aS,{variant:"default",className:"bg-blue-600",children:"Current"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),t(e.id)},disabled:g,children:(0,d.jsx)(aB.A,{className:"h-4 w-4"})}),(0,d.jsx)(y.$,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),u(e.id,"docx")},children:(0,d.jsx)(bf.A,{className:"h-4 w-4"})})]})]}),e.description&&(0,d.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:e.description}),(0,d.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsxs)("span",{children:[h.chapters," chapters"]}),(0,d.jsxs)("span",{children:[h.changes," changes"]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(aV.A,{className:"h-3 w-3"}),(0,d.jsx)("span",{children:(f=e.created,new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(f))})]})]}),!e.isBaseVersion&&e.parentVersionId&&(0,d.jsx)("div",{className:"mt-2 text-xs",children:(0,d.jsxs)("span",{className:"text-muted-foreground",children:["Based on: ",b.find(a=>a.id===e.parentVersionId)?.name]})})]},e.id)}),0===b.length&&(0,d.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,d.jsx)(as.A,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,d.jsx)("p",{children:"No versions available"}),(0,d.jsx)("p",{className:"text-sm",children:"Create your first version to get started"})]})]})})]})}var bj=c(32192);class bk extends e.Component{constructor(a){super(a),this.handleRetry=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})},this.handleReload=()=>{window.location.reload()},this.handleGoHome=()=>{window.location.href="/"},this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,b){console.error("ErrorBoundary caught an error:",a,b),this.setState({error:a,errorInfo:b}),this.props.onError&&this.props.onError(a,b),console.error("Production error logged:",{error:a.toString(),stack:a.stack,componentStack:b.componentStack,timestamp:new Date().toISOString()})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,d.jsx)("div",{className:"min-h-[400px] flex items-center justify-center p-6",children:(0,d.jsxs)("div",{className:"max-w-md text-center space-y-6",children:[(0,d.jsx)("div",{className:"flex justify-center",children:(0,d.jsx)(z.A,{className:"h-16 w-16 text-red-500"})}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold text-foreground",children:"Something went wrong"}),(0,d.jsx)("p",{className:"text-muted-foreground",children:"The editor encountered an unexpected error. This has been logged for investigation."})]}),!1,(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,d.jsxs)("button",{onClick:this.handleRetry,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:[(0,d.jsx)(A.A,{className:"h-4 w-4"}),"Try Again"]}),(0,d.jsxs)("button",{onClick:this.handleReload,className:"inline-flex items-center gap-2 px-4 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors",children:[(0,d.jsx)(A.A,{className:"h-4 w-4"}),"Reload Page"]}),(0,d.jsxs)("button",{onClick:this.handleGoHome,className:"inline-flex items-center gap-2 px-4 py-2 bg-muted text-muted-foreground rounded-md hover:bg-muted/90 transition-colors",children:[(0,d.jsx)(bj.A,{className:"h-4 w-4"}),"Go Home"]})]}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"If this problem persists, please refresh the page or restart the application."})]})}):this.props.children}}var bl=c(65915);let bm=bl.bL,bn=bl.l9;bl.YJ,bl.ZL;let bo=bl.Pb;bl.z6;let bp=f().forwardRef(({className:a,inset:b,children:c,...e},f)=>(0,d.jsxs)(bl.ZP,{ref:f,className:(0,E.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",b&&"pl-8",a),...e,children:[c,(0,d.jsx)(V.A,{className:"ml-auto h-4 w-4"})]}));bp.displayName=bl.ZP.displayName;let bq=f().forwardRef(({className:a,...b},c)=>(0,d.jsx)(bl.G5,{ref:c,className:(0,E.cn)("z-[9999] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...b}));bq.displayName=bl.G5.displayName;let br=f().forwardRef(({className:a,...b},c)=>(0,d.jsx)(bl.ZL,{children:(0,d.jsx)(bl.UC,{ref:c,className:(0,E.cn)("z-[9999] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...b})}));br.displayName=bl.UC.displayName;let bs=f().forwardRef(({className:a,inset:b,...c},e)=>(0,d.jsx)(bl.q7,{ref:e,className:(0,E.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",b&&"pl-8",a),...c}));bs.displayName=bl.q7.displayName,f().forwardRef(({className:a,children:b,checked:c,...e},f)=>(0,d.jsxs)(bl.H_,{ref:f,className:(0,E.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:c,...e,children:[(0,d.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,d.jsx)(bl.VF,{children:(0,d.jsx)(ah.A,{className:"h-4 w-4"})})}),b]})).displayName=bl.H_.displayName,f().forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(bl.hN,{ref:e,className:(0,E.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...c,children:[(0,d.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,d.jsx)(bl.VF,{children:(0,d.jsx)(ai.A,{className:"h-2 w-2 fill-current"})})}),b]})).displayName=bl.hN.displayName,f().forwardRef(({className:a,inset:b,...c},e)=>(0,d.jsx)(bl.JU,{ref:e,className:(0,E.cn)("px-2 py-1.5 text-sm font-semibold text-foreground",b&&"pl-8",a),...c})).displayName=bl.JU.displayName;let bt=f().forwardRef(({className:a,...b},c)=>(0,d.jsx)(bl.wv,{ref:c,className:(0,E.cn)("-mx-1 my-1 h-px bg-border",a),...b}));bt.displayName=bl.wv.displayName;let bu=({className:a,...b})=>(0,d.jsx)("span",{className:(0,E.cn)("ml-auto text-xs tracking-widest text-muted-foreground",a),...b});bu.displayName="ContextMenuShortcut";var bv=c(57844),bw=c(70615),bx=c(68097);function by({sceneId:a}){let b=(0,e.useRef)(null),[c,f]=(0,e.useState)(""),[g,h]=(0,e.useState)(!1),{manuscript:i,activeChapterId:j,isLoading:k,editorMode:l}=af(),{initialize:m,updateChapterContent:n,setActiveChapter:o,saveManuscript:p}=af(a=>a.actions),q=i?.content.chapters.find(a=>a.id===j),r=q?.content||"";!function(a,b=!0){(0,e.useCallback)(c=>{if(b){for(let[b,d]of Object.entries(a))if(function(a,b){let c=function(a){let b=a.split("+"),c=b[b.length-1];return{ctrl:b.includes("Ctrl"),shift:b.includes("Shift"),alt:b.includes("Alt"),key:c.toLowerCase()}}(b);return a.ctrlKey===c.ctrl&&a.shiftKey===c.shift&&a.altKey===c.alt&&a.key.toLowerCase()===c.key}(c,b)){c.preventDefault(),c.stopPropagation(),d();return}}},[a,b])}({"Ctrl+S":()=>{document.dispatchEvent(new CustomEvent("global-save"))},"Ctrl+N":()=>{document.dispatchEvent(new CustomEvent("global-new-manuscript"))},"Ctrl+O":()=>{document.dispatchEvent(new CustomEvent("global-open-manuscript"))},"Ctrl+F":()=>{document.dispatchEvent(new CustomEvent("global-find"))},"Ctrl+H":()=>{document.dispatchEvent(new CustomEvent("global-find-replace"))},F11:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},"Ctrl+\\":()=>{document.dispatchEvent(new CustomEvent("global-toggle-sidebar"))},"Ctrl+;":()=>{document.dispatchEvent(new CustomEvent("global-toggle-properties"))},"Ctrl+Shift+F":()=>{document.dispatchEvent(new CustomEvent("global-toggle-focus-mode"))},"Ctrl+Shift+A":()=>{document.dispatchEvent(new CustomEvent("global-ai-analysis"))},F1:()=>{document.dispatchEvent(new CustomEvent("global-show-shortcuts"))}});let s=a=>{if(b.current)switch(a){case"bold":case"italic":case"underline":case"comment":case"analyze":case"lookup":break;case"copy":document.execCommand("copy");break;case"cut":document.execCommand("cut");break;case"paste":document.execCommand("paste")}};return k?(0,d.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,d.jsx)("div",{className:"text-lg",children:"Loading editor..."})}):(0,d.jsx)(aO,{children:(0,d.jsx)("div",{className:"h-full flex flex-col",children:(()=>{switch(l){case"reorder":return(0,d.jsx)(a6,{});case"compare":return(0,d.jsxs)("div",{className:"flex h-full",children:[(0,d.jsx)("div",{className:"flex-1",children:(0,d.jsx)(a6,{})}),(0,d.jsx)("div",{className:"w-80 border-l",children:(0,d.jsx)(bi,{})})]});default:return(0,d.jsxs)(bk,{onError:(a,b)=>{console.error("Editor error:",a,b)},children:[(0,d.jsxs)(bm,{children:[(0,d.jsx)(bn,{asChild:!0,children:(0,d.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,d.jsx)(B,{children:(0,d.jsx)(x,{ref:b,content:r,onChange:a=>{j&&n(j,a)},sceneId:j||void 0,onSave:p,placeholder:"Begin writing your story...",className:`
                        ${i?.settings.enableConsistencyChecking?"consistency-mode":""}
                      `})})})}),(0,d.jsxs)(br,{className:"w-64",children:[c&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(bs,{onClick:()=>s("cut"),children:[(0,d.jsx)(bx.A,{className:"mr-2 h-4 w-4"}),"Cut",(0,d.jsx)(bu,{children:"Ctrl+X"})]}),(0,d.jsxs)(bs,{onClick:()=>s("copy"),children:[(0,d.jsx)(bw.A,{className:"mr-2 h-4 w-4"}),"Copy",(0,d.jsx)(bu,{children:"Ctrl+C"})]}),(0,d.jsx)(bt,{}),(0,d.jsxs)(bo,{children:[(0,d.jsxs)(bp,{children:[(0,d.jsx)(az.A,{className:"mr-2 h-4 w-4"}),"Format"]}),(0,d.jsxs)(bq,{className:"w-48",children:[(0,d.jsxs)(bs,{onClick:()=>s("bold"),children:[(0,d.jsx)(az.A,{className:"mr-2 h-4 w-4"}),"Bold",(0,d.jsx)(bu,{children:"Ctrl+B"})]}),(0,d.jsxs)(bs,{onClick:()=>s("italic"),children:[(0,d.jsx)(aE.A,{className:"mr-2 h-4 w-4"}),"Italic",(0,d.jsx)(bu,{children:"Ctrl+I"})]}),(0,d.jsxs)(bs,{onClick:()=>s("underline"),children:[(0,d.jsx)(aL.A,{className:"mr-2 h-4 w-4"}),"Underline",(0,d.jsx)(bu,{children:"Ctrl+U"})]})]})]}),(0,d.jsx)(bt,{}),(0,d.jsxs)(bs,{onClick:()=>s("comment"),children:[(0,d.jsx)(X.A,{className:"mr-2 h-4 w-4"}),"Add Comment",(0,d.jsx)(bu,{children:"Ctrl+Alt+M"})]}),(0,d.jsxs)(bs,{onClick:()=>s("analyze"),children:[(0,d.jsx)(aM.A,{className:"mr-2 h-4 w-4"}),"AI Analysis",(0,d.jsx)(bu,{children:"Ctrl+Shift+A"})]}),(0,d.jsx)(bt,{}),(0,d.jsxs)(bs,{onClick:()=>s("lookup"),children:[(0,d.jsx)(Y.A,{className:"mr-2 h-4 w-4"}),"Look Up"]}),(0,d.jsxs)(bs,{onClick:()=>s("bookmark"),children:[(0,d.jsx)(T.A,{className:"mr-2 h-4 w-4"}),"Bookmark"]})]}),!c&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(bs,{onClick:()=>s("paste"),children:[(0,d.jsx)(bv.A,{className:"mr-2 h-4 w-4"}),"Paste",(0,d.jsx)(bu,{children:"Ctrl+V"})]}),(0,d.jsx)(bt,{}),(0,d.jsxs)(bs,{onClick:()=>h(!0),children:[(0,d.jsx)(Y.A,{className:"mr-2 h-4 w-4"}),"Find & Replace",(0,d.jsx)(bu,{children:"Ctrl+H"})]}),(0,d.jsx)(bt,{}),(0,d.jsxs)(bs,{children:[(0,d.jsx)(a4.A,{className:"mr-2 h-4 w-4"}),"Insert Scene Break",(0,d.jsx)(bu,{children:"Ctrl+Shift+Enter"})]}),(0,d.jsxs)(bo,{children:[(0,d.jsxs)(bp,{children:[(0,d.jsx)(a4.A,{className:"mr-2 h-4 w-4"}),"Insert"]}),(0,d.jsxs)(bq,{className:"w-48",children:[(0,d.jsx)(bs,{children:"Chapter Division"}),(0,d.jsx)(bs,{children:"Scene Break"}),(0,d.jsx)(bs,{children:"Page Break"}),(0,d.jsx)(bt,{}),(0,d.jsx)(bs,{children:"Today's Date"}),(0,d.jsx)(bs,{children:"Word Count"})]})]})]})]})]}),g&&(0,d.jsx)("div",{className:"absolute top-4 right-4 bg-background border border-border rounded-lg p-4 shadow-lg z-50",children:(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("h3",{className:"text-sm font-medium",children:"Find & Replace"}),(0,d.jsx)("button",{onClick:()=>h(!1),className:"text-muted-foreground hover:text-foreground",children:"\xd7"})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("input",{type:"text",placeholder:"Find...",className:"w-full px-2 py-1 text-sm border border-border rounded"}),(0,d.jsx)("input",{type:"text",placeholder:"Replace with...",className:"w-full px-2 py-1 text-sm border border-border rounded"})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{className:"px-3 py-1 text-xs bg-primary text-primary-foreground rounded",children:"Find Next"}),(0,d.jsx)("button",{className:"px-3 py-1 text-xs bg-secondary text-secondary-foreground rounded",children:"Replace"}),(0,d.jsx)("button",{className:"px-3 py-1 text-xs bg-secondary text-secondary-foreground rounded",children:"Replace All"})]})]})})]})}})()})})}function bz(){return(0,d.jsx)(bk,{onError:(a,b)=>{console.error("Editor page error:",a,b)},children:(0,d.jsx)(by,{})})}},6535:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>C.a,__next_app__:()=>I,handler:()=>K,pages:()=>H,routeModule:()=>J,tree:()=>G});var d=c(65239),e=c(48088),f=c(47220),g=c(81289),h=c(26191),i=c(14823),j=c(71998),k=c(92603),l=c(54649),m=c(32781),n=c(82602),o=c(61268),p=c(4853),q=c(261),r=c(5052),s=c(9977),t=c(26713),u=c(43365),v=c(71454),w=c(67778),x=c(46143),y=c(39105),z=c(38171),A=c(86439),B=c(16133),C=c.n(B),D=c(30893),E=c(52836),F={};for(let a in D)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(F[a]=()=>D[a]);c.d(b,F);let G={children:["",{children:["editor",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,60714)),"C:\\Users\\zeke\\Projects\\narrative-surgeon\\src\\app\\editor\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,94431)),"C:\\Users\\zeke\\Projects\\narrative-surgeon\\src\\app\\layout.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,16133,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,80849,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,29868,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,79615,23)),"next/dist/client/components/builtin/unauthorized.js"]}]}.children,H=["C:\\Users\\zeke\\Projects\\narrative-surgeon\\src\\app\\editor\\page.tsx"],I={require:c,loadChunk:()=>Promise.resolve()},J=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/editor/page",pathname:"/editor",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:G},distDir:".next",projectDir:""});async function K(a,b,c){var d;let B="/editor/page";"/index"===B&&(B="/");let F="false",L=(0,h.getRequestMeta)(a,"postponed"),M=(0,h.getRequestMeta)(a,"minimalMode"),N=await J.prepare(a,b,{srcPage:B,multiZoneDraftMode:F});if(!N)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:O,query:P,params:Q,parsedUrl:R,pageIsDynamic:S,buildManifest:T,nextFontManifest:U,reactLoadableManifest:V,serverActionsManifest:W,clientReferenceManifest:X,subresourceIntegrityManifest:Y,prerenderManifest:Z,isDraftMode:$,resolvedPathname:_,revalidateOnlyGenerated:aa,routerServerContext:ab,nextConfig:ac}=N,ad=R.pathname||"/",ae=(0,q.normalizeAppPath)(B),{isOnDemandRevalidate:af}=N,ag=Z.dynamicRoutes[ae],ah=Z.routes[_],ai=!!(ag||ah||Z.routes[ae]),aj=a.headers["user-agent"]||"",ak=(0,t.getBotType)(aj),al=(0,o.isHtmlBotRequest)(a),am=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??!!a.headers[s.NEXT_ROUTER_PREFETCH_HEADER],an=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[s.RSC_HEADER],ao=(0,r.getIsPossibleServerAction)(a),ap=(0,l.checkIsAppPPREnabled)(ac.experimental.ppr)&&(null==(d=Z.routes[ae]??Z.dynamicRoutes[ae])?void 0:d.renderingMode)==="PARTIALLY_STATIC",aq=!1,ar=!1,as=ap?L:void 0,at=ap&&an&&!am,au=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),av=!aj||(0,o.shouldServeStreamingMetadata)(aj,ac.htmlLimitedBots);al&&ap&&(ai=!1,av=!1);let aw=!0===J.isDev||!ai||"string"==typeof L||at,ax=al&&ap,ay=null;$||!ai||aw||ao||as||at||(ay=_);let az=ay;!az&&J.isDev&&(az=_);let aA={...D,tree:G,pages:H,GlobalError:C(),handler:K,routeModule:J,__next_app__:I};W&&X&&(0,n.setReferenceManifestsSingleton)({page:B,clientReferenceManifest:X,serverActionsManifest:W,serverModuleMap:(0,p.createServerModuleMap)({serverActionsManifest:W})});let aB=a.method||"GET",aC=(0,g.getTracer)(),aD=aC.getActiveScopeSpan();try{let d=async(c,d)=>{let e=new k.NodeNextRequest(a),f=new k.NodeNextResponse(b);return J.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aC.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aB} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aB} ${a.url}`)})},f=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:P,params:Q,page:ae,sharedContext:{buildId:O},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aA,Component:(0,j.T)(aA),params:Q,routeModule:J,page:B,postponed:f,shouldWaitOnAllReady:ax,serveStreamingMetadata:av,supportsDynamicResponse:"string"==typeof f||aw,buildManifest:T,nextFontManifest:U,reactLoadableManifest:V,subresourceIntegrityManifest:Y,serverActionsManifest:W,clientReferenceManifest:X,setIsrStatus:null==ab?void 0:ab.setIsrStatus,dir:J.projectDir,isDraftMode:$,isRevalidate:ai&&!f&&!at,botType:ak,isOnDemandRevalidate:af,isPossibleServerAction:ao,assetPrefix:ac.assetPrefix,nextConfigOutput:ac.output,crossOrigin:ac.crossOrigin,trailingSlash:ac.trailingSlash,previewProps:Z.preview,deploymentId:ac.deploymentId,enableTainting:ac.experimental.taint,htmlLimitedBots:ac.htmlLimitedBots,devtoolSegmentExplorer:ac.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ac.reactMaxHeadersLength,multiZoneDraftMode:F,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ac.experimental.cacheLife,basePath:ac.basePath,serverActions:ac.experimental.serverActions,...aq?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:aq}:{},experimental:{isRoutePPREnabled:ap,expireTime:ac.expireTime,staleTimes:ac.experimental.staleTimes,dynamicIO:!!ac.experimental.dynamicIO,clientSegmentCache:!!ac.experimental.clientSegmentCache,dynamicOnHover:!!ac.experimental.dynamicOnHover,inlineCss:!!ac.experimental.inlineCss,authInterrupts:!!ac.experimental.authInterrupts,clientTraceMetadata:ac.experimental.clientTraceMetadata||[]},waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>J.onRequestError(a,b,d,ab),err:(0,h.getRequestMeta)(a,"invokeError"),dev:J.isDev}},k=await d(e,i),{metadata:l}=k,{cacheControl:m,headers:n={},fetchTags:o}=l;if(o&&(n[x.NEXT_CACHE_TAGS_HEADER]=o),a.fetchMetrics=l.fetchMetrics,ai&&(null==m?void 0:m.revalidate)===0&&!J.isDev&&!ap){let a=l.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${_}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:u.CachedRouteKind.APP_PAGE,html:k,headers:n,rscData:l.flightData,postponed:l.postponed,status:l.statusCode,segmentData:l.segmentData},cacheControl:m}},l=async({hasResolved:d,previousCacheEntry:g,isRevalidating:i,span:j})=>{let k,l=!1===J.isDev,n=d||b.writableEnded;if(af&&aa&&!g&&!M)return(null==ab?void 0:ab.render404)?await ab.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ag&&(k=(0,v.parseFallbackField)(ag.fallback)),k===v.FallbackMode.PRERENDER&&(0,t.isBot)(aj)&&(k=v.FallbackMode.BLOCKING_STATIC_RENDER),(null==g?void 0:g.isStale)===-1&&(af=!0),af&&(k!==v.FallbackMode.NOT_FOUND||g)&&(k=v.FallbackMode.BLOCKING_STATIC_RENDER),!M&&k!==v.FallbackMode.BLOCKING_STATIC_RENDER&&az&&!n&&!$&&S&&(l||!ah)){let b;if((l||ag)&&k===v.FallbackMode.NOT_FOUND)throw new A.NoFallbackError;if(ap&&!an){if(b=await J.handleResponse({cacheKey:l?ae:null,req:a,nextConfig:ac,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:Z,isRoutePPREnabled:ap,responseGenerator:async()=>f({span:j,postponed:void 0,fallbackRouteParams:l||ar?(0,m.u)(ae):null}),waitUntil:c.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=af||i||!as?void 0:as;if(aq&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:u.CachedRouteKind.PAGES,html:w.default.fromStatic(""),pageData:{},headers:void 0,status:void 0}};let p=S&&ap&&((0,h.getRequestMeta)(a,"renderFallbackShell")||ar)?(0,m.u)(ad):null;return f({span:j,postponed:o,fallbackRouteParams:p})},n=async d=>{var g,i,j,k,m;let n,o=await J.handleResponse({cacheKey:ay,responseGenerator:a=>l({span:d,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:af,isRoutePPREnabled:ap,req:a,nextConfig:ac,prerenderManifest:Z,waitUntil:c.waitUntil});if($&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),J.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!o){if(ay)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(g=o.value)?void 0:g.kind)!==u.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(j=o.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof o.value.postponed;ai&&!at&&(!p||am)&&(M||b.setHeader("x-nextjs-cache",af?"REVALIDATED":o.isMiss?"MISS":o.isStale?"STALE":"HIT"),b.setHeader(s.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=o;if(as)n={revalidate:0,expire:void 0};else if(M&&an&&!am&&ap)n={revalidate:0,expire:void 0};else if(!J.isDev)if($)n={revalidate:0,expire:void 0};else if(ai){if(o.cacheControl)if("number"==typeof o.cacheControl.revalidate){if(o.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${o.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});n={revalidate:o.cacheControl.revalidate,expire:(null==(k=o.cacheControl)?void 0:k.expire)??ac.expireTime}}else n={revalidate:x.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(n={revalidate:0,expire:void 0});if(o.cacheControl=n,"string"==typeof au&&(null==q?void 0:q.kind)===u.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(s.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(m=q.headers)?void 0:m[x.NEXT_CACHE_TAGS_HEADER];M&&ai&&c&&"string"==typeof c&&b.setHeader(x.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(au);return void 0!==d?(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(d),cacheControl:o.cacheControl}):(b.statusCode=204,(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(""),cacheControl:o.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...o,value:{...o.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&as)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(M&&ai||delete a[x.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let t=null==(i=q.headers)?void 0:i[x.NEXT_CACHE_TAGS_HEADER];if(M&&ai&&t&&"string"==typeof t&&b.setHeader(x.NEXT_CACHE_TAGS_HEADER,t),!q.status||an&&ap||(b.statusCode=q.status),!M&&q.status&&E.RedirectStatusCode[q.status]&&an&&(b.statusCode=200),p&&b.setHeader(s.NEXT_DID_POSTPONE_HEADER,"1"),an&&!$){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:q.html,cacheControl:at?{revalidate:0,expire:void 0}:o.cacheControl})}return(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(q.rscData),cacheControl:o.cacheControl})}let v=q.html;if(!p||M)return(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:o.cacheControl});if(aq)return v.chain(new ReadableStream({start(a){a.enqueue(y.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:{revalidate:0,expire:void 0}});let A=new TransformStream;return v.chain(A.readable),f({span:d,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==u.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(A.writable)}).catch(a=>{A.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:{revalidate:0,expire:void 0}})};if(!aD)return await aC.withPropagatedContext(a.headers,()=>aC.trace(i.BaseServerSpan.handleRequest,{spanName:`${aB} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aB,"http.target":a.url}},n));await n(aD)}catch(b){throw aD||b instanceof A.NoFallbackError||await J.onRequestError(a,b,{routerKind:"App Router",routePath:B,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ai,isOnDemandRevalidate:af})},ab),b}}},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13934:(a,b,c)=>{"use strict";c.d(b,{$$:()=>d.$$,Es:()=>d.Es,KG:()=>d.KG,Ks:()=>d.Ks,Ll:()=>d.Ll,Re:()=>d.Re,Sw:()=>d.Sw,TW:()=>d.TW,WQ:()=>d.WQ,YG:()=>d.YG,YN:()=>d.YN,ZC:()=>d.ZC,_q:()=>d._q,ag:()=>d.ag,e_:()=>d.e_,kx:()=>d.kx,l6:()=>d.l6,lk:()=>d.lk,sb:()=>d.sb,wz:()=>d.wz,xZ:()=>d.xZ,zk:()=>d.zk});var d=c(62478)},18771:(a,b,c)=>{"use strict";c.d(b,{Es:()=>d.Es,Ks:()=>d.Ks,Re:()=>d.Re,YG:()=>d.YG,jn:()=>d.jn,kx:()=>d.kx});var d=c(62478)},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{"use strict";a.exports=require("path")},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},60039:(a,b,c)=>{Promise.resolve().then(c.bind(c,3923))},60714:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(61369).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\zeke\\\\Projects\\\\narrative-surgeon\\\\src\\\\app\\\\editor\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\zeke\\Projects\\narrative-surgeon\\src\\app\\editor\\page.tsx","default")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76220:(a,b,c)=>{"use strict";c.d(b,{PM:()=>d.PM,Sj:()=>d.Sj,Vy:()=>d.Vy,fF:()=>d.fF,sl:()=>d.sl,vL:()=>d.vL,y$:()=>d.y$,zM:()=>d.zM});var d=c(57601)},76911:(a,b,c)=>{Promise.resolve().then(c.bind(c,60714))},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[426,336,96,552],()=>b(b.s=6535));module.exports=c})();