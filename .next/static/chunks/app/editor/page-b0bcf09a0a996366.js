(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[766],{5:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>tb});var s=n(5155),r=n(2115),a=n(5109),i=n(802),o=n(1051),c=n(7e3),l=n(4109),d=n(4652),m=n(4589),h=n(6377),u=n(3083),p=n(4979),x=n(4927),g=n(7192),f=n(3356),v=n(6333);let j=i.bP.create({name:"sceneBreak",group:"block",content:"",marks:"",atom:!0,parseHTML:()=>[{tag:'div[data-type="scene-break"]'}],renderHTML:()=>["div",{"data-type":"scene-break",class:"scene-break",contenteditable:"false"},"* * *"],addCommands(){return{insertSceneBreak:()=>e=>{let{commands:t}=e;return t.insertContent({type:this.name})}}},addKeyboardShortcuts(){return{"Mod-Shift-Enter":()=>this.editor.commands.insertSceneBreak()}}}),w=i.bP.create({name:"chapterDivision",group:"block",content:"inline*",marks:"",defining:!0,addAttributes:()=>({number:{default:1},title:{default:""}}),parseHTML:()=>[{tag:'div[data-type="chapter-division"]',getAttrs:e=>({number:parseInt(e.getAttribute("data-number")||"1",10),title:e.getAttribute("data-title")})}],renderHTML(e){let{node:t}=e;return["div",{"data-type":"chapter-division","data-number":t.attrs.number,"data-title":t.attrs.title,class:"chapter-division"},"Chapter ".concat(t.attrs.number).concat(t.attrs.title?": ".concat(t.attrs.title):"")]},addCommands(){return{insertChapterDivision:e=>t=>{let{commands:n}=t;return n.insertContent({type:this.name,attrs:e})}}}}),y=i.YY.create({name:"autoSave",addOptions:()=>({delay:2e3,onSave:()=>{}}),onCreate(){let e=null,t=()=>{e&&clearTimeout(e),e=setTimeout(()=>{try{this.options.onSave()}catch(e){console.error("Auto-save failed:",e)}},this.options.delay)};this.editor.on("update",t),this.editor.on("destroy",()=>{this.editor.off("update",t),e&&(clearTimeout(e),e=null)})}}),C=(0,r.forwardRef)((e,t)=>{let{content:n,onChange:i,readOnly:C=!1,showWordCount:N=!0,placeholder:b="Start writing your story...",className:k="",onSave:S}=e,[A,E]=(0,r.useState)(!1),T=(0,r.useRef)(""),M=k.replace(/[\r\n\t\f\v]/g," ").replace(/\s+/g," ").trim(),L=(0,r.useCallback)(e=>{e!==T.current&&(T.current=e,i(e))},[i]),O=(0,a.hG)({immediatelyRender:!1,extensions:[o.A,c.A,l.A.configure({types:["heading","paragraph"]}),d.Ay,m.A.configure({types:["textStyle"]}),h.xJ,u.A,p.A.configure({placeholder:b,emptyEditorClass:"is-editor-empty"}),x.A,g.A,f.A,v.A.configure({nested:!0}),j,w,y.configure({delay:2e3,onSave:()=>null==S?void 0:S()})],content:n,editable:!C,onUpdate:e=>{let{editor:t}=e;A||L(t.getHTML())},editorProps:{attributes:{class:"prose prose-lg max-w-none min-h-[500px] px-6 py-4 focus:outline-none manuscript-editor ".concat(M).trim().replace(/\s+/g," "),spellcheck:"true"},handleKeyDown:(e,t)=>{if(t.ctrlKey||t.metaKey)switch(t.key){case"s":return t.preventDefault(),null==S||S(),!0;case"f":return t.preventDefault(),!0}return!1}}});return((0,r.useImperativeHandle)(t,()=>({getWordCount:()=>{var e;return(null==O||null==(e=O.storage)?void 0:e.characterCount)?O.storage.characterCount.words():0},getCharacterCount:()=>{var e;return(null==O||null==(e=O.storage)?void 0:e.characterCount)?O.storage.characterCount.characters():0},insertSceneBreak:()=>{var e,t;return!!(null==O?void 0:O.commands)&&((null==(e=(t=O.commands).insertSceneBreak)?void 0:e.call(t))||!1)},insertChapterDivision:(e,t)=>{var n,s;return!!(null==O?void 0:O.commands)&&((null==(n=(s=O.commands).insertChapterDivision)?void 0:n.call(s,{number:e,title:t}))||!1)},focus:()=>!!(null==O?void 0:O.commands)&&O.commands.focus("end"),blur:()=>!!(null==O?void 0:O.commands)&&O.commands.blur(),getHTML:()=>(null==O?void 0:O.getHTML())||"",getText:()=>(null==O?void 0:O.getText())||"",setContent:e=>!!(null==O?void 0:O.commands)&&O.commands.setContent(e,!1),insertText:e=>!!(null==O?void 0:O.commands)&&O.commands.insertContent(e),find:e=>{},replace:(e,t)=>{}}),[O]),(0,r.useEffect)(()=>{O&&n!==O.getHTML()&&!A&&(E(!0),O.commands.setContent(n,!1),setTimeout(()=>E(!1),0))},[n,O,A]),(0,r.useEffect)(()=>{O&&!C&&O.commands.focus("end")},[O,C]),(0,r.useEffect)(()=>()=>{O&&O.destroy()},[O]),O)?(0,s.jsxs)("div",{className:"relative w-full h-full",children:[(0,s.jsx)(a.$Z,{editor:O,className:"w-full h-full"}),N&&(0,s.jsxs)("div",{className:"absolute bottom-4 right-4 text-xs text-muted-foreground bg-background/80 backdrop-blur-sm px-2 py-1 rounded border",children:[O.storage.characterCount.words()," words • ",O.storage.characterCount.characters()," characters"]}),(0,s.jsx)("div",{className:"absolute top-4 right-4 text-xs text-muted-foreground",children:C?(0,s.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"Read Only"]}):(0,s.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Editing"]})})]}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[500px] text-muted-foreground",children:"Loading editor..."})});C.displayName="TiptapEditor";var N=n(285),b=n(1243),k=n(3904);class S extends r.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Editor Error:",e,t),this.setState({errorInfo:t}),window.gtag&&window.gtag("event","exception",{description:e.message,fatal:!1})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px] border border-red-200 rounded-lg bg-red-50",children:(0,s.jsxs)("div",{className:"text-center p-6 max-w-md",children:[(0,s.jsx)(b.A,{className:"h-12 w-12 text-red-600 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Editor Error"}),(0,s.jsx)("p",{className:"text-red-700 mb-4 text-sm",children:"The editor encountered an unexpected error. Your work is automatically saved."}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(N.$,{onClick:this.handleRetry,className:"bg-red-600 hover:bg-red-700 text-white",children:[(0,s.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Try Again"]}),(0,s.jsx)(N.$,{variant:"outline",onClick:()=>window.location.reload(),className:"text-red-600 border-red-300",children:"Reload Page"})]}),!1]})}):this.props.children}constructor(e){super(e),this.handleRetry=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})},this.state={hasError:!1}}}var A=n(3096),E=n(9730),T=n(9434);let M=e=>{let{className:t,...n}=e;return(0,s.jsx)(E.YZ,{className:(0,T.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...n})},L=E.Zk,O=e=>{let{withHandle:t,className:n,...r}=e;return(0,s.jsx)(E.TW,{className:(0,T.cn)("relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",n),...r,children:t&&(0,s.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border",children:(0,s.jsx)(A.YtH,{className:"h-2.5 w-2.5"})})})};var z=n(9051);let F=r.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,s.jsxs)(z.bL,{ref:t,className:(0,T.cn)("relative overflow-hidden",n),...a,children:[(0,s.jsx)(z.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,s.jsx)(I,{}),(0,s.jsx)(z.OK,{})]})});F.displayName=z.bL.displayName;let I=r.forwardRef((e,t)=>{let{className:n,orientation:r="vertical",...a}=e;return(0,s.jsx)(z.VM,{ref:t,orientation:r,className:(0,T.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",n),...a,children:(0,s.jsx)(z.lr,{className:"relative flex-1 rounded-full bg-border"})})});I.displayName=z.VM.displayName;var R=n(7489);let D=r.forwardRef((e,t)=>{let{className:n,orientation:r="horizontal",decorative:a=!0,...i}=e;return(0,s.jsx)(R.b,{ref:t,decorative:a,orientation:r,className:(0,T.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",n),...i})});D.displayName=R.b.displayName;let P=r.createContext({value:void 0,setValue:()=>{}}),_=e=>{let{defaultValue:t,value:n,onValueChange:a,className:i,children:o}=e,[c,l]=r.useState(t);return(0,s.jsx)(P.Provider,{value:{value:void 0!==n?n:c,setValue:e=>{a&&a(e),void 0===n&&l(e)}},children:(0,s.jsx)("div",{className:i,children:o})})},V=e=>{let{children:t,...n}=e;return(0,s.jsx)("div",{role:"tablist",...n,children:t})},B=e=>{let{value:t,children:n,...a}=e,{value:i,setValue:o}=r.useContext(P);return(0,s.jsx)("button",{role:"tab","aria-selected":i===t,onClick:()=>o(t),...a,children:n})},U=e=>{let{value:t,children:n,...a}=e,{value:i}=r.useContext(P);return i!==t?null:(0,s.jsx)("div",{role:"tabpanel",...a,children:n})};var $=n(2713),H=n(2108),W=n(2355),K=n(3052),G=n(7434),Z=n(1497),q=n(7924),Y=n(381),J=n(4601),Q=n(7111),X=n(6786);class ee{async analyzeConsistency(e){let t=[],n=this.getChaptersInOrder(e);return t.push(...this.checkKnowledgeDependencies(n)),t.push(...this.checkCharacterIntroductions(n)),t.push(...this.checkTechConceptOrder(n)),t.push(...this.checkPlotContinuity(n)),t.push(...this.checkTimelineConsistency(n)),t.push(...this.checkLocationIntroductions(n)),t.push(...this.checkTensionProgression(n)),t}getChaptersInOrder(e){return(e||this.manuscript.content.chapters.map(e=>e.id)).map(e=>this.manuscript.content.chapters.find(t=>t.id===e)).filter(Boolean)}checkKnowledgeDependencies(e){let t=[],n=new Set;for(let s=0;s<e.length;s++){let r=e[s];for(let e of r.dependencies.requiredKnowledge)n.has(e)||t.push({id:"knowledge-".concat(r.id,"-").concat(e),type:"plot",severity:"warning",message:"Chapter ".concat(s+1,' "').concat(r.title,'" requires knowledge of "').concat(e,"\" which hasn't been introduced yet"),chapterIds:[r.id],suggestion:'Consider introducing "'.concat(e,'" in an earlier chapter or moving this chapter later'),autoFixable:!1});r.dependencies.introduces.forEach(e=>{n.add(e)})}return t}checkCharacterIntroductions(e){let t=[],n=new Set;for(let s=0;s<e.length;s++){let r=e[s];if(r.metadata.pov&&!n.has(r.metadata.pov)){let e=this.manuscript.content.characters.find(e=>e.name===r.metadata.pov);e&&e.firstAppearance!==r.id&&t.push({id:"pov-".concat(r.id,"-").concat(r.metadata.pov),type:"character",severity:"error",message:"Chapter ".concat(s+1," uses ").concat(r.metadata.pov," as POV character before their introduction"),chapterIds:[r.id],suggestion:"Introduce ".concat(r.metadata.pov," before using them as POV character"),autoFixable:!1})}this.manuscript.content.characters.forEach(e=>{r.content.includes(e.name)&&!n.has(e.name)&&e.firstAppearance!==r.id&&t.push({id:"char-ref-".concat(r.id,"-").concat(e.name),type:"character",severity:"warning",message:"Chapter ".concat(s+1," references ").concat(e.name," before their introduction"),chapterIds:[r.id],suggestion:"Consider introducing ".concat(e.name," earlier or moving this reference"),autoFixable:!1}),e.firstAppearance===r.id&&n.add(e.name)})}return t}checkTechConceptOrder(e){let t=[],n=new Set,s=["quantum computing","neural networks","blockchain","AI","cryptocurrency","biometrics","encryption","dark web","IoT","cloud computing"];for(let r=0;r<e.length;r++){let a=e[r];s.forEach(e=>{a.content.toLowerCase().includes(e.toLowerCase())&&!n.has(e)&&(a.dependencies.introduces.some(t=>t.toLowerCase().includes(e.toLowerCase()))?n.add(e):t.push({id:"tech-".concat(a.id,"-").concat(e),type:"tech",severity:"info",message:"Chapter ".concat(r+1,' uses "').concat(e,'" without prior explanation'),chapterIds:[a.id],suggestion:"Consider explaining ".concat(e," before heavy usage or in this chapter"),autoFixable:!1}))})}return t}checkPlotContinuity(e){let t=[],n=new Set;for(let s=0;s<e.length;s++){let r=e[s];r.dependencies.references.forEach(n=>{let a=e.find(e=>e.id===n.targetChapterId);if(a){let i=e.indexOf(a);i>s&&t.push({id:"plot-ref-".concat(r.id,"-").concat(n.targetChapterId),type:"plot",severity:"error",message:"Chapter ".concat(s+1," references events from Chapter ").concat(i+1," which comes later"),chapterIds:[r.id,n.targetChapterId],suggestion:"Reorder chapters to maintain chronological consistency",autoFixable:!0})}}),r.metadata.majorEvents.forEach(e=>{n.add(e)})}return t}checkTimelineConsistency(e){let t=[];for(let n=1;n<e.length;n++){let s=e[n],r=e[n-1];s.metadata.timeframe&&r.metadata.timeframe&&(r.metadata.timeframe.includes("after")&&s.metadata.timeframe.includes("before")||s.metadata.timeframe.includes("before"))&&t.push({id:"timeline-".concat(s.id),type:"timeline",severity:"warning",message:"Chapter ".concat(n+1,' "').concat(s.title,'" appears to go backward in time'),chapterIds:[s.id],suggestion:"Verify this flashback is intentional and properly signaled to readers",autoFixable:!1})}return t}checkLocationIntroductions(e){let t=[],n=new Set;for(let s=0;s<e.length;s++){let r=e[s];for(let e of r.metadata.location){let a=this.manuscript.content.locations.find(t=>t.name===e);a&&!n.has(e)&&a.firstMention!==r.id&&t.push({id:"location-".concat(r.id,"-").concat(e),type:"location",severity:"info",message:"Chapter ".concat(s+1,' uses location "').concat(e,'" before its first mention'),chapterIds:[r.id],suggestion:"Consider adding location description or moving after first mention",autoFixable:!1}),n.add(e)}}return t}checkTensionProgression(e){let t=[];for(let n=1;n<e.length;n++){let s=e[n],r=e[n-1];s.metadata.tensionLevel&&r.metadata.tensionLevel&&(r.metadata.tensionLevel-s.metadata.tensionLevel>4&&t.push({id:"tension-drop-".concat(s.id),type:"plot",severity:"info",message:"Large tension drop from Chapter ".concat(n," to ").concat(n+1," (").concat(r.metadata.tensionLevel," → ").concat(s.metadata.tensionLevel,")"),chapterIds:[r.id,s.id],suggestion:"Consider smoothing the tension transition or ensuring this dramatic drop serves the story",autoFixable:!1}),s.metadata.tensionLevel<3&&r.metadata.tensionLevel<3&&t.push({id:"low-tension-".concat(s.id),type:"plot",severity:"warning",message:"Chapters ".concat(n," and ").concat(n+1," both have low tension levels"),chapterIds:[r.id,s.id],suggestion:"Consider increasing tension or adding conflict to maintain reader engagement",autoFixable:!1}))}return t}async suggestOptimalOrder(){let e=this.manuscript.content.chapters,t=[],n=[...e].sort((e,t)=>{let n=e.dependencies.requiredKnowledge.length,s=t.dependencies.requiredKnowledge.length;return n!==s?n-s:(e.metadata.tensionLevel||0)-(t.metadata.tensionLevel||0)});return t.push("Ordered chapters by dependency complexity (simple concepts first)"),t.push("Applied gradual tension progression where possible"),t.push("Maintained character introduction order"),{order:n.map(e=>e.id),reasoning:t}}async analyzeOrderQuality(e){let t=await this.analyzeConsistency(e),n=t.filter(e=>"error"===e.severity).length,s=t.filter(e=>"warning"===e.severity).length,r=t.filter(e=>"info"===e.severity).length,a=Math.max(0,100-(3*n+2*s+ +r)/(10*this.manuscript.content.chapters.length)*100),i=[],o=[];return 0===n?i.push("No critical story flow issues detected"):o.push("Fix ".concat(n," critical error").concat(n>1?"s":"")),0===s?i.push("Good character and concept introduction order"):o.push("Address ".concat(s," potential issue").concat(s>1?"s":"")),r<3?i.push("Well-structured narrative flow"):o.push("Consider optimization suggestions for better flow"),{score:Math.round(a),issues:n+s+r,strengths:i,improvements:o}}constructor(e){this.manuscript=e}}class et{async exportVersion(e){let t=this.manuscript.versions.get(e.versionId);if(!t)throw Error("Version ".concat(e.versionId," not found"));let n=this.getChaptersInOrder(t);switch(e.format){case"txt":return this.exportAsText(n,e);case"markdown":return this.exportAsMarkdown(n,e);case"docx":return this.exportAsDocx(n,e);case"pdf":return this.exportAsPdf(n,e);default:throw Error("Unsupported export format: ".concat(e.format))}}async generateComparisonReport(e,t){let n=this.manuscript.versions.get(e),s=this.manuscript.versions.get(t);if(!n||!s)throw Error("One or both versions not found");let r="# Version Comparison Report\n\n";r+="**Base Version:** ".concat(n.name,"\n"),r+="**Compare Version:** ".concat(s.name,"\n"),r+="**Generated:** ".concat(new Date().toISOString(),"\n\n"),r+="## Chapter Order Changes\n\n";let a=n.chapterOrder,i=s.chapterOrder;if(JSON.stringify(a)===JSON.stringify(i))r+="*No chapter order changes*\n\n";else{r+="| Position | Base Version | Compare Version |\n",r+="|----------|--------------|----------------|\n";let e=Math.max(a.length,i.length);for(let t=0;t<e;t++){let e=a[t]?this.getChapterTitle(a[t]):"-",n=i[t]?this.getChapterTitle(i[t]):"-";r+="| ".concat(t+1," | ").concat(e," | ").concat(n," |\n")}r+="\n"}return r+="## Summary\n\n",r+="- **Base version chapters:** ".concat(a.length,"\n"),r+="- **Compare version chapters:** ".concat(i.length,"\n"),r+="- **Changes made:** ".concat(s.changes.length,"\n\n"),s.changes.length>0&&(r+="## Change Log\n\n",s.changes.forEach((e,t)=>{r+="".concat(t+1,". **").concat(e.type,"**: ").concat(e.description,"\n"),r+="   - *".concat(e.timestamp.toISOString(),"*\n")})),r}getChaptersInOrder(e){return e.chapterOrder.map(e=>this.manuscript.content.chapters.find(t=>t.id===e)).filter(Boolean)}async exportAsText(e,t){let n="",s=t.customTitle||this.manuscript.metadata.title,r=t.customAuthor||this.manuscript.metadata.author;if(n+="".concat(s.toUpperCase(),"\n"),n+="by ".concat(r,"\n\n"),n+="".concat(this.manuscript.metadata.wordCount.toLocaleString()," words\n\n"),t.includeOutline&&(n+="OUTLINE\n",n+="=======\n\n",e.forEach((e,t)=>{n+="Chapter ".concat(t+1,": ").concat(e.title,"\n"),e.metadata.majorEvents.length>0&&(n+="   Events: ".concat(e.metadata.majorEvents.join(", "),"\n"))}),n+="\n\n"),e.forEach((e,s)=>{t.pageBreakBetweenChapters&&s>0&&(n+="\f"),n+="Chapter ".concat(s+1,": ").concat(e.title,"\n\n"),n+=e.content+"\n\n"}),t.includeMetadata){var a;n+="\n\nMETADATA\n",n+="=========\n\n",n+="Genre: ".concat(this.manuscript.metadata.genre,"\n"),n+="Total Word Count: ".concat(this.manuscript.metadata.wordCount.toLocaleString(),"\n"),n+="Chapter Count: ".concat(e.length,"\n"),n+="Version: ".concat(null==(a=this.manuscript.versions.get(t.versionId))?void 0:a.name,"\n"),n+="Last Modified: ".concat(this.manuscript.metadata.lastModified.toISOString(),"\n")}return new Blob([n],{type:"text/plain;charset=utf-8"})}async exportAsMarkdown(e,t){let n="",s=t.customTitle||this.manuscript.metadata.title,r=t.customAuthor||this.manuscript.metadata.author;if(n+="# ".concat(s,"\n\n"),n+="**by ".concat(r,"**\n\n"),n+="*".concat(this.manuscript.metadata.wordCount.toLocaleString()," words*\n\n"),t.includeOutline&&(n+="## Outline\n\n",e.forEach((e,t)=>{n+="".concat(t+1,". **").concat(e.title,"** _(").concat(e.wordCount," words)_\n"),e.metadata.majorEvents.length>0&&(n+="   - Events: ".concat(e.metadata.majorEvents.join(", "),"\n"))}),n+="\n---\n\n"),e.forEach((e,s)=>{t.pageBreakBetweenChapters&&s>0&&(n+='\n<div style="page-break-before: always;"></div>\n\n'),n+="## Chapter ".concat(s+1,": ").concat(e.title,"\n\n"),t.includeNotes&&(e.metadata.pov||e.metadata.location.length>0)&&(n+="> **Chapter Details:**\n",e.metadata.pov&&(n+="> - POV: ".concat(e.metadata.pov,"\n")),e.metadata.location.length>0&&(n+="> - Location: ".concat(e.metadata.location.join(", "),"\n")),e.metadata.tensionLevel&&(n+="> - Tension Level: ".concat(e.metadata.tensionLevel,"/10\n")),n+="\n"),n+=e.content+"\n\n"}),t.includeMetadata){var a;n+="---\n\n",n+="## Manuscript Details\n\n",n+="- **Genre:** ".concat(this.manuscript.metadata.genre,"\n"),n+="- **Total Word Count:** ".concat(this.manuscript.metadata.wordCount.toLocaleString(),"\n"),n+="- **Chapter Count:** ".concat(e.length,"\n"),n+="- **Version:** ".concat(null==(a=this.manuscript.versions.get(t.versionId))?void 0:a.name,"\n"),n+="- **Last Modified:** ".concat(this.manuscript.metadata.lastModified.toLocaleDateString(),"\n")}return new Blob([n],{type:"text/markdown;charset=utf-8"})}async exportAsDocx(e,t){var n,s,r,a,i;let o='\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <title>'.concat(t.customTitle||this.manuscript.metadata.title,"</title>\n    <style>\n        body {\n            font-family: ").concat(t.fontFamily||"Times New Roman",", serif;\n            font-size: ").concat(t.fontSize||12,"pt;\n            line-height: ").concat(t.lineSpacing||2,";\n            margin: ").concat((null==(n=t.margins)?void 0:n.top)||1,"in ").concat((null==(s=t.margins)?void 0:s.right)||1,"in ").concat((null==(r=t.margins)?void 0:r.bottom)||1,"in ").concat((null==(a=t.margins)?void 0:a.left)||1,"in;\n            color: black;\n        }\n        .title-page {\n            text-align: center;\n            page-break-after: always;\n            margin-top: 3in;\n        }\n        .title {\n            font-size: 24pt;\n            font-weight: bold;\n            margin-bottom: 2in;\n        }\n        .author {\n            font-size: 18pt;\n            margin-bottom: 1in;\n        }\n        .wordcount {\n            font-size: 12pt;\n            font-style: italic;\n        }\n        .chapter-title {\n            text-align: center;\n            font-weight: bold;\n            margin-top: 1in;\n            margin-bottom: 0.5in;\n            page-break-before: ").concat(t.pageBreakBetweenChapters?"always":"auto",";\n        }\n        .chapter-content {\n            text-align: left;\n            text-indent: 0.5in;\n        }\n        .outline {\n            page-break-after: always;\n        }\n        .metadata {\n            page-break-before: always;\n            font-size: 10pt;\n        }\n        p {\n            margin-bottom: 12pt;\n            text-indent: 0.5in;\n        }\n        p:first-child {\n            text-indent: 0;\n        }\n    </style>\n</head>\n<body>\n"),c=t.customTitle||this.manuscript.metadata.title,l=t.customAuthor||this.manuscript.metadata.author;return o+='\n    <div class="title-page">\n        <div class="title">'.concat(c,'</div>\n        <div class="author">by ').concat(l,'</div>\n        <div class="wordcount">').concat(this.manuscript.metadata.wordCount.toLocaleString()," words</div>\n    </div>\n"),t.includeOutline&&(o+='<div class="outline"><h2>Outline</h2><ul>',e.forEach((e,t)=>{o+="<li><strong>Chapter ".concat(t+1,": ").concat(e.title,"</strong> (").concat(e.wordCount," words)"),e.metadata.majorEvents.length>0&&(o+="<br><em>Events: ".concat(e.metadata.majorEvents.join(", "),"</em>")),o+="</li>"}),o+="</ul></div>"),e.forEach((e,t)=>{o+='<div class="chapter-title">Chapter '.concat(t+1,": ").concat(e.title,"</div>"),o+='<div class="chapter-content">',e.content.split("\n\n").forEach(e=>{e.trim()&&(o+="<p>".concat(e.trim(),"</p>"))}),o+="</div>"}),t.includeMetadata&&(o+='\n      <div class="metadata">\n          <h3>Manuscript Details</h3>\n          <p><strong>Genre:</strong> '.concat(this.manuscript.metadata.genre,"</p>\n          <p><strong>Total Word Count:</strong> ").concat(this.manuscript.metadata.wordCount.toLocaleString(),"</p>\n          <p><strong>Chapter Count:</strong> ").concat(e.length,"</p>\n          <p><strong>Version:</strong> ").concat(null==(i=this.manuscript.versions.get(t.versionId))?void 0:i.name,"</p>\n          <p><strong>Last Modified:</strong> ").concat(this.manuscript.metadata.lastModified.toLocaleDateString(),"</p>\n      </div>\n")),new Blob([o+="</body></html>"],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})}async exportAsPdf(e,t){var n,s,r,a,i;let o='\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <title>'.concat(t.customTitle||this.manuscript.metadata.title,"</title>\n    <style>\n        @page {\n            size: 8.5in 11in;\n            margin: ").concat((null==(n=t.margins)?void 0:n.top)||1,"in ").concat((null==(s=t.margins)?void 0:s.right)||1,"in ").concat((null==(r=t.margins)?void 0:r.bottom)||1,"in ").concat((null==(a=t.margins)?void 0:a.left)||1,"in;\n        }\n        \n        body {\n            font-family: ").concat(t.fontFamily||"Times New Roman",", serif;\n            font-size: ").concat(t.fontSize||12,"pt;\n            line-height: ").concat(t.lineSpacing||1.5,";\n            color: black;\n            margin: 0;\n            padding: 0;\n        }\n        \n        .title-page {\n            text-align: center;\n            page-break-after: always;\n            height: 100vh;\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n        }\n        \n        .title {\n            font-size: 24pt;\n            font-weight: bold;\n            margin-bottom: 2in;\n        }\n        \n        .author {\n            font-size: 18pt;\n            margin-bottom: 1in;\n        }\n        \n        .wordcount {\n            font-size: 12pt;\n            font-style: italic;\n        }\n        \n        .chapter-title {\n            text-align: center;\n            font-weight: bold;\n            font-size: 16pt;\n            margin-top: 1in;\n            margin-bottom: 0.5in;\n            page-break-before: ").concat(t.pageBreakBetweenChapters?"always":"auto",";\n        }\n        \n        .chapter-content {\n            text-align: justify;\n            hyphens: auto;\n        }\n        \n        .chapter-content p {\n            margin-bottom: 12pt;\n            text-indent: 0.5in;\n        }\n        \n        .chapter-content p:first-child {\n            text-indent: 0;\n        }\n        \n        .outline {\n            page-break-after: always;\n        }\n        \n        .metadata {\n            page-break-before: always;\n            font-size: 10pt;\n        }\n        \n        h1, h2, h3 {\n            font-weight: bold;\n        }\n        \n        .page-number::after {\n            content: counter(page);\n        }\n        \n        @media print {\n            body {\n                -webkit-print-color-adjust: exact;\n            }\n        }\n    </style>\n</head>\n<body>\n"),c=t.customTitle||this.manuscript.metadata.title,l=t.customAuthor||this.manuscript.metadata.author;return o+='\n    <div class="title-page">\n        <div class="title">'.concat(c,'</div>\n        <div class="author">by ').concat(l,'</div>\n        <div class="wordcount">').concat(this.manuscript.metadata.wordCount.toLocaleString()," words</div>\n    </div>\n"),t.includeOutline&&(o+='<div class="outline"><h2>Outline</h2><ol>',e.forEach((e,t)=>{o+="<li><strong>".concat(e.title,"</strong> (").concat(e.wordCount," words)"),e.metadata.majorEvents.length>0&&(o+="<br><em>Key events: ".concat(e.metadata.majorEvents.join(", "),"</em>")),o+="</li>"}),o+="</ol></div>"),e.forEach((e,t)=>{o+='<div class="chapter-title">Chapter '.concat(t+1,": ").concat(e.title,"</div>"),o+='<div class="chapter-content">',e.content.split("\n\n").forEach(e=>{e.trim()&&(o+="<p>".concat(e.trim(),"</p>"))}),o+="</div>"}),t.includeMetadata&&(o+='\n      <div class="metadata">\n          <h3>Publication Details</h3>\n          <p><strong>Genre:</strong> '.concat(this.manuscript.metadata.genre,"</p>\n          <p><strong>Word Count:</strong> ").concat(this.manuscript.metadata.wordCount.toLocaleString(),"</p>\n          <p><strong>Chapters:</strong> ").concat(e.length,"</p>\n          <p><strong>Version:</strong> ").concat(null==(i=this.manuscript.versions.get(t.versionId))?void 0:i.name,"</p>\n          <p><strong>Prepared:</strong> ").concat(new Date().toLocaleDateString(),"</p>\n      </div>\n")),new Blob([o+="</body></html>"],{type:"application/pdf"})}getChapterTitle(e){let t=this.manuscript.content.chapters.find(t=>t.id===e);return t?t.title:"Chapter ".concat(e)}async getExportStats(e){var t;let n,s,r=this.manuscript.versions.get(e.versionId);if(!r)throw Error("Version ".concat(e.versionId," not found"));let a=this.getChaptersInOrder(r).map(e=>e.content).join(" "),i=a.split(/\s+/).length,o=a.length;switch(e.format){case"txt":n=1.1*o,s=Math.ceil(i/250);break;case"markdown":n=1.2*o,s=Math.ceil(i/250);break;case"docx":n=3*o,s=Math.ceil(i/250);break;case"pdf":n=5*o,s=Math.ceil(i/250);break;default:n=o,s=Math.ceil(i/250)}return{estimatedFileSize:(t=n)<1024?"".concat(t," B"):t<1048576?"".concat((t/1024).toFixed(1)," KB"):"".concat((t/1048576).toFixed(1)," MB"),pageCount:s,wordCount:i,characterCount:o}}constructor(e){this.manuscript=e}}class en{initializeBenchmarks(){this.benchmarks={excellent:{editorLoadTime:1e3,averageTypingLatency:16,chapterSwitchTime:300,saveOperationTime:200,reorderOperationTime:500,consistencyCheckTime:1e3,exportOperationTime:2e3,memoryUsage:50,keystrokesPerMinute:300,wordsWrittenPerHour:1e3,editingEfficiency:.9},good:{editorLoadTime:2e3,averageTypingLatency:33,chapterSwitchTime:600,saveOperationTime:500,reorderOperationTime:1e3,consistencyCheckTime:2e3,exportOperationTime:5e3,memoryUsage:100,keystrokesPerMinute:200,wordsWrittenPerHour:750,editingEfficiency:.75},acceptable:{editorLoadTime:3e3,averageTypingLatency:50,chapterSwitchTime:1e3,saveOperationTime:1e3,reorderOperationTime:2e3,consistencyCheckTime:3e3,exportOperationTime:8e3,memoryUsage:150,keystrokesPerMinute:150,wordsWrittenPerHour:500,editingEfficiency:.6},poor:{editorLoadTime:5e3,averageTypingLatency:100,chapterSwitchTime:2e3,saveOperationTime:2e3,reorderOperationTime:4e3,consistencyCheckTime:5e3,exportOperationTime:15e3,memoryUsage:250,keystrokesPerMinute:100,wordsWrittenPerHour:250,editingEfficiency:.4}}}startPeriodicMonitoring(){setInterval(()=>{this.recordMemoryUsage()},3e4),setInterval(()=>{this.calculateDerivedMetrics()},6e4)}startTimer(e){this.timers.set(e,performance.now())}endTimer(e){let t=this.timers.get(e);if(!t)return console.warn("Timer for operation '".concat(e,"' was not started")),0;let n=performance.now()-t;return this.timers.delete(e),n}recordEditorLoad(){let e=this.endTimer("editorLoad");this.metrics.editorLoadTime=e}recordTypingLatency(e){this.metrics.averageTypingLatency?this.metrics.averageTypingLatency=.9*this.metrics.averageTypingLatency+.1*e:this.metrics.averageTypingLatency=e}recordKeystroke(){let e=Date.now();this.keystrokeBuffer.push(e);let t=e-6e4;this.keystrokeBuffer=this.keystrokeBuffer.filter(e=>e>t)}recordMemoryUsage(){if("memory"in performance){let e=performance.memory.usedJSHeapSize/1024/1024;if(this.metrics.memoryUsage=e,this.memoryHistory.push(e),this.memoryHistory.length>20&&this.memoryHistory.shift(),(!this.metrics.memoryPeak||e>this.metrics.memoryPeak)&&(this.metrics.memoryPeak=e),this.memoryHistory.length>=3){let e=this.memoryHistory.slice(-3),t=this.calculateMemoryTrend(e);this.metrics.memoryTrend=t}}}calculateMemoryTrend(e){if(e.length<2)return"stable";let t=[];for(let n=1;n<e.length;n++)t.push(e[n]-e[n-1]);let n=t.reduce((e,t)=>e+t,0)/t.length;return 1>Math.abs(n)?"stable":n>0?"increasing":"decreasing"}recordChapterSwitch(){let e=this.endTimer("chapterSwitch");return this.metrics.chapterSwitchTime=e,e}recordSaveOperation(){let e=this.endTimer("saveOperation");this.metrics.saveOperationTime=e;let t=Date.now()-this.sessionStart;return this.metrics.saveFrequency=t/(this.metrics.saveFrequency||1),e}recordReorderOperation(){let e=this.endTimer("reorderOperation");return this.metrics.reorderOperationTime=e,this.metrics.reorderOperationsPerSession=(this.metrics.reorderOperationsPerSession||0)+1,e}recordConsistencyCheck(){let e=this.endTimer("consistencyCheck");return this.metrics.consistencyCheckTime=e,e}recordExportOperation(){let e=this.endTimer("exportOperation");return this.metrics.exportOperationTime=e,e}recordError(e){this.metrics.errorCount=(this.metrics.errorCount||0)+1,console.error("Performance Monitor - Error recorded:",e)}recordWarning(e){this.metrics.warningCount=(this.metrics.warningCount||0)+1,console.warn("Performance Monitor - Warning recorded:",e)}recordCrash(){this.metrics.crashCount=(this.metrics.crashCount||0)+1}recordWordsWritten(e){let t=(Date.now()-this.sessionStart)/36e5;this.metrics.wordsWrittenPerHour=e/t}recordModeSwitch(e){if(Date.now(),"edit"===e)this.startTimer("editMode");else if("reorder"===e){if(this.startTimer("reorderMode"),this.timers.has("editMode")){let e=this.endTimer("editMode");this.metrics.timeInEditMode=(this.metrics.timeInEditMode||0)+e}}else{if(this.timers.has("editMode")){let e=this.endTimer("editMode");this.metrics.timeInEditMode=(this.metrics.timeInEditMode||0)+e}if(this.timers.has("reorderMode")){let e=this.endTimer("reorderMode");this.metrics.timeInReorderMode=(this.metrics.timeInReorderMode||0)+e}}}calculateDerivedMetrics(){if(this.metrics.keystrokesPerMinute=this.keystrokeBuffer.length,this.metrics.timeInEditMode&&this.metrics.wordsWrittenPerHour){let e=this.metrics.timeInEditMode/36e5;this.metrics.editingEfficiency=this.metrics.wordsWrittenPerHour*e/1e3}}getMetrics(){return this.recordMemoryUsage(),this.calculateDerivedMetrics(),this.metrics}getBenchmarkLevel(e,t){let n=this.benchmarks.excellent[e],s=this.benchmarks.good[e],r=this.benchmarks.acceptable[e];return e.includes("Time")||e.includes("Latency")||"memoryUsage"===e?t<=n?"excellent":t<=s?"good":t<=r?"acceptable":"poor":t>=n?"excellent":t>=s?"good":t>=r?"acceptable":"poor"}generateRecommendations(){let e=this.getMetrics(),t=[];return e.editorLoadTime&&e.editorLoadTime>3e3&&t.push("\uD83D\uDC0C Editor load time is slow. Consider reducing initial bundle size or enabling code splitting."),e.averageTypingLatency&&e.averageTypingLatency>50&&t.push("⌨️ Typing latency is high. Consider debouncing operations or optimizing editor extensions."),e.memoryUsage&&e.memoryUsage>150&&t.push("\uD83E\uDDE0 Memory usage is high. Check for memory leaks in editor or store."),"increasing"===e.memoryTrend&&t.push("\uD83D\uDCC8 Memory usage is increasing over time. Monitor for potential memory leaks."),e.chapterSwitchTime&&e.chapterSwitchTime>1e3&&t.push("\uD83D\uDCC4 Chapter switching is slow. Consider preloading or optimizing chapter loading."),e.saveOperationTime&&e.saveOperationTime>1e3&&t.push("\uD83D\uDCBE Save operations are slow. Consider optimizing data serialization."),e.reorderOperationTime&&e.reorderOperationTime>2e3&&t.push("\uD83D\uDD04 Chapter reordering is slow. Consider optimizing drag-and-drop implementation."),e.consistencyCheckTime&&e.consistencyCheckTime>3e3&&t.push("\uD83D\uDD0D Consistency checking is slow. Consider optimizing analysis algorithms."),e.exportOperationTime&&e.exportOperationTime>1e4&&t.push("\uD83D\uDCE4 Export operations are slow. Consider implementing background processing."),e.errorCount&&e.errorCount>5&&t.push("❌ High error count detected. Review error logs and implement fixes."),e.editingEfficiency&&e.editingEfficiency<.5&&t.push("⚡ Editing efficiency is low. Consider simplifying the interface or adding productivity features."),e.keystrokesPerMinute&&e.keystrokesPerMinute<50&&t.push("\uD83C\uDFAF Low activity detected. Consider adding engagement features or reducing friction."),0===t.length&&t.push("✅ All performance metrics are within acceptable ranges. Great job!"),t}generateReport(){let e=this.getMetrics(),t=e=>e?"".concat(e.toFixed(2),"ms"):"N/A",n=e=>e?"".concat(e.toFixed(2),"MB"):"N/A",s=e=>e?e.toFixed(2):"N/A",r=(e,t)=>{if(!t)return"❓";switch(this.getBenchmarkLevel(e,t)){case"excellent":return"\uD83D\uDFE2";case"good":return"\uD83D\uDFE1";case"acceptable":return"\uD83D\uDFE0";case"poor":return"\uD83D\uDD34"}};return"\n# Performance Report\n\n## ⏱️ Timing Metrics\n- **Editor Load Time:** ".concat(t(e.editorLoadTime)," ").concat(r("editorLoadTime",e.editorLoadTime),"\n- **Average Typing Latency:** ").concat(t(e.averageTypingLatency)," ").concat(r("averageTypingLatency",e.averageTypingLatency),"\n- **Chapter Switch Time:** ").concat(t(e.chapterSwitchTime)," ").concat(r("chapterSwitchTime",e.chapterSwitchTime),"\n- **Save Operation Time:** ").concat(t(e.saveOperationTime)," ").concat(r("saveOperationTime",e.saveOperationTime),"\n- **Reorder Operation Time:** ").concat(t(e.reorderOperationTime)," ").concat(r("reorderOperationTime",e.reorderOperationTime),"\n- **Consistency Check Time:** ").concat(t(e.consistencyCheckTime)," ").concat(r("consistencyCheckTime",e.consistencyCheckTime),"\n- **Export Operation Time:** ").concat(t(e.exportOperationTime)," ").concat(r("exportOperationTime",e.exportOperationTime),"\n\n## \uD83E\uDDE0 Memory Metrics\n- **Current Memory Usage:** ").concat(n(e.memoryUsage)," ").concat(r("memoryUsage",e.memoryUsage),"\n- **Peak Memory Usage:** ").concat(n(e.memoryPeak),"\n- **Memory Trend:** ").concat(e.memoryTrend||"Unknown"," ").concat("stable"===e.memoryTrend?"\uD83D\uDFE2":"increasing"===e.memoryTrend?"\uD83D\uDD34":"\uD83D\uDFE1","\n\n## \uD83D\uDCCA Productivity Metrics\n- **Keystrokes Per Minute:** ").concat(s(e.keystrokesPerMinute)," ").concat(r("keystrokesPerMinute",e.keystrokesPerMinute),"\n- **Words Written Per Hour:** ").concat(s(e.wordsWrittenPerHour)," ").concat(r("wordsWrittenPerHour",e.wordsWrittenPerHour),"\n- **Editing Efficiency:** ").concat(s(e.editingEfficiency)," ").concat(r("editingEfficiency",e.editingEfficiency),"\n- **Time in Edit Mode:** ").concat(t(e.timeInEditMode),"\n- **Time in Reorder Mode:** ").concat(t(e.timeInReorderMode),"\n\n## \uD83D\uDD27 System Health\n- **Error Count:** ").concat(e.errorCount||0,"\n- **Warning Count:** ").concat(e.warningCount||0,"\n- **Crash Count:** ").concat(e.crashCount||0,"\n\n## \uD83D\uDCA1 Recommendations\n\n").concat(this.generateRecommendations().map(e=>"- ".concat(e)).join("\n"),"\n\n---\n*Report generated at ").concat(new Date().toISOString(),"*\n    ").trim()}reset(){this.metrics={},this.timers.clear(),this.sessionStart=Date.now(),this.keystrokeBuffer=[],this.memoryHistory=[]}exportMetrics(){return JSON.stringify(this.metrics,null,2)}importMetrics(e){try{this.metrics=JSON.parse(e)}catch(e){console.error("Failed to import metrics:",e)}}constructor(){this.metrics={},this.timers=new Map,this.sessionStart=Date.now(),this.keystrokeBuffer=[],this.memoryHistory=[],this.initializeBenchmarks(),this.startPeriodicMonitoring()}}let es=new en;es.startTimer("editorLoad");let er=(0,Q.vt)()((0,X.lt)((0,X.Zr)((e,t)=>({manuscript:null,isLoading:!1,error:null,currentVersion:null,availableVersions:[],isComparingVersions:!1,comparisonResult:null,activeChapterId:null,editorMode:"edit",unsavedChanges:!1,consistencyReport:null,consistencyCheckEnabled:!0,actions:{initialize:async()=>{e({isLoading:!0,error:null});try{var t;if(!window.__TAURI__){let t={id:"default",metadata:{title:"New Manuscript",author:"Author Name",genre:"techno-thriller",wordCount:0,characterCount:0,chapterCount:0,lastModified:new Date,created:new Date,version:"1.0.0"},content:{chapters:[],characters:[],locations:[],techConcepts:[],timeline:[],notes:[]},versions:new Map,currentVersionId:"original",settings:{autoSave:!0,autoSaveInterval:30,showWordCount:!0,showCharacterCount:!0,enableConsistencyChecking:!0,highlightInconsistencies:!0,defaultView:"editor"}},n={id:"original",name:"Original",description:"Original chapter order",chapterOrder:[],created:new Date,isBaseVersion:!0,changes:[]};t.versions.set("original",n),e({manuscript:t,currentVersion:n,availableVersions:[n],activeChapterId:null,isLoading:!1,error:null});return}let{invoke:n}=await Promise.resolve().then(function(){var e=Error("Cannot find module '@tauri-apps/api/tauri'");throw e.code="MODULE_NOT_FOUND",e}),s=await n("get_manuscript"),r=await n("get_all_scenes");if(!s)throw Error("No manuscript found in database");let a=(r||[]).map((e,t)=>({id:e.id,number:e.chapter_number||t+1,title:e.title||"Chapter ".concat(e.chapter_number||t+1),content:e.raw_text,wordCount:e.word_count,originalPosition:e.index_in_manuscript,currentPosition:e.index_in_manuscript+1,dependencies:{requiredKnowledge:[],introduces:[],references:[],continuityRules:[]},metadata:{pov:e.pov_character||"Unknown",location:e.location?[e.location]:[],timeframe:e.time_marker||"",tensionLevel:5,majorEvents:[],techElements:[],characterArcs:[]}})),i={id:s.id,metadata:{title:s.title,author:s.author||"Unknown Author",genre:s.genre,wordCount:s.total_word_count,characterCount:0,chapterCount:a.length,lastModified:new Date(s.updated_at),created:new Date(s.created_at),version:"1.0.0"},content:{chapters:a,characters:[],locations:[],techConcepts:[],timeline:[],notes:[]},versions:new Map,currentVersionId:"original",settings:{autoSave:!0,autoSaveInterval:30,showWordCount:!0,showCharacterCount:!0,enableConsistencyChecking:!0,highlightInconsistencies:!0,defaultView:"editor"}},o={id:"original",name:"Original",description:"Original chapter order",chapterOrder:a.map(e=>e.id),created:new Date,isBaseVersion:!0,changes:[]};i.versions.set("original",o),e({manuscript:i,currentVersion:o,availableVersions:[o],activeChapterId:(null==(t=a[0])?void 0:t.id)||null,isLoading:!1,error:null})}catch(t){console.error("Failed to initialize manuscript:",t),e({error:t instanceof Error?t.message:"Failed to initialize manuscript",isLoading:!1})}},updateChapterContent:(n,s)=>{let r=t();if(!r.manuscript)return;let a=r.manuscript.content.chapters.find(e=>e.id===n);if(a){a.content=s,a.wordCount=s.split(/\s+/).filter(e=>e.length>0).length;let t=r.manuscript.content.chapters.reduce((e,t)=>e+t.wordCount,0),n=r.manuscript.content.chapters.reduce((e,t)=>e+t.content.length,0);e({manuscript:{...r.manuscript,metadata:{...r.manuscript.metadata,wordCount:t,characterCount:n,lastModified:new Date}},unsavedChanges:!0})}},updateChapterMetadata:(n,s)=>{let r=t();if(!r.manuscript)return;let a=r.manuscript.content.chapters.find(e=>e.id===n);a&&(Object.assign(a.metadata,s),e({manuscript:{...r.manuscript,metadata:{...r.manuscript.metadata,lastModified:new Date}},unsavedChanges:!0}))},createVersion:async(n,s)=>{let r=t();if(!r.manuscript||!r.currentVersion)throw Error("No manuscript loaded");let a="version_".concat(Date.now()),i={id:a,name:n,description:s,chapterOrder:[...r.currentVersion.chapterOrder],created:new Date,isBaseVersion:!1,parentVersionId:r.currentVersion.id,changes:[]};return r.manuscript.versions.set(a,i),e({manuscript:r.manuscript,availableVersions:Array.from(r.manuscript.versions.values())}),a},switchVersion:async n=>{let s=t();if(!s.manuscript)return;let r=s.manuscript.versions.get(n);if(!r)throw Error("Version ".concat(n," not found"));let a=r.chapterOrder.map(e=>s.manuscript.content.chapters.find(t=>t.id===e)).filter(Boolean);a.forEach((e,t)=>{e.currentPosition=t+1}),e({manuscript:{...s.manuscript,currentVersionId:n,content:{...s.manuscript.content,chapters:a}},currentVersion:r})},compareVersions:async(n,s)=>{let r=t();if(!r.manuscript)return;let a=r.manuscript.versions.get(n),i=r.manuscript.versions.get(s);if(!a||!i)throw Error("One or both versions not found");e({comparisonResult:{baseVersion:a,compareVersion:i,differences:[],reorderingAnalysis:{consistencyIssues:[],flowImpact:0,recommendedAdjustments:[],riskLevel:"low"}},isComparingVersions:!0})},reorderChapters:n=>{let s=t();if(!s.manuscript||!s.currentVersion)return;s.currentVersion.chapterOrder=n;let r=n.map(e=>s.manuscript.content.chapters.find(t=>t.id===e)).filter(Boolean);r.forEach((e,t)=>{e.currentPosition=t+1}),e({manuscript:{...s.manuscript,content:{...s.manuscript.content,chapters:r}},unsavedChanges:!0})},previewReordering:async e=>{let n=t();if(!n.manuscript)return{checks:[]};es.startTimer("reorderPreview");try{let t=new ee(n.manuscript),s=await t.analyzeConsistency(e);return es.endTimer("reorderPreview"),{checks:s}}catch(e){return es.endTimer("reorderPreview"),es.recordError(e),{checks:[]}}},applyReordering:async()=>{await t().actions.runConsistencyCheck(),e({unsavedChanges:!1})},cancelReordering:()=>{let e=t();if(e.currentVersion&&e.manuscript){let n=e.currentVersion.chapterOrder;t().actions.reorderChapters(n)}},runConsistencyCheck:async()=>{let n=t();if(n.manuscript){es.startTimer("consistencyCheck");try{let t=new ee(n.manuscript),s=await t.analyzeConsistency(),r={timestamp:new Date,checks:s,summary:{total:s.length,errors:s.filter(e=>"error"===e.severity).length,warnings:s.filter(e=>"warning"===e.severity).length,info:s.filter(e=>"info"===e.severity).length}};e({consistencyReport:r}),es.recordConsistencyCheck()}catch(t){es.endTimer("consistencyCheck"),es.recordError(t),e({error:"Consistency check failed"})}}},setActiveChapter:t=>{es.startTimer("chapterSwitch"),e({activeChapterId:t}),es.recordChapterSwitch()},setEditorMode:t=>{es.recordModeSwitch(t),e({editorMode:t})},markSaved:()=>{e({unsavedChanges:!1})},saveManuscript:async()=>{let n=t();if(n.manuscript){es.startTimer("saveOperation");try{let{invoke:t}=await Promise.resolve().then(function(){var e=Error("Cannot find module '@tauri-apps/api/tauri'");throw e.code="MODULE_NOT_FOUND",e});for(let e of(await t("update_manuscript",{manuscript:{id:n.manuscript.id,title:n.manuscript.metadata.title,author:n.manuscript.metadata.author,genre:n.manuscript.metadata.genre,target_audience:"Adult",comp_titles:"Various",created_at:n.manuscript.metadata.created.getTime(),updated_at:Date.now(),total_word_count:n.manuscript.metadata.wordCount,opening_strength_score:8,hook_effectiveness:7}}),n.manuscript.content.chapters))await t("update_scene",{scene:{id:e.id,chapter_number:e.metadata.chapterNumber,scene_number_in_chapter:e.metadata.sceneNumber,index_in_manuscript:e.currentPosition-1,title:e.title,raw_text:e.content,word_count:e.wordCount,is_opening:e.metadata.isOpening,is_chapter_end:e.metadata.isChapterEnd,opens_with_hook:e.metadata.opensWithHook,ends_with_hook:e.metadata.endsWithHook,pov_character:e.metadata.pov,location:e.metadata.location,time_marker:e.metadata.timeMarker,created_at:Date.now(),updated_at:Date.now()}});e({unsavedChanges:!1,manuscript:{...n.manuscript,metadata:{...n.manuscript.metadata,lastModified:new Date}}}),es.recordSaveOperation()}catch(e){throw es.endTimer("saveOperation"),es.recordError(e),console.error("Save failed:",e),Error("Failed to save manuscript")}}},exportVersion:async(n,s)=>{let r=t();if(r.manuscript){es.startTimer("exportOperation");try{let e=new et(r.manuscript),t=await e.exportVersion({format:s,versionId:n,includeMetadata:!0,includeOutline:!0,includeNotes:!1,pageBreakBetweenChapters:!0}),a=URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download="".concat(r.manuscript.metadata.title,"_").concat(n,".").concat(s),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),es.recordExportOperation()}catch(t){es.endTimer("exportOperation"),es.recordError(t),e({error:"Export failed: ".concat(t)})}}}}}),{name:"single-manuscript-store",partialize:e=>({manuscript:e.manuscript?function(e){return{...e,versions:Array.from(e.versions.entries())}}(e.manuscript):null,currentVersion:e.currentVersion,availableVersions:e.availableVersions,activeChapterId:e.activeChapterId,editorMode:e.editorMode}),merge:(e,t)=>({...t,...e,manuscript:e.manuscript?function(e){return{...e,versions:new Map(e.versions)}}(e.manuscript):null})}),{name:"single-manuscript-store"}));var ea=n(3853),ei=n(5196),eo=n(9428);let ec=ea.bL,el=ea.l9;ea.YJ,ea.ZL;let ed=ea.Pb;ea.z6;let em=r.forwardRef((e,t)=>{let{className:n,inset:r,children:a,...i}=e;return(0,s.jsxs)(ea.ZP,{ref:t,className:(0,T.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",n),...i,children:[a,(0,s.jsx)(K.A,{className:"ml-auto h-4 w-4"})]})});em.displayName=ea.ZP.displayName;let eh=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(ea.G5,{ref:t,className:(0,T.cn)("z-[9999] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...r})});eh.displayName=ea.G5.displayName;let eu=r.forwardRef((e,t)=>{let{className:n,sideOffset:r=4,...a}=e;return(0,s.jsx)(ea.ZL,{children:(0,s.jsx)(ea.UC,{ref:t,sideOffset:r,className:(0,T.cn)("z-[9999] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...a})})});eu.displayName=ea.UC.displayName;let ep=r.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,s.jsx)(ea.q7,{ref:t,className:(0,T.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",n),...a})});ep.displayName=ea.q7.displayName,r.forwardRef((e,t)=>{let{className:n,children:r,checked:a,...i}=e;return(0,s.jsxs)(ea.H_,{ref:t,className:(0,T.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:a,...i,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(ea.VF,{children:(0,s.jsx)(ei.A,{className:"h-4 w-4"})})}),r]})}).displayName=ea.H_.displayName,r.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,s.jsxs)(ea.hN,{ref:t,className:(0,T.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...a,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(ea.VF,{children:(0,s.jsx)(eo.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=ea.hN.displayName,r.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,s.jsx)(ea.JU,{ref:t,className:(0,T.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",n),...a})}).displayName=ea.JU.displayName;let ex=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(ea.wv,{ref:t,className:(0,T.cn)("-mx-1 my-1 h-px bg-muted",n),...r})});ex.displayName=ea.wv.displayName;let eg=e=>{let{className:t,...n}=e;return(0,s.jsx)("span",{className:(0,T.cn)("ml-auto text-xs tracking-widest opacity-60",t),...n})};eg.displayName="DropdownMenuShortcut";var ef=n(2775),ev=n(4229),ej=n(825);function ew(e){let{className:t}=e,{manuscript:n,editorMode:r,unsavedChanges:a}=er(),{saveManuscript:i,setEditorMode:o}=er(e=>e.actions),c=e=>{};return(0,s.jsxs)("div",{className:"bg-background border-b border-border h-8 flex items-center px-2 ".concat(t),children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 mr-4",children:[(0,s.jsxs)(N.$,{variant:"reorder"===r?"default":"ghost",size:"sm",onClick:()=>o("reorder"),className:"h-6 px-2 text-xs",children:[(0,s.jsx)(ej.A,{className:"h-3 w-3 mr-1"}),"Reorder"]}),(0,s.jsxs)(N.$,{variant:"compare"===r?"default":"ghost",size:"sm",onClick:()=>o("compare"),className:"h-6 px-2 text-xs",children:[(0,s.jsx)(ef.A,{className:"h-3 w-3 mr-1"}),"Versions"]}),(0,s.jsxs)(N.$,{variant:"ghost",size:"sm",onClick:i,disabled:!a,className:"h-6 px-2 text-xs",children:[(0,s.jsx)(ev.A,{className:"h-3 w-3 mr-1"}),a?"Save":"Saved"]})]}),(0,s.jsxs)(ec,{children:[(0,s.jsx)(el,{asChild:!0,children:(0,s.jsx)(N.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs font-normal",children:"File"})}),(0,s.jsxs)(eu,{align:"start",className:"w-48",children:[(0,s.jsxs)(ep,{onClick:()=>{i()},children:["Save",(0,s.jsx)(eg,{children:"Ctrl+S"})]}),(0,s.jsxs)(ep,{onClick:()=>{prompt("Save as filename:","".concat((null==n?void 0:n.metadata.title)||"manuscript",".txt"))},children:["Save As...",(0,s.jsx)(eg,{children:"Ctrl+Shift+S"})]}),(0,s.jsx)(ex,{}),(0,s.jsxs)(ed,{children:[(0,s.jsx)(em,{children:"Export"}),(0,s.jsxs)(eh,{className:"w-48",children:[(0,s.jsx)(ep,{onClick:()=>c("pdf"),children:"PDF Document"}),(0,s.jsx)(ep,{onClick:()=>c("docx"),children:"Word Document"}),(0,s.jsx)(ep,{onClick:()=>c("txt"),children:"Plain Text"}),(0,s.jsx)(ep,{onClick:()=>c("epub"),children:"EPUB eBook"})]})]}),(0,s.jsx)(ex,{}),(0,s.jsx)(ep,{onClick:()=>{},children:"Recent Files"}),(0,s.jsx)(ex,{}),(0,s.jsxs)(ep,{onClick:()=>{a?confirm("You have unsaved changes. Are you sure you want to exit?")&&window.close():window.close()},children:["Exit",(0,s.jsx)(eg,{children:"Ctrl+Q"})]})]})]}),(0,s.jsxs)(ec,{children:[(0,s.jsx)(el,{asChild:!0,children:(0,s.jsx)(N.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs font-normal",children:"Edit"})}),(0,s.jsxs)(eu,{align:"start",className:"w-48",children:[(0,s.jsxs)(ep,{onClick:()=>{document.execCommand("undo")},children:["Undo",(0,s.jsx)(eg,{children:"Ctrl+Z"})]}),(0,s.jsxs)(ep,{onClick:()=>{document.execCommand("redo")},children:["Redo",(0,s.jsx)(eg,{children:"Ctrl+Y"})]}),(0,s.jsx)(ex,{}),(0,s.jsxs)(ep,{onClick:()=>{document.execCommand("cut")},children:["Cut",(0,s.jsx)(eg,{children:"Ctrl+X"})]}),(0,s.jsxs)(ep,{onClick:()=>{document.execCommand("copy")},children:["Copy",(0,s.jsx)(eg,{children:"Ctrl+C"})]}),(0,s.jsxs)(ep,{onClick:()=>{document.execCommand("paste")},children:["Paste",(0,s.jsx)(eg,{children:"Ctrl+V"})]}),(0,s.jsx)(ex,{}),(0,s.jsxs)(ep,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-find"))},children:["Find",(0,s.jsx)(eg,{children:"Ctrl+F"})]}),(0,s.jsxs)(ep,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-find-replace"))},children:["Find and Replace",(0,s.jsx)(eg,{children:"Ctrl+H"})]}),(0,s.jsx)(ex,{}),(0,s.jsxs)(ep,{onClick:()=>{document.execCommand("selectAll")},children:["Select All",(0,s.jsx)(eg,{children:"Ctrl+A"})]})]})]}),(0,s.jsxs)(ec,{children:[(0,s.jsx)(el,{asChild:!0,children:(0,s.jsx)(N.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs font-normal",children:"View"})}),(0,s.jsxs)(eu,{align:"start",className:"w-48",children:[(0,s.jsxs)(ep,{onClick:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},children:["Full Screen",(0,s.jsx)(eg,{children:"F11"})]}),(0,s.jsxs)(ep,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-toggle-focus-mode"))},children:["Focus Mode",(0,s.jsx)(eg,{children:"Ctrl+Shift+F"})]}),(0,s.jsxs)(ep,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-toggle-typewriter-mode"))},children:["Typewriter Mode",(0,s.jsx)(eg,{children:"Ctrl+Shift+T"})]}),(0,s.jsx)(ex,{}),(0,s.jsxs)(ep,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-toggle-sidebar"))},children:["Show Sidebar",(0,s.jsx)(eg,{children:"Ctrl+\\\\"})]}),(0,s.jsxs)(ep,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-toggle-properties"))},children:["Show Properties",(0,s.jsx)(eg,{children:"Ctrl+;"})]}),(0,s.jsx)(ex,{}),(0,s.jsxs)(ep,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-zoom-in"))},children:["Zoom In",(0,s.jsx)(eg,{children:"Ctrl++"})]}),(0,s.jsxs)(ep,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-zoom-out"))},children:["Zoom Out",(0,s.jsx)(eg,{children:"Ctrl+-"})]}),(0,s.jsxs)(ep,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-reset-zoom"))},children:["Reset Zoom",(0,s.jsx)(eg,{children:"Ctrl+0"})]})]})]}),(0,s.jsxs)(ec,{children:[(0,s.jsx)(el,{asChild:!0,children:(0,s.jsx)(N.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs font-normal",children:"Tools"})}),(0,s.jsxs)(eu,{align:"start",className:"w-48",children:[(0,s.jsxs)(ep,{onClick:()=>{document.dispatchEvent(new CustomEvent("global-ai-analysis"))},children:["AI Analysis",(0,s.jsx)(eg,{children:"Ctrl+Shift+A"})]}),(0,s.jsxs)(ep,{onClick:()=>{},children:["Story Structure",(0,s.jsx)(eg,{children:"Ctrl+Shift+S"})]}),(0,s.jsxs)(ep,{onClick:()=>{},children:["Character Analysis",(0,s.jsx)(eg,{children:"Ctrl+Shift+C"})]}),(0,s.jsx)(ex,{}),(0,s.jsxs)(ep,{onClick:()=>{let e=((null==n?void 0:n.content.chapters.reduce((e,t)=>e+t.content,""))||"").split(/\s+/).filter(e=>e.length>0).length;alert("Word count: ".concat(e))},children:["Word Count",(0,s.jsx)(eg,{children:"Ctrl+Shift+W"})]}),(0,s.jsx)(ep,{onClick:()=>{let e=Math.ceil(((null==n?void 0:n.content.chapters.reduce((e,t)=>e+t.content,""))||"").split(/\s+/).filter(e=>e.length>0).length/250);alert("Estimated reading time: ".concat(e," minutes"))},children:"Reading Time"}),(0,s.jsx)(ex,{}),(0,s.jsxs)(ep,{onClick:()=>{},children:["Spell Check",(0,s.jsx)(eg,{children:"F7"})]}),(0,s.jsx)(ep,{onClick:()=>{},children:"Grammar Check"})]})]}),(0,s.jsxs)(ec,{children:[(0,s.jsx)(el,{asChild:!0,children:(0,s.jsx)(N.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs font-normal",children:"Help"})}),(0,s.jsxs)(eu,{align:"start",className:"w-48",children:[(0,s.jsxs)(ep,{onClick:()=>{alert("Keyboard Shortcuts:\n    \nFile:\n• Ctrl+S - Save\n• Ctrl+Shift+S - Save As\n\nEdit:\n• Ctrl+Z - Undo\n• Ctrl+Y - Redo\n• Ctrl+X - Cut\n• Ctrl+C - Copy\n• Ctrl+V - Paste\n• Ctrl+F - Find\n• Ctrl+H - Find & Replace\n• Ctrl+A - Select All\n\nView:\n• F11 - Full Screen\n• Ctrl+Shift+F - Focus Mode\n• Ctrl+Shift+T - Typewriter Mode\n\nTools:\n• Ctrl+Shift+A - AI Analysis\n• Ctrl+Shift+W - Word Count\n• F7 - Spell Check")},children:["Keyboard Shortcuts",(0,s.jsx)(eg,{children:"F1"})]}),(0,s.jsx)(ep,{onClick:()=>{window.open("/help","_blank")},children:"User Guide"}),(0,s.jsx)(ex,{}),(0,s.jsx)(ep,{onClick:()=>{alert("You are using the latest version of Narrative Surgeon.")},children:"Check for Updates"}),(0,s.jsx)(ep,{onClick:()=>{alert("Narrative Surgeon - Chapter Reordering Editor\nVersion 1.0.0\n\nA professional manuscript editor for chapter reordering and consistency checking.\n\n\xa9 2024 Narrative Surgeon")},children:"About Narrative Surgeon"})]})]}),(0,s.jsx)("div",{className:"flex-1 text-center text-xs text-muted-foreground",children:n?n.metadata.title:"Narrative Surgeon"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full bg-yellow-400"}),(0,s.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-400"}),(0,s.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-400"})]})]})}var ey=n(7733),eC=n(7325),eN=n(8702),eb=n(9727),ek=n(6474),eS=n(2657),eA=n(8749),eE=n(4347),eT=n(9144),eM=n(5968),eL=n(9140),eO=n(7918),ez=n(3127),eF=n(224),eI=n(3500),eR=n(7240),eD=n(1539);function eP(e){let{editor:t,className:n}=e,{unsavedChanges:r,saveCurrentScene:a,editorSettings:i,updateEditorSettings:o}=(0,J.C)(),c=async()=>{try{await a()}catch(e){console.error("Failed to save:",e)}},l=e=>{null==t||t.chain().focus().setTextAlign(e).run()};return(0,s.jsxs)("div",{className:"bg-background border-b border-border px-2 py-1.5 flex items-center gap-1 ".concat(n),children:[(0,s.jsxs)(N.$,{variant:r?"default":"ghost",size:"sm",onClick:c,disabled:!r,className:"h-7",children:[(0,s.jsx)(ev.A,{className:"w-3.5 h-3.5 mr-1"}),"Save"]}),(0,s.jsx)(D,{orientation:"vertical",className:"h-6 mx-1"}),(0,s.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>null==t?void 0:t.chain().focus().toggleBold().run(),className:"h-7 w-7 p-0 ".concat((null==t?void 0:t.isActive("bold"))?"bg-accent":""),title:"Bold (Ctrl+B)",children:(0,s.jsx)(eb.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>null==t?void 0:t.chain().focus().toggleItalic().run(),className:"h-7 w-7 p-0 ".concat((null==t?void 0:t.isActive("italic"))?"bg-accent":""),title:"Italic (Ctrl+I)",children:(0,s.jsx)(eT.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>null==t?void 0:t.chain().focus().toggleUnderline().run(),className:"h-7 w-7 p-0 ".concat((null==t?void 0:t.isActive("underline"))?"bg-accent":""),title:"Underline (Ctrl+U)",children:(0,s.jsx)(eR.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>null==t?void 0:t.chain().focus().toggleHighlight().run(),className:"h-7 w-7 p-0 ".concat((null==t?void 0:t.isActive("highlight"))?"bg-accent":""),title:"Highlight",children:(0,s.jsx)(eE.A,{className:"w-3.5 h-3.5"})})]}),(0,s.jsx)(D,{orientation:"vertical",className:"h-6 mx-1"}),(0,s.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>l("left"),className:"h-7 w-7 p-0 ".concat((null==t?void 0:t.isActive({textAlign:"left"}))?"bg-accent":""),title:"Align Left",children:(0,s.jsx)(eC.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>l("center"),className:"h-7 w-7 p-0 ".concat((null==t?void 0:t.isActive({textAlign:"center"}))?"bg-accent":""),title:"Align Center",children:(0,s.jsx)(ey.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>l("right"),className:"h-7 w-7 p-0 ".concat((null==t?void 0:t.isActive({textAlign:"right"}))?"bg-accent":""),title:"Align Right",children:(0,s.jsx)(eN.A,{className:"w-3.5 h-3.5"})})]}),(0,s.jsx)(D,{orientation:"vertical",className:"h-6 mx-1"}),(0,s.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>null==t?void 0:t.chain().focus().toggleBulletList().run(),className:"h-7 w-7 p-0 ".concat((null==t?void 0:t.isActive("bulletList"))?"bg-accent":""),title:"Bullet List",children:(0,s.jsx)(eM.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>null==t?void 0:t.chain().focus().toggleOrderedList().run(),className:"h-7 w-7 p-0 ".concat((null==t?void 0:t.isActive("orderedList"))?"bg-accent":""),title:"Numbered List",children:(0,s.jsx)(eL.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>null==t?void 0:t.chain().focus().toggleBlockquote().run(),className:"h-7 w-7 p-0 ".concat((null==t?void 0:t.isActive("blockquote"))?"bg-accent":""),title:"Quote",children:(0,s.jsx)(eF.A,{className:"w-3.5 h-3.5"})})]}),(0,s.jsx)(D,{orientation:"vertical",className:"h-6 mx-1"}),(0,s.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>{null==t||t.chain().focus().insertSceneBreak().run()},className:"h-7 px-2",title:"Insert Scene Break (Ctrl+Shift+Enter)",children:"***"}),(0,s.jsxs)(ec,{children:[(0,s.jsx)(el,{asChild:!0,children:(0,s.jsxs)(N.$,{variant:"ghost",size:"sm",className:"h-7 px-2",children:["Chapter",(0,s.jsx)(ek.A,{className:"w-3 h-3 ml-1"})]})}),(0,s.jsxs)(eu,{align:"start",children:[(0,s.jsx)(ep,{onClick:()=>null==t?void 0:t.chain().focus().insertChapterDivision({number:1}).run(),children:"New Chapter"}),(0,s.jsx)(ep,{children:"Part Division"})]})]})]}),(0,s.jsx)(D,{orientation:"vertical",className:"h-6 mx-1"}),(0,s.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,s.jsx)(N.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",title:"Find (Ctrl+F)",children:(0,s.jsx)(q.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>{o({focusMode:!i.focusMode})},className:"h-7 w-7 p-0 ".concat(i.focusMode?"bg-accent":""),title:"Focus Mode",children:i.focusMode?(0,s.jsx)(eA.A,{className:"w-3.5 h-3.5"}):(0,s.jsx)(eS.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",title:"Full Screen (F11)",children:(0,s.jsx)(eO.A,{className:"w-3.5 h-3.5"})})]}),(0,s.jsx)(D,{orientation:"vertical",className:"h-6 mx-1"}),(0,s.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,s.jsxs)(N.$,{variant:"ghost",size:"sm",className:"h-7 px-2",title:"AI Analysis (Ctrl+Shift+A)",children:[(0,s.jsx)(eD.A,{className:"w-3.5 h-3.5 mr-1"}),"AI"]}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",title:"Comments",children:(0,s.jsx)(Z.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",title:"Statistics",children:(0,s.jsx)($.A,{className:"w-3.5 h-3.5"})})]}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsxs)(ec,{children:[(0,s.jsx)(el,{asChild:!0,children:(0,s.jsx)(N.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",title:"Text Color",children:(0,s.jsx)(ez.A,{className:"w-3.5 h-3.5"})})}),(0,s.jsx)(eu,{align:"end",children:(0,s.jsx)("div",{className:"grid grid-cols-6 gap-1 p-2",children:["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#008000","#000080","#808080"].map(e=>(0,s.jsx)("button",{className:"w-6 h-6 rounded border border-border hover:scale-110 transition-transform",style:{backgroundColor:e},onClick:()=>null==t?void 0:t.chain().focus().setColor(e).run(),title:e},e))})})]}),(0,s.jsxs)(ec,{children:[(0,s.jsx)(el,{asChild:!0,children:(0,s.jsxs)(N.$,{variant:"ghost",size:"sm",className:"h-7 px-2",children:[(0,s.jsx)(eI.A,{className:"w-3.5 h-3.5 mr-1"}),i.fontSize,"px"]})}),(0,s.jsx)(eu,{align:"end",children:[12,14,16,18,20,24,28,32].map(e=>(0,s.jsxs)(ep,{onClick:()=>o({fontSize:e}),className:e===i.fontSize?"bg-accent":"",children:[e,"px"]},e))})]})]})]})}function e_(e){let{children:t}=e,[n,a]=(0,r.useState)(!1),[i,o]=(0,r.useState)(!1),[c]=(0,r.useState)(20),[l]=(0,r.useState)(25),{manuscripts:d,activeManuscript:m,scenes:h,setActiveScene:u,activeSceneId:p}=(0,J.C)(),x=(0,r.useCallback)(()=>{a(!n)},[n]),g=(0,r.useCallback)(()=>{o(!i)},[i]);return(0,s.jsxs)("div",{className:"h-screen flex flex-col bg-background",children:[(0,s.jsx)(ew,{}),(0,s.jsx)(eP,{}),(0,s.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,s.jsxs)(M,{direction:"horizontal",className:"h-full w-full",children:[(0,s.jsx)(L,{defaultSize:c,minSize:15*!n,maxSize:35,collapsible:!0,onCollapse:()=>a(!0),onExpand:()=>a(!1),children:(0,s.jsxs)("div",{className:"h-full border-r border-border bg-card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 border-b border-border",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold",children:"Project"}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:x,className:"h-6 w-6 p-0",children:(0,s.jsx)(W.A,{className:"h-3 w-3"})})]}),(0,s.jsxs)(_,{defaultValue:"files",className:"h-[calc(100%-3rem)]",children:[(0,s.jsxs)(V,{className:"grid w-full grid-cols-3",children:[(0,s.jsxs)(B,{value:"files",className:"text-xs",children:[(0,s.jsx)(G.A,{className:"w-3 h-3 mr-1"}),"Files"]}),(0,s.jsxs)(B,{value:"outline",className:"text-xs",children:[(0,s.jsx)(H.A,{className:"w-3 h-3 mr-1"}),"Outline"]}),(0,s.jsxs)(B,{value:"search",className:"text-xs",children:[(0,s.jsx)(q.A,{className:"w-3 h-3 mr-1"}),"Search"]})]}),(0,s.jsx)(U,{value:"files",className:"h-[calc(100%-2.5rem)] m-0",children:(0,s.jsx)(F,{className:"h-full",children:(0,s.jsxs)("div",{className:"p-2 space-y-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h3",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider px-2",children:"Manuscripts"}),d.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded-md cursor-pointer transition-colors ".concat((null==m?void 0:m.id)===e.id?"bg-accent text-accent-foreground":"hover:bg-accent/50"),children:[(0,s.jsx)(G.A,{className:"w-4 h-4 flex-shrink-0"}),(0,s.jsx)("span",{className:"text-sm truncate",children:e.title})]},e.id))]}),m&&h.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D,{}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h3",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider px-2",children:"Scenes"}),h.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded-md cursor-pointer transition-colors ".concat(p===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),onClick:()=>u(e.id),children:[(0,s.jsx)("span",{className:"text-xs bg-muted text-muted-foreground rounded px-1.5 py-0.5 font-mono",children:t+1}),(0,s.jsx)("span",{className:"text-sm truncate",children:e.title||"Scene ".concat(t+1)}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground ml-auto",children:[e.word_count||0,"w"]})]},e.id))]})]})]})})}),(0,s.jsx)(U,{value:"outline",className:"h-[calc(100%-2.5rem)] m-0",children:(0,s.jsx)(F,{className:"h-full p-2",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"text-xs font-medium text-muted-foreground",children:"Document Outline"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Outline view will appear here when analyzing document structure."})]})})}),(0,s.jsx)(U,{value:"search",className:"h-[calc(100%-2.5rem)] m-0",children:(0,s.jsxs)("div",{className:"p-2 space-y-3",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search in manuscript...",className:"w-full px-3 py-2 text-sm border border-border rounded-md bg-background"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Search results will appear here."})]})})]})]})}),(0,s.jsx)(O,{}),(0,s.jsx)(L,{defaultSize:n?75:55,minSize:30,children:(0,s.jsx)("div",{className:"h-full bg-background",children:t})}),(0,s.jsx)(O,{}),(0,s.jsx)(L,{defaultSize:l,minSize:20*!i,maxSize:40,collapsible:!0,onCollapse:()=>o(!0),onExpand:()=>o(!1),children:(0,s.jsxs)("div",{className:"h-full border-l border-border bg-card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 border-b border-border",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold",children:"Analysis"}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:g,className:"h-6 w-6 p-0",children:(0,s.jsx)(K.A,{className:"h-3 w-3"})})]}),(0,s.jsxs)(_,{defaultValue:"stats",className:"h-[calc(100%-3rem)]",children:[(0,s.jsxs)(V,{className:"grid w-full grid-cols-3",children:[(0,s.jsxs)(B,{value:"stats",className:"text-xs",children:[(0,s.jsx)($.A,{className:"w-3 h-3 mr-1"}),"Stats"]}),(0,s.jsxs)(B,{value:"comments",className:"text-xs",children:[(0,s.jsx)(Z.A,{className:"w-3 h-3 mr-1"}),"Notes"]}),(0,s.jsxs)(B,{value:"properties",className:"text-xs",children:[(0,s.jsx)(Y.A,{className:"w-3 h-3 mr-1"}),"Props"]})]}),(0,s.jsx)(U,{value:"stats",className:"h-[calc(100%-2.5rem)] m-0",children:(0,s.jsx)(F,{className:"h-full p-3",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Writing Statistics"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"Words:"}),(0,s.jsx)("span",{className:"font-medium",children:"2,450"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"Characters:"}),(0,s.jsx)("span",{className:"font-medium",children:"12,840"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"Pages:"}),(0,s.jsx)("span",{className:"font-medium",children:"4.2"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"Paragraphs:"}),(0,s.jsx)("span",{className:"font-medium",children:"18"})]})]})]}),(0,s.jsx)(D,{}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Reading Time"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"Average:"}),(0,s.jsx)("span",{className:"font-medium",children:"9.8 min"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"Slow:"}),(0,s.jsx)("span",{className:"font-medium",children:"14.7 min"})]})]})]})]})})}),(0,s.jsx)(U,{value:"comments",className:"h-[calc(100%-2.5rem)] m-0",children:(0,s.jsx)(F,{className:"h-full p-3",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h3",{className:"text-xs font-medium text-muted-foreground",children:"Comments & Notes"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"No comments yet. Select text and use Ctrl+Shift+C to add comments."})]})})}),(0,s.jsx)(U,{value:"properties",className:"h-[calc(100%-2.5rem)] m-0",children:(0,s.jsx)(F,{className:"h-full p-3",children:(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Document Properties"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-muted-foreground",children:"Title:"}),(0,s.jsx)("div",{className:"mt-1 font-medium",children:(null==m?void 0:m.title)||"Untitled"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-muted-foreground",children:"Genre:"}),(0,s.jsx)("div",{className:"mt-1 text-muted-foreground",children:"Fiction"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-muted-foreground",children:"Created:"}),(0,s.jsx)("div",{className:"mt-1 text-muted-foreground",children:new Date().toLocaleDateString()})]})]})]})})})})]})]})})]})}),(0,s.jsxs)("div",{className:"h-6 bg-muted/50 border-t border-border flex items-center justify-between px-3 text-xs text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("span",{children:"Line 1, Column 1"}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{children:m?"".concat(h.length," scenes"):"No manuscript"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("span",{children:"UTF-8"}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{children:"Auto-save: On"})]})]})]})}var eV=n(5143),eB=n(402),eU=n(1206);let e$=e=>{let{className:t,children:n}=e;return(0,s.jsx)("span",{role:"status",className:t,style:{display:"inline-block",padding:"2px 8px",borderRadius:8,background:"#eee",color:"#333",fontSize:12,lineHeight:1.4},children:n})};var eH=n(8266),eW=n(6695),eK=n(4186),eG=n(8021),eZ=n(1284),eq=n(4516),eY=n(1007);function eJ(e){let{chapter:t,index:n,warnings:r,onPreview:a}=e,{attributes:i,listeners:o,setNodeRef:c,transform:l,transition:d,isDragging:m}=(0,eB.gl)({id:t.id}),h={transform:eH.Ks.Transform.toString(l),transition:d},u=r.some(e=>"error"===e.severity),p=r.some(e=>"warning"===e.severity),x=r.length;return(0,s.jsx)(eW.Zp,{ref:c,style:h,className:"\n        transition-all duration-200\n        ".concat(m?"opacity-50 shadow-lg scale-105":"opacity-100","\n        ").concat(u?"border-red-200 bg-red-50":"","\n        ").concat(p&&!u?"border-orange-200 bg-orange-50":"","\n        hover:shadow-md\n      "),children:(0,s.jsx)("div",{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex items-center mt-1 cursor-grab active:cursor-grabbing text-muted-foreground hover:text-foreground",...i,...o,children:(0,s.jsx)(eG.A,{className:"h-5 w-5"})}),(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(e$,{variant:"outline",className:"font-mono",children:n})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium truncate",children:t.title}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-1 text-sm text-muted-foreground",children:[(0,s.jsxs)("span",{children:[t.wordCount.toLocaleString()," words"]}),t.metadata.pov&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(eY.A,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:t.metadata.pov})]}),t.metadata.location.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(eq.A,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:t.metadata.location[0]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[x>0&&(0,s.jsxs)(e$,{variant:u?"destructive":"secondary",className:u?"":"text-orange-600",children:[(0,s.jsx)(b.A,{className:"h-3 w-3 mr-1"}),x]}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:()=>a(t.id),className:"text-muted-foreground hover:text-foreground",children:(0,s.jsx)(eS.A,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[t.metadata.tensionLevel&&(0,s.jsxs)("span",{children:["Tension: ",t.metadata.tensionLevel,"/10"]}),t.metadata.timeframe&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(eK.A,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:t.metadata.timeframe})]}),t.metadata.majorEvents.length>0&&(0,s.jsxs)("span",{children:[t.metadata.majorEvents.length," major events"]})]}),t.dependencies.requiredKnowledge.length>0&&(0,s.jsxs)("div",{className:"mt-2 text-xs",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Requires: "}),(0,s.jsxs)("span",{className:"text-blue-600",children:[t.dependencies.requiredKnowledge.slice(0,3).join(", "),t.dependencies.requiredKnowledge.length>3&&"..."]})]}),t.dependencies.introduces.length>0&&(0,s.jsxs)("div",{className:"mt-1 text-xs",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Introduces: "}),(0,s.jsxs)("span",{className:"text-green-600",children:[t.dependencies.introduces.slice(0,3).join(", "),t.dependencies.introduces.length>3&&"..."]})]}),r.length>0&&(0,s.jsxs)("div",{className:"mt-2 space-y-1",children:[r.slice(0,2).map((e,t)=>(0,s.jsxs)("div",{className:"text-xs p-2 rounded flex items-start gap-2 ".concat("error"===e.severity?"bg-red-100 text-red-700":"warning"===e.severity?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"),children:["error"===e.severity?(0,s.jsx)(b.A,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}):(0,s.jsx)(eZ.A,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{className:"flex-1",children:e.message})]},t)),r.length>2&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",r.length-2," more issues"]})]})]})]})})})}var eQ=n(646),eX=n(463),e0=n(4861);function e1(e){let{warnings:t}=e,n=t.filter(e=>"error"===e.severity),r=t.filter(e=>"warning"===e.severity),a=t.filter(e=>"info"===e.severity);return 0===t.length?(0,s.jsx)("div",{className:"p-4",children:(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-3",children:(0,s.jsx)(eQ.A,{className:"h-6 w-6 text-green-600"})}),(0,s.jsx)("h3",{className:"font-medium text-green-800 mb-1",children:"All Clear!"}),(0,s.jsx)("p",{className:"text-sm text-green-600",children:"No consistency issues detected with this chapter order."})]})}):(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b",children:[(0,s.jsx)("h3",{className:"font-medium mb-2",children:"Consistency Analysis"}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[n.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-red-600",children:[(0,s.jsx)(e0.A,{className:"h-4 w-4"}),(0,s.jsxs)("span",{children:[n.length," errors"]})]}),r.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-orange-600",children:[(0,s.jsx)(b.A,{className:"h-4 w-4"}),(0,s.jsxs)("span",{children:[r.length," warnings"]})]}),a.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-blue-600",children:[(0,s.jsx)(eZ.A,{className:"h-4 w-4"}),(0,s.jsxs)("span",{children:[a.length," suggestions"]})]})]})]}),(0,s.jsx)(F,{className:"flex-1",children:(0,s.jsx)("div",{className:"p-4 space-y-3",children:t.map((e,t)=>(0,s.jsx)(eW.Zp,{className:"p-3 ".concat((e=>{switch(e){case"error":return"border-red-200 bg-red-50";case"warning":return"border-orange-200 bg-orange-50";case"info":return"border-blue-200 bg-blue-50"}})(e.severity)),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(e=>{switch(e){case"error":return(0,s.jsx)(e0.A,{className:"h-4 w-4 text-red-500"});case"warning":return(0,s.jsx)(b.A,{className:"h-4 w-4 text-orange-500"});case"info":return(0,s.jsx)(eZ.A,{className:"h-4 w-4 text-blue-500"})}})(e.severity),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)(e$,{variant:"outline",className:"text-xs font-mono",children:e.type}),e.chapterIds.length>1&&(0,s.jsxs)(e$,{variant:"secondary",className:"text-xs",children:[e.chapterIds.length," chapters"]})]}),(0,s.jsx)("p",{className:"text-sm font-medium mb-2",children:e.message}),e.suggestion&&(0,s.jsxs)("div",{className:"flex items-start gap-2 text-xs text-muted-foreground bg-white/50 rounded p-2",children:[(0,s.jsx)(eX.A,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{children:e.suggestion})]}),e.chapterIds.length>0&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Affects chapters: ",e.chapterIds.join(", ")]})}),e.autoFixable&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsxs)(N.$,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>console.log("Auto-fix:",e.id),children:[(0,s.jsx)(K.A,{className:"h-3 w-3 mr-1"}),"Auto-fix"]})})]})]})},t))})})]})}var e2=n(5169),e3=n(5040),e5=n(133);function e4(){let{manuscript:e,currentVersion:t,editorMode:n}=er(),{setEditorMode:a,reorderChapters:i,previewReordering:o,applyReordering:c,cancelReordering:l,runConsistencyCheck:d}=er(e=>e.actions),[m,h]=(0,r.useState)([]),[u,p]=(0,r.useState)([]),[x,g]=(0,r.useState)(!1),[f,v]=(0,r.useState)(!1),j=(0,eV.FR)((0,eV.MS)(eV.AN),(0,eV.MS)(eV.uN,{coordinateGetter:eB.JR}));r.useEffect(()=>{"reorder"===n&&t&&e&&(h(t.chapterOrder.length>0?t.chapterOrder:e.content.chapters.map(e=>e.id)),v(!1))},[n,t,e]);let w=(0,r.useCallback)(async e=>{let{active:t,over:n}=e;t.id!==(null==n?void 0:n.id)&&h(e=>{let s=e.indexOf(t.id),r=e.indexOf(n.id),a=(0,eB.be)(e,s,r);return g(!0),o(a).then(e=>{p(e.checks),g(!1),v(!0)}).catch(()=>{g(!1),v(!0)}),a})},[o]),y=(0,r.useCallback)(async()=>{try{i(m),await c(),v(!1),await d()}catch(e){console.error("Failed to apply reordering:",e)}},[m,i,c,d]),C=(0,r.useCallback)(()=>{l(),a("edit"),v(!1)},[l,a]),k=(0,r.useCallback)(e=>{},[]);if(!e||!t)return(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"text-muted-foreground",children:"No manuscript loaded"})});let S=m.map(t=>e.content.chapters.find(e=>e.id===t)).filter(Boolean),A=u.some(e=>"warning"===e.severity||"error"===e.severity);return(0,s.jsxs)("div",{className:"flex flex-col h-full bg-background",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(N.$,{variant:"ghost",size:"sm",onClick:C,children:[(0,s.jsx)(e2.A,{className:"h-4 w-4 mr-2"}),"Back to Editor"]}),(0,s.jsx)(D,{orientation:"vertical",className:"h-6"}),(0,s.jsx)(e3.A,{className:"h-5 w-5 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"font-semibold",children:"Chapter Reordering"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.metadata.title," - ",t.name]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[f&&(0,s.jsx)(e$,{variant:"secondary",className:"text-orange-600",children:"Unsaved Changes"}),(0,s.jsxs)(N.$,{variant:"outline",size:"sm",onClick:C,disabled:!f,children:[(0,s.jsx)(e5.A,{className:"h-4 w-4 mr-2"}),"Reset"]}),(0,s.jsxs)(N.$,{onClick:y,disabled:!f,className:"bg-blue-600 hover:bg-blue-700",children:[(0,s.jsx)(ev.A,{className:"h-4 w-4 mr-2"}),"Apply Changes"]})]})]}),(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,s.jsx)("div",{className:"flex-1 p-4 overflow-y-auto",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Chapter Order"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Drag chapters to reorder them. Warnings will appear for potential consistency issues."})]}),(0,s.jsx)(eV.Mp,{sensors:j,collisionDetection:eV.fp,onDragEnd:w,modifiers:[eU.FN],children:(0,s.jsx)(eB.gB,{items:m,strategy:eB._G,children:(0,s.jsx)("div",{className:"space-y-2",children:S.map((e,t)=>(0,s.jsx)(eJ,{chapter:e,index:t+1,warnings:u.filter(t=>t.chapterIds.includes(e.id)),onPreview:k},e.id))})})}),x&&(0,s.jsx)("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-blue-600 border-t-transparent"}),(0,s.jsx)("span",{className:"text-sm",children:"Analyzing consistency..."})]})})]})}),u.length>0&&(0,s.jsx)("div",{className:"w-80 border-l bg-muted/20",children:(0,s.jsx)(e1,{warnings:u})})]}),(0,s.jsx)("div",{className:"border-t bg-muted/50 px-4 py-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("span",{className:"text-muted-foreground",children:[S.length," chapters"]}),A?(0,s.jsxs)("div",{className:"flex items-center gap-1 text-orange-600",children:[(0,s.jsx)(b.A,{className:"h-4 w-4"}),(0,s.jsxs)("span",{children:[u.length," consistency issues"]})]}):(0,s.jsxs)("div",{className:"flex items-center gap-1 text-green-600",children:[(0,s.jsx)(eQ.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"No issues detected"})]})]}),(0,s.jsx)("div",{className:"text-muted-foreground",children:f?"Changes not saved":"All changes saved"})]})})]})}let e6=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("input",{ref:t,className:n,...r})});e6.displayName="Input";let e7=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("textarea",{ref:t,className:n,...r})});e7.displayName="Textarea";let e8=(0,r.createContext)(void 0);function e9(e){let{open:t=!1,onOpenChange:n,children:a}=e,[i,o]=(0,r.useState)(t),c=void 0!==n,l=c?t:i;return(0,r.useEffect)(()=>{c||o(t)},[t,c]),(0,s.jsx)(e8.Provider,{value:{open:l,onOpenChange:c?n:o},children:a})}function te(e){let{asChild:t,children:n}=e,a=(0,r.useContext)(e8);if(!a)throw Error("DialogTrigger must be used within Dialog");let i=()=>{a.onOpenChange(!0)};return t&&r.isValidElement(n)?r.cloneElement(n,{onClick:i,...n.props}):(0,s.jsx)(N.$,{onClick:i,children:n})}function tt(e){let{children:t,className:n=""}=e,a=(0,r.useContext)(e8);if(!a)throw Error("DialogContent must be used within Dialog");return a.open?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>a.onOpenChange(!1)}),(0,s.jsx)("div",{className:"relative bg-background border border-border rounded-lg shadow-lg max-w-md w-full mx-4 ".concat(n),children:t})]}):null}function tn(e){let{children:t,className:n=""}=e;return(0,s.jsx)("div",{className:"p-6 pb-4 ".concat(n),children:t})}function ts(e){let{children:t,className:n=""}=e;return(0,s.jsx)("h3",{className:"text-lg font-semibold leading-none tracking-tight ".concat(n),children:t})}var tr=n(1788),ta=n(4616),ti=n(8564);function to(){let{currentVersion:e,availableVersions:t,manuscript:n}=er(),{createVersion:a,switchVersion:i,compareVersions:o,exportVersion:c}=er(e=>e.actions),[l,d]=(0,r.useState)(!1),[m,h]=(0,r.useState)(""),[u,p]=(0,r.useState)(""),[x,g]=(0,r.useState)(!1),f=async()=>{if(m.trim()){g(!0);try{await a(m.trim(),u.trim()),h(""),p(""),d(!1)}catch(e){console.error("Failed to create version:",e)}finally{g(!1)}}},v=async t=>{if(t!==(null==e?void 0:e.id))try{await i(t)}catch(e){console.error("Failed to switch version:",e)}},j=async t=>{if(e)try{await o(e.id,t)}catch(e){console.error("Failed to compare versions:",e)}},w=async(e,t)=>{try{await c(e,t)}catch(e){console.error("Failed to export version:",e)}};return(0,s.jsxs)("div",{className:"h-full flex flex-col bg-background",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(ef.A,{className:"h-5 w-5 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"font-semibold",children:"Version Control"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage chapter arrangements"})]})]}),(0,s.jsxs)(e9,{open:l,onOpenChange:d,children:[(0,s.jsx)(te,{asChild:!0,children:(0,s.jsxs)(N.$,{className:"bg-blue-600 hover:bg-blue-700",children:[(0,s.jsx)(ta.A,{className:"h-4 w-4 mr-2"}),"New Version"]})}),(0,s.jsxs)(tt,{children:[(0,s.jsx)(tn,{children:(0,s.jsx)(ts,{children:"Create New Version"})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Version Name"}),(0,s.jsx)(e6,{value:m,onChange:e=>h(e.target.value),placeholder:"e.g., Tension-First Order",className:"mt-1"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Description"}),(0,s.jsx)(e7,{value:u,onChange:e=>p(e.target.value),placeholder:"Describe what this version changes...",className:"mt-1",rows:3})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(N.$,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),(0,s.jsx)(N.$,{onClick:f,disabled:!m.trim()||x,children:x?"Creating...":"Create Version"})]})]})]})]})]}),(0,s.jsx)(F,{className:"flex-1",children:(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[t.map(r=>{var a;let i,o=r.id===(null==e?void 0:e.id),c=n?{chapters:r.chapterOrder.length,changes:r.changes.length}:{chapters:0,changes:0};return(0,s.jsxs)(eW.Zp,{className:"p-4 transition-all duration-200 ".concat(o?"border-blue-200 bg-blue-50":"hover:shadow-md cursor-pointer"),onClick:()=>!o&&v(r.id),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h4",{className:"font-medium",children:r.name}),r.isBaseVersion&&(0,s.jsx)(ti.A,{className:"h-4 w-4 text-yellow-500"}),o&&(0,s.jsx)(e$,{variant:"default",className:"bg-blue-600",children:"Current"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),j(r.id)},disabled:o,children:(0,s.jsx)(eS.A,{className:"h-4 w-4"})}),(0,s.jsx)(N.$,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),w(r.id,"docx")},children:(0,s.jsx)(tr.A,{className:"h-4 w-4"})})]})]}),r.description&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:r.description}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("span",{children:[c.chapters," chapters"]}),(0,s.jsxs)("span",{children:[c.changes," changes"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(eK.A,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:(i=r.created,new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(i))})]})]}),!r.isBaseVersion&&r.parentVersionId&&(0,s.jsx)("div",{className:"mt-2 text-xs",children:(0,s.jsxs)("span",{className:"text-muted-foreground",children:["Based on: ",null==(a=t.find(e=>e.id===r.parentVersionId))?void 0:a.name]})})]},r.id)}),0===t.length&&(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(ef.A,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{children:"No versions available"}),(0,s.jsx)("p",{className:"text-sm",children:"Create your first version to get started"})]})]})})]})}var tc=n(7340);class tl extends r.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError(e,t),console.error("Production error logged:",{error:e.toString(),stack:e.stack,componentStack:t.componentStack,timestamp:new Date().toISOString()})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,s.jsx)("div",{className:"min-h-[400px] flex items-center justify-center p-6",children:(0,s.jsxs)("div",{className:"max-w-md text-center space-y-6",children:[(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(b.A,{className:"h-16 w-16 text-red-500"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-foreground",children:"Something went wrong"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"The editor encountered an unexpected error. This has been logged for investigation."})]}),!1,(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,s.jsxs)("button",{onClick:this.handleRetry,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:[(0,s.jsx)(k.A,{className:"h-4 w-4"}),"Try Again"]}),(0,s.jsxs)("button",{onClick:this.handleReload,className:"inline-flex items-center gap-2 px-4 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors",children:[(0,s.jsx)(k.A,{className:"h-4 w-4"}),"Reload Page"]}),(0,s.jsxs)("button",{onClick:this.handleGoHome,className:"inline-flex items-center gap-2 px-4 py-2 bg-muted text-muted-foreground rounded-md hover:bg-muted/90 transition-colors",children:[(0,s.jsx)(tc.A,{className:"h-4 w-4"}),"Go Home"]})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"If this problem persists, please refresh the page or restart the application."})]})}):this.props.children}constructor(e){super(e),this.handleRetry=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})},this.handleReload=()=>{window.location.reload()},this.handleGoHome=()=>{window.location.href="/"},this.state={hasError:!1}}}var td=n(3145);let tm=td.bL,th=td.l9;td.YJ,td.ZL;let tu=td.Pb;td.z6;let tp=r.forwardRef((e,t)=>{let{className:n,inset:r,children:a,...i}=e;return(0,s.jsxs)(td.ZP,{ref:t,className:(0,T.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",r&&"pl-8",n),...i,children:[a,(0,s.jsx)(K.A,{className:"ml-auto h-4 w-4"})]})});tp.displayName=td.ZP.displayName;let tx=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(td.G5,{ref:t,className:(0,T.cn)("z-[9999] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...r})});tx.displayName=td.G5.displayName;let tg=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(td.ZL,{children:(0,s.jsx)(td.UC,{ref:t,className:(0,T.cn)("z-[9999] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...r})})});tg.displayName=td.UC.displayName;let tf=r.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,s.jsx)(td.q7,{ref:t,className:(0,T.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",n),...a})});tf.displayName=td.q7.displayName,r.forwardRef((e,t)=>{let{className:n,children:r,checked:a,...i}=e;return(0,s.jsxs)(td.H_,{ref:t,className:(0,T.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:a,...i,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(td.VF,{children:(0,s.jsx)(ei.A,{className:"h-4 w-4"})})}),r]})}).displayName=td.H_.displayName,r.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,s.jsxs)(td.hN,{ref:t,className:(0,T.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...a,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(td.VF,{children:(0,s.jsx)(eo.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=td.hN.displayName,r.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,s.jsx)(td.JU,{ref:t,className:(0,T.cn)("px-2 py-1.5 text-sm font-semibold text-foreground",r&&"pl-8",n),...a})}).displayName=td.JU.displayName;let tv=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(td.wv,{ref:t,className:(0,T.cn)("-mx-1 my-1 h-px bg-border",n),...r})});tv.displayName=td.wv.displayName;let tj=e=>{let{className:t,...n}=e;return(0,s.jsx)("span",{className:(0,T.cn)("ml-auto text-xs tracking-widest text-muted-foreground",t),...n})};tj.displayName="ContextMenuShortcut";var tw=n(6976),ty=n(4357),tC=n(3408);function tN(e){let{sceneId:t}=e,n=(0,r.useRef)(null),[a,i]=(0,r.useState)(""),[o,c]=(0,r.useState)(!1),{manuscript:l,activeChapterId:d,isLoading:m,editorMode:h}=er(),{initialize:u,updateChapterContent:p,setActiveChapter:x,saveManuscript:g}=er(e=>e.actions),f=null==l?void 0:l.content.chapters.find(e=>e.id===d),v=(null==f?void 0:f.content)||"";(0,r.useEffect)(()=>{l||u()},[l,u]),function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=(0,r.useCallback)(n=>{if(t){for(let[t,s]of Object.entries(e))if(function(e,t){let n=function(e){let t=e.split("+"),n=t[t.length-1];return{ctrl:t.includes("Ctrl"),shift:t.includes("Shift"),alt:t.includes("Alt"),key:n.toLowerCase()}}(t);return e.ctrlKey===n.ctrl&&e.shiftKey===n.shift&&e.altKey===n.alt&&e.key.toLowerCase()===n.key}(n,t)){n.preventDefault(),n.stopPropagation(),s();return}}},[e,t]);(0,r.useEffect)(()=>{if(t)return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[n,t])}({"Ctrl+S":()=>{document.dispatchEvent(new CustomEvent("global-save"))},"Ctrl+N":()=>{document.dispatchEvent(new CustomEvent("global-new-manuscript"))},"Ctrl+O":()=>{document.dispatchEvent(new CustomEvent("global-open-manuscript"))},"Ctrl+F":()=>{document.dispatchEvent(new CustomEvent("global-find"))},"Ctrl+H":()=>{document.dispatchEvent(new CustomEvent("global-find-replace"))},F11:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},"Ctrl+\\":()=>{document.dispatchEvent(new CustomEvent("global-toggle-sidebar"))},"Ctrl+;":()=>{document.dispatchEvent(new CustomEvent("global-toggle-properties"))},"Ctrl+Shift+F":()=>{document.dispatchEvent(new CustomEvent("global-toggle-focus-mode"))},"Ctrl+Shift+A":()=>{document.dispatchEvent(new CustomEvent("global-ai-analysis"))},F1:()=>{document.dispatchEvent(new CustomEvent("global-show-shortcuts"))}}),(0,r.useEffect)(()=>{let e=()=>{g()},t=()=>{c(!0)},n=()=>{c(!0)},s=()=>{},r=()=>{};return document.addEventListener("global-save",e),document.addEventListener("global-find",t),document.addEventListener("global-find-replace",n),document.addEventListener("global-toggle-focus-mode",s),document.addEventListener("global-ai-analysis",r),()=>{document.removeEventListener("global-save",e),document.removeEventListener("global-find",t),document.removeEventListener("global-find-replace",n),document.removeEventListener("global-toggle-focus-mode",s),document.removeEventListener("global-ai-analysis",r)}},[g,a]),(0,r.useEffect)(()=>{let e=()=>{let e=window.getSelection();e&&i(e.toString())};return document.addEventListener("selectionchange",e),()=>document.removeEventListener("selectionchange",e)},[]);let j=e=>{if(n.current)switch(e){case"bold":case"italic":case"underline":case"comment":case"analyze":case"lookup":break;case"copy":document.execCommand("copy");break;case"cut":document.execCommand("cut");break;case"paste":document.execCommand("paste")}};return m?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"text-lg",children:"Loading editor..."})}):(0,s.jsx)(e_,{children:(0,s.jsx)("div",{className:"h-full flex flex-col",children:(()=>{switch(h){case"reorder":return(0,s.jsx)(e4,{});case"compare":return(0,s.jsxs)("div",{className:"flex h-full",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(e4,{})}),(0,s.jsx)("div",{className:"w-80 border-l",children:(0,s.jsx)(to,{})})]});default:return(0,s.jsxs)(tl,{onError:(e,t)=>{console.error("Editor error:",e,t)},children:[(0,s.jsxs)(tm,{children:[(0,s.jsx)(th,{asChild:!0,children:(0,s.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,s.jsx)(S,{children:(0,s.jsx)(C,{ref:n,content:v,onChange:e=>{d&&p(d,e)},sceneId:d||void 0,onSave:g,placeholder:"Begin writing your story...",className:"\n                        ".concat((null==l?void 0:l.settings.enableConsistencyChecking)?"consistency-mode":"","\n                      ")})})})}),(0,s.jsxs)(tg,{className:"w-64",children:[a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(tf,{onClick:()=>j("cut"),children:[(0,s.jsx)(tC.A,{className:"mr-2 h-4 w-4"}),"Cut",(0,s.jsx)(tj,{children:"Ctrl+X"})]}),(0,s.jsxs)(tf,{onClick:()=>j("copy"),children:[(0,s.jsx)(ty.A,{className:"mr-2 h-4 w-4"}),"Copy",(0,s.jsx)(tj,{children:"Ctrl+C"})]}),(0,s.jsx)(tv,{}),(0,s.jsxs)(tu,{children:[(0,s.jsxs)(tp,{children:[(0,s.jsx)(eb.A,{className:"mr-2 h-4 w-4"}),"Format"]}),(0,s.jsxs)(tx,{className:"w-48",children:[(0,s.jsxs)(tf,{onClick:()=>j("bold"),children:[(0,s.jsx)(eb.A,{className:"mr-2 h-4 w-4"}),"Bold",(0,s.jsx)(tj,{children:"Ctrl+B"})]}),(0,s.jsxs)(tf,{onClick:()=>j("italic"),children:[(0,s.jsx)(eT.A,{className:"mr-2 h-4 w-4"}),"Italic",(0,s.jsx)(tj,{children:"Ctrl+I"})]}),(0,s.jsxs)(tf,{onClick:()=>j("underline"),children:[(0,s.jsx)(eR.A,{className:"mr-2 h-4 w-4"}),"Underline",(0,s.jsx)(tj,{children:"Ctrl+U"})]})]})]}),(0,s.jsx)(tv,{}),(0,s.jsxs)(tf,{onClick:()=>j("comment"),children:[(0,s.jsx)(Z.A,{className:"mr-2 h-4 w-4"}),"Add Comment",(0,s.jsx)(tj,{children:"Ctrl+Alt+M"})]}),(0,s.jsxs)(tf,{onClick:()=>j("analyze"),children:[(0,s.jsx)(eD.A,{className:"mr-2 h-4 w-4"}),"AI Analysis",(0,s.jsx)(tj,{children:"Ctrl+Shift+A"})]}),(0,s.jsx)(tv,{}),(0,s.jsxs)(tf,{onClick:()=>j("lookup"),children:[(0,s.jsx)(q.A,{className:"mr-2 h-4 w-4"}),"Look Up"]}),(0,s.jsxs)(tf,{onClick:()=>j("bookmark"),children:[(0,s.jsx)(H.A,{className:"mr-2 h-4 w-4"}),"Bookmark"]})]}),!a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(tf,{onClick:()=>j("paste"),children:[(0,s.jsx)(tw.A,{className:"mr-2 h-4 w-4"}),"Paste",(0,s.jsx)(tj,{children:"Ctrl+V"})]}),(0,s.jsx)(tv,{}),(0,s.jsxs)(tf,{onClick:()=>c(!0),children:[(0,s.jsx)(q.A,{className:"mr-2 h-4 w-4"}),"Find & Replace",(0,s.jsx)(tj,{children:"Ctrl+H"})]}),(0,s.jsx)(tv,{}),(0,s.jsxs)(tf,{children:[(0,s.jsx)(e3.A,{className:"mr-2 h-4 w-4"}),"Insert Scene Break",(0,s.jsx)(tj,{children:"Ctrl+Shift+Enter"})]}),(0,s.jsxs)(tu,{children:[(0,s.jsxs)(tp,{children:[(0,s.jsx)(e3.A,{className:"mr-2 h-4 w-4"}),"Insert"]}),(0,s.jsxs)(tx,{className:"w-48",children:[(0,s.jsx)(tf,{children:"Chapter Division"}),(0,s.jsx)(tf,{children:"Scene Break"}),(0,s.jsx)(tf,{children:"Page Break"}),(0,s.jsx)(tv,{}),(0,s.jsx)(tf,{children:"Today's Date"}),(0,s.jsx)(tf,{children:"Word Count"})]})]})]})]})]}),o&&(0,s.jsx)("div",{className:"absolute top-4 right-4 bg-background border border-border rounded-lg p-4 shadow-lg z-50",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-sm font-medium",children:"Find & Replace"}),(0,s.jsx)("button",{onClick:()=>c(!1),className:"text-muted-foreground hover:text-foreground",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("input",{type:"text",placeholder:"Find...",className:"w-full px-2 py-1 text-sm border border-border rounded"}),(0,s.jsx)("input",{type:"text",placeholder:"Replace with...",className:"w-full px-2 py-1 text-sm border border-border rounded"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{className:"px-3 py-1 text-xs bg-primary text-primary-foreground rounded",children:"Find Next"}),(0,s.jsx)("button",{className:"px-3 py-1 text-xs bg-secondary text-secondary-foreground rounded",children:"Replace"}),(0,s.jsx)("button",{className:"px-3 py-1 text-xs bg-secondary text-secondary-foreground rounded",children:"Replace All"})]})]})})]})}})()})})}function tb(){return(0,s.jsx)(tl,{onError:(e,t)=>{console.error("Editor page error:",e,t)},children:(0,s.jsx)(tN,{})})}},285:(e,t,n)=>{"use strict";n.d(t,{$:()=>r});var s=n(5155);let r=n(2115).forwardRef((e,t)=>{let{variant:n="default",size:r="md",className:a,children:i,asChild:o,...c}=e,l="secondary"===n?"#e9ecef":"destructive"===n?"#dc3545":"ghost"===n||"link"===n||"outline"===n?"transparent":"#0d6efd";return(0,s.jsx)("button",{ref:t,className:a,style:{padding:"sm"===r?"6px 10px":"lg"===r?"10px 16px":"8px 12px",background:l,color:"ghost"===n||"link"===n||"outline"===n?"#0d6efd":"#fff",border:"outline"===n?"1px solid #0d6efd":"1px solid transparent",borderRadius:6,cursor:"pointer",textDecoration:"link"===n?"underline":"none"},...c,children:i})});r.displayName="Button"},1321:(e,t,n)=>{"use strict";n.d(t,{Es:()=>s.Es,Ks:()=>s.Ks,Re:()=>s.Re,YG:()=>s.YG,jn:()=>s.jn,kx:()=>s.kx});var s=n(8266)},2865:(e,t,n)=>{Promise.resolve().then(n.bind(n,5))},4601:(e,t,n)=>{"use strict";n.d(t,{C:()=>c});var s=n(7111),r=n(6786),a=n(4273);class i{static async createManuscript(e,t){return await (0,a.lA)("create_manuscript_safe",{title:e,text:t})}static async loadManuscript(){return await (0,a.lA)("get_manuscript")||null}static async deleteManuscript(){return await (0,a.lA)("delete_manuscript_safe")}static async getScenes(){let e=await (0,a.lA)("get_all_scenes");return Array.isArray(e)?e:[]}static async updateScene(e,t){return await (0,a.lA)("update_scene_safe",{sceneId:e,updates:t})}static async importFile(e){return await (0,a.lA)("import_file",{path:e})}static async batchImportFiles(){return await (0,a.lA)("batch_import_files")}static async exportManuscript(e,t,n){return await (0,a.lA)("export_manuscript",{id:e,format:t,path:n})}static async getRecentErrors(e){return await (0,a.lA)("get_recent_errors",{limit:e})}static async safeInvoke(e,t){try{return await (0,a.lA)(e,t)}catch(t){throw console.error("Tauri command ".concat(e," failed:"),t),t}}}function o(){return new Promise(e=>{let t=localStorage.getItem("manuscript-content");if(t)try{let n=JSON.parse(t);if(n.metadata&&n.chapters&&Array.isArray(n.chapters))return void e(n)}catch(e){console.warn("Failed to parse stored manuscript, using default:",e)}e({metadata:{title:"New Manuscript",author:"Author Name",wordCount:0,genre:"techno-thriller",version:"1.0.0",lastModified:new Date,created:new Date,tags:[]},chapters:[],characters:[],locations:[],techConcepts:[],timeline:[]})})}let c=(0,s.vt)()((0,r.lt)((0,r.eh)((e,t)=>({currentView:"dashboard",sidebarCollapsed:!1,loading:!1,error:null,currentManuscript:null,scenes:[],activeSceneId:null,activeChapterId:null,editorContent:"",unsavedChanges:!1,editorSettings:{fontSize:16,theme:"light",focusMode:!1,typewriterMode:!1,showWordCount:!0,showChapterNumbers:!0,lineHeight:1.6,fontFamily:"Inter"},setCurrentView:t=>e({currentView:t}),setSidebarCollapsed:t=>e({sidebarCollapsed:t}),setLoading:t=>e({loading:t}),setError:t=>e({error:t}),loadScenes:async()=>{e({loading:!0,error:null});try{let n=await i.getScenes();e({scenes:n,loading:!1}),n.length>0&&!t().activeSceneId&&e({activeSceneId:n[0].id,editorContent:n[0].raw_text||""})}catch(t){e({error:t instanceof Error?t.message:"Failed to load scenes",loading:!1})}},updateScene:async(t,n)=>{try{await i.updateScene(t,n),e(e=>({scenes:e.scenes.map(e=>e.id===t?{...e,...n}:e),unsavedChanges:!1}))}catch(t){e({error:t instanceof Error?t.message:"Failed to update scene"})}},setActiveScene:n=>{let s=t().scenes.find(e=>e.id===n);e({activeSceneId:n,editorContent:(null==s?void 0:s.raw_text)||"",unsavedChanges:!1})},setEditorContent:n=>{var s;e({editorContent:n,unsavedChanges:n!==((null==(s=t().scenes.find(e=>e.id===t().activeSceneId))?void 0:s.raw_text)||"")})},saveCurrentScene:async()=>{let{activeSceneId:e,editorContent:n}=t();e&&await t().updateScene(e,{raw_text:n})},updateEditorSettings:t=>{e(e=>({editorSettings:{...e.editorSettings,...t}}))},loadManuscript:async()=>{e({loading:!0,error:null});try{let t=await o();e({currentManuscript:t,isManuscriptMode:!0,loading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load manuscript",loading:!1})}},initializeManuscriptMode:async()=>{e({loading:!0,error:null});try{let t=await o();e({currentManuscript:t,isManuscriptMode:!0,loading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to initialize manuscript mode",loading:!1})}},switchToLegacyMode:()=>{e({currentManuscript:null,isManuscriptMode:!1,activeChapterId:null})},setActiveChapter:n=>{let{currentManuscript:s}=t();if(s&&null!==n){let t=s.content.chapters.find(e=>e.currentPosition===n);e({activeChapterId:n,editorContent:(null==t?void 0:t.content)||"",unsavedChanges:!1})}else e({activeChapterId:null,editorContent:"",unsavedChanges:!1})},updateChapterContent:(n,s)=>{let{currentManuscript:r}=t();if(r){let t={...r},a=t.content.chapters.findIndex(e=>e.currentPosition===n);-1!==a&&(t.content.chapters[a]={...t.content.chapters[a],content:s},e({currentManuscript:t,editorContent:s,unsavedChanges:!0}))}},saveCurrentChapter:async()=>{let{activeChapterId:n,editorContent:s,currentManuscript:r}=t();if(n&&r)try{t().updateChapterContent(n,s),e({unsavedChanges:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to save chapter"})}}})),{name:"narrative-surgeon-store"}));{c.subscribe(e=>e.editorSettings,e=>{localStorage.setItem("narrative-surgeon-editor-settings",JSON.stringify(e))});let e=localStorage.getItem("narrative-surgeon-editor-settings");if(e)try{let t=JSON.parse(e);c.getState().updateEditorSettings(t)}catch(e){console.warn("Failed to load editor settings:",e)}}},6350:(e,t,n)=>{"use strict";n.d(t,{PM:()=>s.PM,Sj:()=>s.Sj,Vy:()=>s.Vy,fF:()=>s.fF,sl:()=>s.sl,vL:()=>s.vL,y$:()=>s.y$,zM:()=>s.zM});var s=n(5143)},6695:(e,t,n)=>{"use strict";n.d(t,{Zp:()=>i});var s=n(5155),r=n(2115),a=n(9434);let i=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...r})});i.displayName="Card",r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",n),...r})}).displayName="CardHeader",r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",n),...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",n),...r})}).displayName="CardDescription",r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",n),...r})}).displayName="CardContent",r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",n),...r})}).displayName="CardFooter"},9270:(e,t,n)=>{"use strict";n.d(t,{$$:()=>s.$$,Es:()=>s.Es,KG:()=>s.KG,Ks:()=>s.Ks,Ll:()=>s.Ll,Re:()=>s.Re,Sw:()=>s.Sw,TW:()=>s.TW,WQ:()=>s.WQ,YG:()=>s.YG,YN:()=>s.YN,ZC:()=>s.ZC,_q:()=>s._q,ag:()=>s.ag,e_:()=>s.e_,kx:()=>s.kx,l6:()=>s.l6,lk:()=>s.lk,sb:()=>s.sb,wz:()=>s.wz,xZ:()=>s.xZ,zk:()=>s.zk});var s=n(8266)},9434:(e,t,n)=>{"use strict";function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}n.d(t,{cn:()=>s})}},e=>{e.O(0,[426,336,96,358],()=>e(e.s=2865)),_N_E=e.O()}]);